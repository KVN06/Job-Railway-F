(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}})();const _n="https://job-railway-production.up.railway.app/api";var Ha,Ba;const Kt=(((Ba=(Ha=import.meta)==null?void 0:Ha.env)==null?void 0:Ba.VITE_API_BASE_URL)||_n).replace(/\/$/,""),Qt=Kt.replace(/\/?api$/,"");var za,Va;const An=((Va=(za=import.meta)==null?void 0:za.env)==null?void 0:Va.VITE_API_AUTH_MODE)||"bearer";let at=An==="cookie"?"cookie":"bearer",Ze;function Te({mode:e,token:t}={}){(e==="bearer"||e==="cookie")&&(at=e),typeof t=="string"&&(Ze=t)}function pe(e){Ze=e}function En(){return Ze}function Ie(){return at}let ua=!1;function Ja(e){try{const t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([.$?*|{}()\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):null}catch{return null}}async function Ga(){if(!ua)try{const e=Kt.replace(/\/?api\/?$/,"")+"/sanctum/csrf-cookie";await fetch(e,{method:"GET",credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest"}}),ua=!0}catch{}}function Wa(e={},t,a=!1){const n={Accept:"application/json","X-Requested-With":"XMLHttpRequest",...t&&!a?{"Content-Type":"application/json"}:{},...e};return at==="bearer"&&Ze&&(n.Authorization=`Bearer ${Ze}`),n}async function H(e,{method:t="GET",headers:a={},body:n,query:s,auth:r}={}){const o=new URL(Kt+(e.startsWith("/")?e:`/${e}`));if(s&&typeof s=="object")for(const[y,g]of Object.entries(s))g!=null&&g!==""&&o.searchParams.set(y,String(g));const l=r||at,i=/^(POST|PUT|PATCH|DELETE)$/i.test(t||"GET");if(l==="cookie"&&i&&!e.includes("/sanctum/csrf-cookie")){await Ga();const y=Ja("XSRF-TOKEN");y&&!("X-XSRF-TOKEN"in a)&&(a["X-XSRF-TOKEN"]=y)}const c=typeof FormData<"u"&&n instanceof FormData,f=await fetch(o,{method:t,headers:Wa(a,!!n,c),body:n?c?n:JSON.stringify(n):void 0,credentials:l==="cookie"?"include":"omit",mode:"cors"}),m=(f.headers.get("content-type")||"").includes("application/json")?await f.json().catch(()=>null):await f.text();if(!f.ok){const y=new Error((m==null?void 0:m.message)||`API ${f.status} ${f.statusText}`);throw y.status=f.status,y.data=m,f.status===401&&(y.code="AUTH_REQUIRED"),y}return m}async function Ae(e,{method:t="GET",headers:a={},body:n,query:s,auth:r}={}){const o=new URL(Qt+(e.startsWith("/")?e:`/${e}`));if(s&&typeof s=="object")for(const[y,g]of Object.entries(s))g!=null&&g!==""&&o.searchParams.set(y,String(g));const l=r||at,i=/^(POST|PUT|PATCH|DELETE)$/i.test(t||"GET");if(l==="cookie"&&i&&!e.includes("/sanctum/csrf-cookie")){await Ga();const y=Ja("XSRF-TOKEN");y&&!("X-XSRF-TOKEN"in a)&&(a["X-XSRF-TOKEN"]=y)}const c=typeof FormData<"u"&&n instanceof FormData,f=await fetch(o,{method:t,headers:Wa(a,!!n,c),body:n?c?n:JSON.stringify(n):void 0,credentials:l==="cookie"?"include":"omit",mode:"cors"}),m=(f.headers.get("content-type")||"").includes("application/json")?await f.json().catch(()=>null):await f.text();if(!f.ok){const y=new Error((m==null?void 0:m.message)||`WEB ${f.status} ${f.statusText}`);throw y.status=f.status,y.data=m,f.status===401&&(y.code="AUTH_REQUIRED"),y}return m}async function xe(e={}){return H("/job-offer",{query:e})}async function Ka(e){return H(`/job-offer/${e}`)}async function kn(e){return H("/job-offer",{method:"POST",body:e})}async function jn(e,t){return H(`/job-offer/${e}`,{method:"PUT",body:t})}async function $n(e){return H(`/job-offer/${e}`,{method:"DELETE"})}async function Ce(e={}){var n,s,r,o;const t=["/job-offer/count","/job-offers/count","/jobs/count"];let a=null;for(const l of t)try{const i=await H(l,{query:e}),c=typeof i=="number"?i:(i==null?void 0:i.total)??(i==null?void 0:i.count)??((n=i==null?void 0:i.data)==null?void 0:n.total);if(Number.isFinite(c))return c}catch(i){a=i}try{const l=await xe({...e,per_page:1,page:1}),i=((s=l==null?void 0:l.meta)==null?void 0:s.total)??(l==null?void 0:l.total)??void 0;if(Number.isFinite(i))return i}catch(l){a=l}try{const l=[{per_page:1e3,page:1},{limit:1e3,page:1},{per_page:5e3,page:1}];for(const i of l){const c=await xe({...e,...i}),f=((r=c==null?void 0:c.meta)==null?void 0:r.total)??(c==null?void 0:c.total);if(Number.isFinite(f))return f;const d=Array.isArray(c)?c:Array.isArray(c==null?void 0:c.data)?c.data:[];if(d.length>0)return d.length}}catch(l){a=l}try{let l=1,i=0;const c=100,f=20;for(;l<=f;l++){const d=await xe({...e,per_page:c,page:l}),p=Array.isArray(d)?d:Array.isArray(d==null?void 0:d.data)?d.data:[];if(!p.length)break;i+=p.length;const m=((o=d==null?void 0:d.meta)==null?void 0:o.last_page)??(d==null?void 0:d.last_page);if(Number.isFinite(m)&&l>=m)break}if(i>0)return i}catch(l){a=l}try{const l=await xe({...e});return(Array.isArray(l)?l:Array.isArray(l==null?void 0:l.data)?l.data:[]).length}catch(l){a=l}if(a)throw a;return 0}function Qa(e,t){const a=String(e||"").toLowerCase(),n=a==="joboffer"?"job_offer":a,s=typeof t=="string"&&/^\d+$/.test(t)?Number(t):t,r=[n,n.replace(/_/g,"-"),n.replace(/-/g,"_")];return{type:n,id:s??t,favoritable_type:n,favoritable_id:s??t,item_type:n,item_id:s??t,entity_type:n,entity_id:s??t,target_type:n,target_id:s??t,kind:n,resource:n,model:n,name:n,type_variants:r}}function Ln(e,t){const a=Qa(e,t),n=a.id,s=[];s.push({type:a.type,id:n}),s.push({favoritable_type:a.favoritable_type,favoritable_id:n}),s.push({item_type:a.item_type,item_id:n}),s.push({entity_type:a.entity_type,entity_id:n}),s.push({target_type:a.target_type,target_id:n}),a.type==="job_offer"&&s.push({job_offer_id:n}),a.type==="classified"&&s.push({classified_id:n});const r=s.map(l=>({...l,toggle:1})),o=s.map(l=>({...l,action:"toggle"}));return[...r,...o,...s]}function jt(e={}){return fe(()=>H("/favorite",{query:e})).catch(async a=>{if((a==null?void 0:a.status)===404)return fe(()=>H("/favorites",{query:e}));throw a})}async function nt({type:e,id:t}){const a=Qa(e,t);try{const n=await fe(()=>H("/favorite/toggle",{method:"PUT",body:a}));return ye(n)}catch(n){if((n==null?void 0:n.status)===404||(n==null?void 0:n.status)===405)try{const s=await fe(()=>H("/favorite",{method:"PUT",body:a}));return ye(s)}catch(s){if((s==null?void 0:s.status)===404||(s==null?void 0:s.status)===405)try{const r=await fe(()=>H("/favorites/toggle",{method:"PUT",body:a}));return ye(r)}catch(r){if((r==null?void 0:r.status)===404||(r==null?void 0:r.status)===405){const o=Ln(e,t);for(const l of o){try{const i=await fe(()=>H("/favorite/toggle",{method:"GET",query:l}));return ye(i)}catch{}try{const i=await fe(()=>H("/favorites/toggle",{method:"GET",query:l}));return ye(i)}catch{}try{const i=await fe(()=>H("/favorite",{method:"GET",query:{...l}}));return ye(i)}catch{}try{const i=await fe(()=>H("/favorites",{method:"GET",query:{...l}}));return ye(i)}catch{}}try{const l=await fe(()=>H("/favorites",{method:"PUT",body:a}));return ye(l)}catch{try{const i=await fe(()=>H("/favorite",{method:"POST",body:a}));return ye(i)}catch{try{const c=await fe(()=>H("/favorites",{method:"POST",body:a}));return ye(c)}catch(c){throw c}}}}else throw r}else throw s}throw n}}async function fe(e){try{return await e()}catch(t){if((t==null?void 0:t.status)===401)try{try{localStorage.setItem("auth_mode","cookie"),localStorage.removeItem("auth_token")}catch{}return Te({mode:"cookie"}),pe(void 0),await e()}catch(a){throw a}throw t}}function ye(e){if(typeof e=="object"&&e){if("isFavorite"in e)return{isFavorite:!!e.isFavorite};if("favorited"in e)return{isFavorite:!!e.favorited};if("favorite"in e)return{isFavorite:!!e.favorite};if(typeof(e==null?void 0:e.data)=="object"&&e.data){const t=e.data;if("isFavorite"in t)return{isFavorite:!!t.isFavorite};if("favorited"in t)return{isFavorite:!!t.favorited};if("favorite"in t)return{isFavorite:!!t.favorite};if("status"in t&&(t.status==="added"||t.status==="removed"))return{isFavorite:t.status==="added"}}if("status"in e&&(e.status==="added"||e.status==="removed"))return{isFavorite:e.status==="added"}}return{isFavorite:!1}}async function ue(){try{return await H("/user")}catch{const t=Ie(),a=!!En();if(t==="bearer"&&!a)try{Te({mode:"cookie"}),pe(void 0);try{localStorage.setItem("auth_mode","cookie")}catch{}try{localStorage.removeItem("auth_token")}catch{}return await H("/user",{auth:"cookie"})}catch{Te({mode:"bearer"}),pe(void 0);try{localStorage.setItem("auth_mode","bearer")}catch{}throw Object.assign(new Error("AUTH_REQUIRED"),{status:401,code:"AUTH_REQUIRED"})}try{const n=await Ae("/user",{auth:t==="cookie"?void 0:"cookie"});if(t!=="cookie"){Te({mode:"cookie"}),pe(void 0);try{localStorage.setItem("auth_mode","cookie")}catch{}try{localStorage.removeItem("auth_token")}catch{}}return n}catch(n){if((n==null?void 0:n.status)===401){const r=new Error("AUTH_REQUIRED");throw r.status=401,r.code="AUTH_REQUIRED",r}const s=new Error("AUTH_REQUIRED");throw s.status=401,s.code="AUTH_REQUIRED",s}}}function ge(e={}){return H("/job-application",{query:e})}function Tn(e){return H(`/job-application/${e}`)}async function Xa(e){const t=new FormData;for(const[r,o]of Object.entries(e||{}))if(o!=null)if(r==="cv"&&o instanceof File){const l=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(o.size>5*1024*1024){const i=new Error("El archivo supera 5MB");throw i.code="FILE_TOO_LARGE",i}if(!l.includes(o.type)&&!/\.pdf$|\.doc$|\.docx$/i.test(o.name||"")){const i=new Error("Formato no permitido (solo PDF/DOC/DOCX)");throw i.code="FILE_INVALID_TYPE",i}t.append("cv",o),t.append("resume",o),t.append("curriculum",o)}else t.append(r,o);const a=(e==null?void 0:e.job_offer_id)||(e==null?void 0:e.jobOfferId)||(e==null?void 0:e.offer_id),n=["/job-application","/job-applications","/applications",a?`/job-offer/${a}/apply`:null,a?`/joboffers/${a}/apply`:null,a?`/job-offers/${a}/apply`:null].filter(Boolean);let s=null;for(const r of n)try{return await H(r,{method:"POST",body:t})}catch(o){if(s=o,(o==null?void 0:o.status)===422||(o==null?void 0:o.status)===401)throw o}throw s||new Error("No se pudo crear la postulación")}async function qn(e){var a;const t=[{path:"/job-application",query:{job_offer_id:e,me:1,per_page:1}},{path:"/job-applications",query:{job_offer_id:e,me:1,per_page:1}},{path:"/applications",query:{job_offer_id:e,me:1,per_page:1}},{path:"/job-application/check",query:{job_offer_id:e}}];for(const n of t)try{const s=await H(n.path,{query:n.query});if(typeof s=="boolean")return s;if((Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:[]).length>0)return!0;const o=((a=s==null?void 0:s.meta)==null?void 0:a.total)??(s==null?void 0:s.total);if(Number.isFinite(o))return o>0}catch{}try{const n=await ge({per_page:50,page:1});return(Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:[]).some(r=>String(r==null?void 0:r.job_offer_id)===String(e))}catch{return!1}}async function Ye(e={}){var n,s,r,o;const t=["/job-application/count","/job-applications/count","/applications/count"];let a=null;for(const l of t)try{const i=await H(l,{query:e}),c=typeof i=="number"?i:(i==null?void 0:i.total)??(i==null?void 0:i.count)??((n=i==null?void 0:i.data)==null?void 0:n.total);if(Number.isFinite(c))return c}catch(i){a=i}try{const l=await ge({...e,per_page:1,page:1}),i=((s=l==null?void 0:l.meta)==null?void 0:s.total)??(l==null?void 0:l.total);if(Number.isFinite(i))return i}catch(l){a=l}try{const l=[{per_page:1e3,page:1},{limit:1e3,page:1},{per_page:5e3,page:1}];for(const i of l){const c=await ge({...e,...i}),f=((r=c==null?void 0:c.meta)==null?void 0:r.total)??(c==null?void 0:c.total);if(Number.isFinite(f))return f;const d=Array.isArray(c)?c:Array.isArray(c==null?void 0:c.data)?c.data:[];if(d.length>0)return d.length}}catch(l){a=l}try{let l=1,i=0;const c=100,f=20;for(;l<=f;l++){const d=await ge({...e,per_page:c,page:l}),p=Array.isArray(d)?d:Array.isArray(d==null?void 0:d.data)?d.data:[];if(!p.length)break;i+=p.length;const m=((o=d==null?void 0:d.meta)==null?void 0:o.last_page)??(d==null?void 0:d.last_page);if(Number.isFinite(m)&&l>=m)break}if(i>0)return i}catch(l){a=l}if(a)throw a;return 0}async function st(e={}){const t=["/category","/categories"];let a=null;for(const n of t)try{const s=await H(n,{query:e});if(Array.isArray(s))return s;if(Array.isArray(s==null?void 0:s.data))return s.data;if(s&&typeof s=="object"){const r=Object.values(s);if(Array.isArray(r)&&r.length&&typeof r[0]=="object")return r}}catch(s){a=s}if(a)throw a;return[]}const Nn=["admin","administrator","administrador","administradora","superadmin","root"],In=["empresa","company","employer","recruiter","business","companyuser"],Mn=["unemployed","cesante","desempleado","desocupado","jobseeker","postulante","candidate"],qt={admin:"admin",administrator:"admin",administradora:"admin",administrador:"admin",administracion:"admin",superadmin:"admin",root:"admin",empresa:"company",company:"company",employer:"company",recruiter:"company",business:"company",companyuser:"company",compania:"company",corporate:"company",cesante:"unemployed",unemployed:"unemployed",desempleado:"unemployed",desocupado:"unemployed",jobseeker:"unemployed",postulante:"unemployed",candidate:"unemployed"};function Ya(e){if(!e)return"";const t=String(e).trim().toLowerCase();try{return t.normalize("NFD").replace(/[^a-z0-9]/g,"").replace(/[\u0300-\u036f]/g,"")}catch{return t.replace(/[^a-z0-9]/g,"")}}function On(e){var r,o,l,i;const t=[],a=new Set,n=c=>{if(c==null)return;if(Array.isArray(c)){c.forEach(n);return}if(typeof c=="object"){n(c==null?void 0:c.type),n(c==null?void 0:c.role),n(c==null?void 0:c.role_name),n(c==null?void 0:c.role_slug),n(c==null?void 0:c.slug),n(c==null?void 0:c.name),n(c==null?void 0:c.user_type),n(c==null?void 0:c.profile_type),Array.isArray(c==null?void 0:c.roles)?c.roles.forEach(n):c!=null&&c.roles&&typeof c.roles=="object"&&Object.values(c.roles).forEach(n);return}const f=String(c).trim().toLowerCase();f&&(a.has(f)||(a.add(f),t.push(f)))};return n(e==null?void 0:e.type),n(e==null?void 0:e.role),n(e==null?void 0:e.user_type),n(e==null?void 0:e.profile_type),n(e==null?void 0:e.role_name),n(e==null?void 0:e.role_slug),n((r=e==null?void 0:e.role)==null?void 0:r.name),n((o=e==null?void 0:e.role)==null?void 0:o.slug),n((l=e==null?void 0:e.role)==null?void 0:l.type),Array.isArray(e==null?void 0:e.roles)?e.roles.forEach(n):e!=null&&e.roles&&typeof e.roles=="object"&&Object.values(e.roles).forEach(n),Array.isArray(e==null?void 0:e.role_names)&&n(e.role_names),Array.isArray(e==null?void 0:e.permissions)&&n(e.permissions),[e==null?void 0:e.profile,(i=e==null?void 0:e.profile)==null?void 0:i.data,e==null?void 0:e.meta,e==null?void 0:e.metadata,e==null?void 0:e.details,e==null?void 0:e.account,e==null?void 0:e.user,e==null?void 0:e.primary_role].forEach(n),t}function Nt(e,t){return e.some(a=>t.some(n=>a.includes(n)))}function qe(e){if(!e)return null;const t=e.toLowerCase();if(qt[t])return qt[t];const a=Ya(e);return qt[a]||null}function Pn(){try{const e=[localStorage.getItem("display_role"),localStorage.getItem("pending_role"),localStorage.getItem("selected_role")].filter(Boolean),t=new Set;return e.forEach(a=>{const n=String(a).trim();if(!n)return;const s=n.toLowerCase();t.add(s);const r=qe(s)||qe(n);r&&t.add(r);const o=Ya(n);if(o&&o!==s){t.add(o);const l=qe(o);l&&t.add(l)}}),Array.from(t)}catch{return[]}}function Xt(e){if(e==null)return!1;const t=String(e).trim();return!(!t||t==="0"||t==="false")}function Yt(e,t=new WeakSet){return!e||typeof e!="object"||t.has(e)?!1:(t.add(e),Array.isArray(e)?e.length>0:[e.id,e.uuid,e.company_id,e.unemployed_id,e.profile_id].some(Xt)?!0:Object.values(e).some(n=>n==null?!1:typeof n=="object"?Yt(n,t):typeof n=="number"?n!==0:typeof n=="string"?n.trim().length>0:!!n))}function Za(e){var s,r,o,l,i,c,f;return!!([e==null?void 0:e.company,e==null?void 0:e.company_profile,(s=e==null?void 0:e.profile)==null?void 0:s.company,(r=e==null?void 0:e.meta)==null?void 0:r.company,(o=e==null?void 0:e.employment)==null?void 0:o.company].some(Yt)||[e==null?void 0:e.company_id,e==null?void 0:e.companyId,e==null?void 0:e.companyID,e==null?void 0:e.company_profile_id,(l=e==null?void 0:e.employment)==null?void 0:l.company_id,(i=e==null?void 0:e.company)==null?void 0:i.id,(c=e==null?void 0:e.company)==null?void 0:c.company_id,(f=e==null?void 0:e.company)==null?void 0:f.uuid].some(Xt)||[e==null?void 0:e.isCompany,e==null?void 0:e.is_company,e==null?void 0:e.has_company_profile,e==null?void 0:e.company_user,e==null?void 0:e.acts_as_company].some(Boolean))}function en(e){var s,r,o,l,i;return!!([e==null?void 0:e.unemployed,e==null?void 0:e.unemployed_profile,(s=e==null?void 0:e.profile)==null?void 0:s.unemployed,(r=e==null?void 0:e.meta)==null?void 0:r.unemployed].some(Yt)||[e==null?void 0:e.unemployed_id,e==null?void 0:e.unemployedId,e==null?void 0:e.unemployedID,(o=e==null?void 0:e.profile)==null?void 0:o.unemployed_id,(l=e==null?void 0:e.unemployed)==null?void 0:l.id,(i=e==null?void 0:e.unemployed)==null?void 0:i.uuid].some(Xt)||[e==null?void 0:e.isUnemployed,e==null?void 0:e.is_unemployed,e==null?void 0:e.acts_as_unemployed].some(Boolean))}function Dn(e,t){for(const r of t)if(qe(r)==="admin")return"admin";if((e==null?void 0:e.is_admin)===!0||(e==null?void 0:e.admin)===!0)return"admin";for(const r of t)if(qe(r)==="company")return"company";for(const r of t)if(qe(r)==="unemployed")return"unemployed";return Nt(t,Nn)?"admin":Za(e)||Nt(t,In)?"company":en(e)||Nt(t,Mn)?"unemployed":"guest"}function be(e){if(!e||typeof e!="object")return"guest";const t=On(e);return Dn(e,t)}function $t(e){return be(e)==="admin"}function rt(e){return be(e)==="company"}function We(e){return be(e)==="unemployed"}async function tn(e=!0){try{return await ue()}catch{if(e){const t=encodeURIComponent(location.pathname+location.search);location.assign(`/html/auth/login.html?redirect=${t}`)}throw new Error("AUTH_REQUIRED")}}async function ce(e,{onFail:t="redirect",redirectTo:a="/html/pages/home.html",alertMessage:n="No tienes permisos para acceder a esta sección."}={}){const s=Array.isArray(e)?e:String(e||"").split(/[\|,]/).map(f=>f.trim()).filter(Boolean),r=s.length?s:[String(e)||""],o=await tn(!0),l=be(o),i=new Set([l]);if(Za(o)&&i.add("company"),en(o)&&i.add("unemployed"),l==="admin"&&i.add("admin"),Pn().forEach(f=>{const d=qe(f)||f;d&&(d==="admin"&&i.add("admin"),(d==="company"||d==="empresa")&&i.add("company"),(d==="unemployed"||d==="cesante")&&i.add("unemployed"))}),!r.some(f=>{const d=String(f||"").trim().toLowerCase();return d?d==="admin"?i.has("admin"):d==="company"?i.has("company"):d==="unemployed"?i.has("unemployed"):d==="guest"?l==="guest":i.has(d):!1})){if(t==="redirect"){const f=new URL(a,location.origin);f.searchParams.set("error",n),location.assign(f.toString())}if(t==="throw")throw new Error("FORBIDDEN");return{user:o,allowed:!1}}return{user:o,allowed:!0}}const Un={company:new Set(["manage_offers","manage_applications","edit_company_profile"]),unemployed:new Set(["apply","manage_portfolio"]),admin:new Set(["admin","manage_all"])};function Fn(e,t){const a=be(e);return(Un[a]||new Set).has(t)}const Rn="/html/pages/landing.html";function Hn(){var e,t,a;try{if(typeof document<"u"){const n=((t=(e=document.body)==null?void 0:e.dataset)==null?void 0:t.landingUrl)||((a=document.querySelector("[data-landing-url]"))==null?void 0:a.getAttribute("data-landing-url"));if(n)return n}}catch(n){console.warn("No se pudo resolver URL personalizada de regreso",n)}return Rn}function S(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:s.startsWith("on")&&typeof r=="function"?n.addEventListener(s.slice(2).toLowerCase(),r):n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function It(e){return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:[]}function Bn(e){try{const t=new Date(e),a=Math.floor((Date.now()-t.getTime())/1e3);if(!Number.isFinite(a)||a<0)return String(e??"");if(a<60)return`hace ${a} ${a===1?"segundo":"segundos"}`;const n=Math.floor(a/60);if(n<60)return`hace ${n} ${n===1?"minuto":"minutos"}`;const s=Math.floor(n/60);if(s<24)return`hace ${s} ${s===1?"hora":"horas"}`;const r=Math.floor(s/24);if(r<7)return`hace ${r} ${r===1?"día":"días"}`;const o=Math.floor(r/7);if(r<30)return`hace ${o} ${o===1?"semana":"semanas"}`;const l=Math.floor(r/30);if(l<12)return`hace ${l} ${l===1?"mes":"meses"}`;const i=Math.floor(l/12);return`hace ${i} ${i===1?"año":"años"}`}catch{return String(e??"")}}function zn(e){const t=document.createElement("div");return t.innerHTML=e||"",t.textContent||t.innerText||""}function Vn(e,t){return e?String(e).length>t?String(e).slice(0,t-1)+"…":String(e):""}function Jn(e){e&&e.preventDefault();try{if(typeof window<"u"&&typeof history<"u"){const t=document.referrer;if(t&&t!==window.location.href&&history.length>1){history.back();return}}}catch(t){console.warn("No se pudo navegar atrás automáticamente",t)}typeof window<"u"&&(window.location.href=Hn())}function Gn(e,t,{isFavorite:a=!1,hasApplied:n=!1,isCompanyUser:s=!1,isUnemployedUser:r=!1,isAdminUser:o=!1,userCompanyId:l=null}={}){var E,C,$;const i=(e==null?void 0:e.id)??(e==null?void 0:e.uuid)??(e==null?void 0:e._id),c=(e==null?void 0:e.company_id)??(e==null?void 0:e.companyId)??((E=e==null?void 0:e.company)==null?void 0:E.id)??((C=e==null?void 0:e.company)==null?void 0:C.company_id)??null,f=c!=null?String(c):null,d=l!=null?String(l):null,p=o||s&&f&&d&&f===d,m=S("span",{class:"inline-flex items-center rounded-lg text-sm px-3 py-1 bg-blue-100 text-blue-800 border border-blue-200"},(e==null?void 0:e.offer_type)==="contract"?"Contrato":(e==null?void 0:e.offer_type)==="classified"?"Clasificado":(e==null?void 0:e.offer_type)||"Oferta"),y=i?S("a",{class:"mt-3 btn-primary text-white px-6 py-2 rounded-xl hover-lift transition-all duration-300 text-sm font-medium shadow-soft w-full flex items-center justify-center",href:`/html/job-offers/show.html?id=${encodeURIComponent(i)}`},"Ver Detalles"):null,g=r&&i?S("button",{class:["favorite-btn mb-4 w-full h-12 rounded-xl flex items-center justify-center transition-all duration-300",a?"bg-red-100 text-red-600 border-2 border-red-300":"bg-white text-gray-400 border-2 border-gray-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200"].join(" ")},S("i",{class:"fas fa-heart text-xl mr-2"}),S("span",{},a?"Guardado":"Guardar")):null;g&&g.addEventListener("click",async v=>{var x;v.preventDefault(),g.style.opacity="0.6",g.style.pointerEvents="none";try{const M=await nt({type:"joboffer",id:i}),k=!!(M!=null&&M.isFavorite);g.classList.toggle("bg-red-100",k),g.classList.toggle("text-red-600",k),g.classList.toggle("border-red-300",k),g.classList.toggle("bg-white",!k),g.classList.toggle("text-gray-400",!k),g.classList.toggle("border-gray-200",!k),g.classList.toggle("hover:bg-red-50",!k),g.classList.toggle("hover:text-red-500",!k),g.classList.toggle("hover:border-red-200",!k);const q=g.querySelector("span");q&&(q.textContent=k?"Guardado":"Guardar")}catch(M){alert(((x=M==null?void 0:M.data)==null?void 0:x.message)||"No se pudo cambiar favorito")}finally{g.style.opacity="1",g.style.pointerEvents="auto"}});let h;return h=S("article",{class:"card-surface rounded-3xl overflow-hidden p-0"},S("div",{class:"flex flex-col md:flex-row"},S("div",{class:"flex-1 p-6"},S("div",{class:"flex items-start justify-between mb-4"},S("div",{class:"flex-1"},S("h3",{class:"text-2xl font-bold text-gray-900 mb-3"},i?S("a",{class:"hover:text-blue-700 transition-colors group inline-flex items-center",href:`/html/job-offers/show.html?id=${encodeURIComponent(i)}`},(e==null?void 0:e.title)??"Oferta sin título",S("i",{class:"fas fa-arrow-right ml-2 text-blue-700 opacity-0 group-hover:opacity-100 transition-all duration-200 transform translate-x-0 group-hover:translate-x-1"})):(e==null?void 0:e.title)??"Oferta sin título"),S("div",{class:"flex items-center mb-4"},S("div",{class:"w-14 h-14 gradient-primary rounded-xl flex items-center justify-center mr-3"},S("i",{class:"fas fa-building text-white text-xl"})),S("div",{},S("p",{class:"text-gray-800 font-semibold text-lg"},(($=e==null?void 0:e.company)==null?void 0:$.name)??(e==null?void 0:e.company_name)??"Empresa"),S("p",{class:"text-sm text-gray-500 flex items-center"},S("i",{class:"fas fa-check-circle text-green-600 mr-1"}),"Empresa verificada")))),S("div",{class:"ml-4"},m)),S("div",{class:"flex flex-wrap items-center gap-4 mb-4"},e!=null&&e.location?S("div",{class:"flex items-center text-gray-700 bg-gray-50 px-3 py-2 rounded-lg"},S("i",{class:"fas fa-map-marker-alt text-blue-600 mr-2"}),S("span",{class:"font-medium"},e.location)):null,e!=null&&e.geolocation?S("div",{class:"flex items-center text-gray-600 bg-blue-50 px-3 py-2 rounded-lg"},S("i",{class:"fas fa-globe text-blue-600 mr-2"}),S("span",{class:"text-sm"},"Ver en mapa")):null,e!=null&&e.created_at?S("div",{class:"flex items-center text-gray-600 bg-gray-50 px-3 py-2 rounded-lg"},S("i",{class:"fas fa-clock text-gray-500 mr-2"}),S("span",{class:"text-sm",title:String(e.created_at)},Bn(e.created_at))):null),S("div",{class:"mb-4"},Array.isArray(e==null?void 0:e.categories)?e.categories.map(v=>S("span",{class:"inline-block mr-2 mb-2 bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800 border border-blue-200 rounded px-2 py-1 text-xs"},S("i",{class:"fas fa-tag mr-1"}),(v==null?void 0:v.name)||String(v))):null),(function(){const v=(e==null?void 0:e.description)||(e==null?void 0:e.details)||(e==null?void 0:e.summary)||"",x=Vn(zn(v),240);return x?S("p",{class:"text-gray-600 leading-relaxed"},x):null})()),S("div",{class:"md:w-64 bg-gradient-to-br from-gray-50 to-blue-50 p-6 flex flex-col justify-between border-l border-gray-100"},S("div",{},g,S("div",{class:"bg-white rounded-xl p-4 mb-4 shadow-sm border border-gray-200"},S("p",{class:"text-xs text-gray-500 mb-1 uppercase tracking-wide font-semibold"},"Salario Ofrecido"),S("p",{class:"text-2xl font-bold text-gray-900 mb-2"},(e==null?void 0:e.salary_formatted)||(e==null?void 0:e.salary)||"A convenir"),S("div",{class:"flex items-center text-xs text-gray-500"},S("i",{class:"fas fa-info-circle mr-1"}),"Según experiencia")),n?S("div",{class:"rounded-lg border border-green-200 bg-green-50 text-green-700 px-3 py-2 text-sm"},S("i",{class:"fas fa-check mr-2"}),"Ya aplicaste a esta oferta"):null),S("div",{},p?S("div",{class:"space-y-2"},S("a",{class:"w-full inline-flex items-center justify-center px-4 py-2 rounded-xl border text-sm bg-white hover:bg-gray-50",href:`/html/job-offers/edit.html?id=${encodeURIComponent(i)}`},S("i",{class:"fas fa-edit mr-2"}),"Editar"),S("button",{class:"w-full inline-flex items-center justify-center px-4 py-2 rounded-xl text-sm bg-red-600 text-white hover:bg-red-700",onclick:async()=>{var v;if(confirm("¿Estás seguro que deseas eliminar esta oferta laboral?"))try{await $n(i),h!=null&&h.remove&&h.remove()}catch(x){alert(((v=x==null?void 0:x.data)==null?void 0:v.message)||"No se pudo eliminar la oferta")}}},S("i",{class:"fas fa-trash mr-2"}),"Eliminar")):n?null:y)))),h}function Wn({icon:e,label:t,metricKey:a}){return S("div",{class:"metric-summary-row"},S("span",{class:"metric-summary-label"},t),S("div",{class:"flex items-center gap-3"},S("span",{class:"metric-summary-value","data-metric":a},"--"),S("span",{class:"metric-summary-icon"},S("i",{class:e}))))}function fa(e,{isCompanyUser:t,isUnemployedUser:a}){e.innerHTML="",e.appendChild(S("p",{class:"metric-summary-title"},"Resumen rápido"));const n={},s=({icon:r,label:o,metricKey:l,mapKey:i})=>{const c=Wn({icon:r,label:o,metricKey:l});e.appendChild(c);const f=c.querySelector(`[data-metric="${l}"]`);f&&(n[i]=f)};return t&&!a?(s({icon:"fas fa-briefcase",label:"Ofertas publicadas",metricKey:"company-total",mapKey:"companyOffers"}),s({icon:"fas fa-bullhorn",label:"Ofertas activas",metricKey:"company-active",mapKey:"companyActive"}),s({icon:"fas fa-users",label:"Postulaciones recibidas",metricKey:"company-applications",mapKey:"companyApplications"})):(s({icon:"fas fa-briefcase",label:"Ofertas activas",metricKey:"offers-total",mapKey:"offers"}),s({icon:"fas fa-heart",label:"Favoritos guardados",metricKey:"favorites-total",mapKey:"favorites"}),s({icon:"fas fa-paper-plane",label:"Postulaciones",metricKey:"applications-total",mapKey:"applications"})),n}function et(e={}){const t={},a=(n,s)=>{if(s==null)return;const r=String(s).trim();r&&(t[n]=r)};return a("location",e.location),a("category_id",e.category_id),a("search",e.search),t}function Kn(){try{const e=new URLSearchParams(window.location.search);return et({location:e.get("location"),category_id:e.get("category_id"),search:e.get("search")})}catch{return{}}}function ma(e={}){try{const t=new URLSearchParams;e.location&&t.set("location",e.location),e.category_id&&t.set("category_id",e.category_id),e.search&&t.set("search",e.search);const a=t.toString(),n=a?`${window.location.pathname}?${a}`:window.location.pathname;window.history.replaceState({},"",n)}catch(t){console.warn("No se pudieron sincronizar los filtros en la URL",t)}}function Qn(e,t){if(!t)return"Todas";try{const n=(Array.isArray(e)?e:[]).find(s=>String((s==null?void 0:s.id)??(s==null?void 0:s.value)??(s==null?void 0:s.category_id))===String(t));return(n==null?void 0:n.name)||(n==null?void 0:n.title)||(n==null?void 0:n.label)||`ID ${t}`}catch{return String(t)}}function pa(e,t,a,n){if(!e)return;e.innerHTML="";const s=S("form",{class:"space-y-6"},S("div",{class:"flex flex-wrap items-center gap-3"},S("span",{class:"px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-sm inline-flex items-center gap-2"},S("i",{class:"fas fa-filter"}),"Filtrado inteligente"),t.location?S("span",{class:"px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-sm"},`Ubicación: ${t.location}`):null,t.category_id?S("span",{class:"px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 text-sm"},`Categoría: ${Qn(a,t.category_id)}`):null,t.search?S("span",{class:"px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-sm"},`Buscar: ${t.search}`):null,t.location||t.category_id||t.search?S("button",{type:"button",class:"text-sm text-gray-500 hover:text-gray-700 underline",onclick:r=>{r.preventDefault(),n(et({}))}},"Limpiar filtros"):null),S("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-4"},S("div",{class:"col-span-1"},S("label",{for:"job-offers-filter-location",class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},S("i",{class:"fas fa-location-dot text-blue-600"}),"Ubicación"),S("input",{type:"text",id:"job-offers-filter-location",name:"location",value:t.location||"",placeholder:"Ciudad, país o remoto",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})),S("div",{class:"col-span-1"},S("label",{for:"job-offers-filter-category",class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},S("i",{class:"fas fa-tags text-purple-500"}),"Categoría"),S("select",{id:"job-offers-filter-category",name:"category_id",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},S("option",{value:""},"Todas las categorías"),...(Array.isArray(a)?a:[]).map(r=>S("option",{value:String((r==null?void 0:r.id)??(r==null?void 0:r.value)??""),selected:t.category_id&&String(t.category_id)===String((r==null?void 0:r.id)??(r==null?void 0:r.value)??"")?"selected":void 0},(r==null?void 0:r.name)||(r==null?void 0:r.title)||(r==null?void 0:r.label)||"Categoría")))),S("div",{class:"col-span-1"},S("label",{for:"job-offers-filter-search",class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},S("i",{class:"fas fa-magnifying-glass text-blue-500"}),"Palabras clave"),S("input",{type:"text",id:"job-offers-filter-search",name:"search",value:t.search||"",placeholder:"Título, empresa o palabras clave",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})),S("div",{class:"col-span-1 flex items-end"},S("button",{type:"submit",class:"w-full btn-primary inline-flex items-center justify-center gap-2 text-white px-5 py-3 rounded-xl font-semibold transition"},S("i",{class:"fas fa-search"}),"Buscar ofertas"))));s.addEventListener("submit",r=>{r.preventDefault();const o=new FormData(s),l=et({location:o.get("location"),category_id:o.get("category_id"),search:o.get("search")});n(l)}),e.appendChild(s)}async function Xn(e){var m,y,g,h,E,C,$,v;if(!e)return;e.innerHTML="",e.className="page-shell";const t=S("div",{class:"metric-summary",id:"jobOffersMetricSummary"},S("p",{class:"metric-summary-title"},"Resumen rápido")),a=S("section",{class:"page-hero gradient-primary text-white shadow-card"},S("div",{class:"page-hero-content"},S("div",{class:"space-y-6"},S("div",{class:"flex items-center"},S("button",{type:"button",class:"inline-flex items-center gap-2 text-white/80 hover:text-white text-sm font-semibold transition",onclick:Jn},S("i",{class:"fas fa-arrow-left text-xs"}),"Volver")),S("div",{class:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 border border-white/30 text-white/80 text-xs uppercase tracking-[0.25em]"},S("i",{class:"fas fa-rocket-launch"}),"Encuentra tu próximo reto"),S("div",{class:"space-y-3"},S("h1",{class:"text-3xl md:text-5xl font-bold leading-tight text-white"},"Ofertas laborales curadas para ti"),S("p",{class:"text-white/85 text-base md:text-lg max-w-2xl"},"Filtra, guarda y postula con una experiencia diseñada para concentrarte en lo importante: conectar con oportunidades reales.")),S("div",{class:"flex flex-wrap items-center gap-3",id:"jobOffersHeaderActions"})),S("div",{class:"w-full max-w-sm"},t)));e.appendChild(a);let n={};const s=(x,M)=>{const k=n[x];if(!k)return;if(M==null||M===""){k.textContent="--";return}const q=Number(M);k.textContent=Number.isFinite(q)?q.toLocaleString():String(M)};n=fa(t,{isCompanyUser:!1,isUnemployedUser:!0});async function r(x){if(!x)return;let M=null,k=null,q=null,j=[];try{const b=await Ce({company_id:x});Number.isFinite(b)&&(M=b)}catch(b){console.warn("No se pudo obtener el total de ofertas de la empresa",b)}try{const b=await Ce({company_id:x,status:"active"});Number.isFinite(b)&&(k=b)}catch(b){console.warn("No se pudo obtener el total de ofertas activas de la empresa",b)}try{const b=await xe({company_id:x,per_page:100,page:1});if(j=It(b),Number.isFinite(M)||(M=j.length),!Number.isFinite(k)){const w=["active","activo","publicado","published","vigente","open"];k=j.filter(O=>{const P=((O==null?void 0:O.status)||(O==null?void 0:O.state)||"").toString().toLowerCase();return P?w.includes(P):!0}).length}}catch(b){console.warn("No se pudieron listar las ofertas de la empresa",b)}if(!Number.isFinite(q))try{const b=await Ye({company_id:x});Number.isFinite(b)&&(q=b)}catch(b){console.warn("No se pudieron contar postulaciones por empresa",b)}if(!Number.isFinite(q)&&j.length){const b=j.map(w=>(w==null?void 0:w.id)??(w==null?void 0:w.uuid)??(w==null?void 0:w._id)).filter(Boolean);if(b.length){try{const w=await Ye({job_offer_ids:b.join(",")});Number.isFinite(w)&&(q=w)}catch(w){console.warn("No se pudieron contar postulaciones agrupadas por oferta",w)}if(!Number.isFinite(q)){let w=0;const O=b.slice(0,10);for(const P of O)try{const D=await Ye({job_offer_id:P});if(Number.isFinite(D))w+=D;else{const R=await ge({job_offer_id:P,per_page:100,page:1});w+=It(R).length}}catch(D){console.warn(`No se pudieron contar postulaciones para la oferta ${P}`,D)}q=w}}}!Number.isFinite(q)&&Number.isFinite(M)&&M===0&&(q=0),Number.isFinite(M)&&s("companyOffers",M),Number.isFinite(k)&&s("companyActive",k),Number.isFinite(q)&&s("companyApplications",q)}const o=S("section",{class:"page-section space-y-8"}),l=S("div",{class:"card-surface rounded-3xl p-6 shadow-soft"});o.appendChild(l);const i=S("div",{class:"grid grid-cols-1 gap-6"});o.appendChild(i);const c=S("p",{class:"text-slate-500"},"Cargando ofertas...");c.style.display="block",o.appendChild(c);const f=S("div",{class:"mt-8 flex justify-center",style:"display:none;"}),d=S("button",{class:"px-6 py-3 rounded-xl bg-white border shadow-sm hover:bg-gray-50 text-sm font-medium"},"Cargar más");f.appendChild(d),o.appendChild(f),e.appendChild(o);const p="data-empty-state";try{let bn=function(V=1){const B={page:V,per_page:Ee,limit:Ee};if(re.location){const z=re.location;B.location=z,B.city=z,B["filter[location]"]=z}if(re.category_id){const z=re.category_id;B.category_id=z,B.category=z,B["filter[category]"]=z,B["filter[category_id]"]=z}if(re.search){const z=re.search;B.search=z,B.q=z,B.keyword=z,B.keywords=z}return B},vn=function(){const V=o.querySelector(`[${p}="job-offers"]`);V&&V.remove()},wn=function(){const V=S("div",{class:"card-surface rounded-3xl p-12 text-center space-y-4",[p]:"job-offers"},S("div",{class:"w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto"},S("i",{class:"fas fa-briefcase text-3xl text-blue-600"})),S("h3",{class:"text-xl font-semibold text-slate-900"},"No se encontraron ofertas"),S("p",{class:"text-slate-600"},"Actualmente no hay ofertas de trabajo disponibles que coincidan con tus criterios. Guarda esta vista y vuelve a intentarlo más tarde."),M?S("a",{href:"/html/job-offers/create.html",class:"btn-primary text-white px-6 py-3 rounded-xl hover-lift inline-flex items-center justify-center"},S("i",{class:"fas fa-plus mr-2"}),"Publicar Primera Oferta"):S("button",{class:"btn-secondary text-white px-6 py-3 rounded-xl hover-lift inline-flex items-center justify-center",onclick:()=>location.reload()},S("i",{class:"fas fa-refresh mr-2"}),"Actualizar lista"));o.insertBefore(V,f),f.style.display="none",s("offers",0)},na=function(V){for(const B of V){const z=(B==null?void 0:B.id)??(B==null?void 0:B.uuid)??(B==null?void 0:B._id),ne=Gn(B,x,{isFavorite:R.has(String(z)),hasApplied:X.has(String(z)),isCompanyUser:M,isUnemployedUser:b,isAdminUser:w,userCompanyId:O});i.appendChild(ne)}},Tt=function(){const V=Ke<aa;f.style.display=V&&i.childElementCount?"flex":"none"},oa=function(V){const B=et(V);(re.location||"")===(B.location||"")&&(re.category_id||"")===(B.category_id||"")&&(re.search||"")===(B.search||"")||(re=B,ma(re),pa(l,re,de,oa),s("offers","--"),ra().catch(ne=>console.warn("No se pudo recargar ofertas",ne)))},x=null;try{x=await ue()}catch(V){console.warn("No se pudo obtener el usuario actual",V)}const M=rt(x),k=(localStorage.getItem("display_role")||localStorage.getItem("selected_role")||localStorage.getItem("pending_role")||"").toLowerCase(),q=["unemployed","cesante","desempleado","postulante","candidate","jobseeker"].includes(k),j=!!((m=x==null?void 0:x.unemployed)!=null&&m.id||x!=null&&x.unemployed_id||(g=(y=x==null?void 0:x.profile)==null?void 0:y.unemployed)!=null&&g.id),b=We(x)||j||q,w=$t(x),O=((h=x==null?void 0:x.company)==null?void 0:h.id)??(x==null?void 0:x.company_id)??(x==null?void 0:x.companyId)??null;n=fa(t,{isCompanyUser:M,isUnemployedUser:b}),Object.values(n).forEach(V=>{V&&(V.textContent="--")});let P=null;M&&O!=null&&(P=r(O));const D=document.getElementById("jobOffersHeaderActions");D&&(D.innerHTML="",b&&D.appendChild(S("a",{href:"/html/favorites/index.html",class:"btn-secondary text-white px-4 py-2 rounded-xl inline-flex items-center"},S("i",{class:"fas fa-heart mr-2"}),"Mis Favoritos")),M&&D.appendChild(S("a",{href:"/html/job-offers/create.html",class:"btn-primary text-white px-4 py-2 rounded-xl inline-flex items-center"},S("i",{class:"fas fa-plus mr-2"}),"Crear Nueva Oferta")));const R=new Set;if(b)try{const V=await jt({type:"joboffer",per_page:100,page:1}),B=Array.isArray(V)?V:Array.isArray(V==null?void 0:V.data)?V.data:[];for(const z of B){const ne=(z==null?void 0:z.favoritable_id)??(z==null?void 0:z.job_offer_id)??(z==null?void 0:z.id)??((E=z==null?void 0:z.favoritable)==null?void 0:E.id);ne!=null&&R.add(String(ne))}s("favorites",R.size)}catch(V){console.warn("No se pudieron cargar favoritos del usuario",V)}const X=new Set;if(b)try{const V={per_page:100,page:1};(C=x==null?void 0:x.unemployed)!=null&&C.id&&(V.unemployed_id=x.unemployed.id);const B=await ge(V),z=Array.isArray(B)?B:Array.isArray(B==null?void 0:B.data)?B.data:[];for(const ne of z){const ot=(ne==null?void 0:ne.job_offer_id)??(ne==null?void 0:ne.jobOfferId)??(($=ne==null?void 0:ne.job_offer)==null?void 0:$.id);ot!=null&&X.add(String(ot))}s("applications",X.size)}catch(V){console.warn("No se pudieron cargar postulaciones del usuario",V)}P&&P.catch(()=>{});let de=[];try{const V=await st({per_page:100,page:1});de=Array.isArray(V)?V:Array.isArray(V==null?void 0:V.data)?V.data:[]}catch(V){console.warn("No se pudieron cargar categorías",V)}let re=et(Kn());ma(re);const Ee=10;let Ke=1,aa=1;async function sa(V=1){var la,ca,da;const B=bn(V),z=await xe(B),ne=It(z);Ke=Number(((la=z==null?void 0:z.meta)==null?void 0:la.current_page)??(z==null?void 0:z.current_page)??V);const ot=ne.length<Ee?V:V+1;aa=Number(((ca=z==null?void 0:z.meta)==null?void 0:ca.last_page)??(z==null?void 0:z.last_page)??ot);const ia=((da=z==null?void 0:z.meta)==null?void 0:da.total)??(z==null?void 0:z.total)??null,Sn=(Ke-1)*Ee+ne.length,Cn=ia??(ne.length===0&&Ke===1?0:Sn||"--");return s("offers",Cn),ne}async function ra(){var V;vn(),i.innerHTML="",c.textContent="Buscando ofertas...",c.style.display="block",f.style.display="none";try{const B=await sa(1);if(!B.length){c.style.display="none",wn(),Tt();return}c.style.display="none",na(B),Tt()}catch(B){console.error("Error recargando ofertas",B),c.textContent=`Error cargando ofertas: ${((V=B==null?void 0:B.data)==null?void 0:V.message)||B.message}`,c.style.display="block"}}pa(l,re,de,oa),await ra(),d.addEventListener("click",async()=>{var V;d.disabled=!0,d.textContent="Cargando...";try{const B=await sa(Ke+1);B.length&&na(B)}catch(B){alert(((V=B==null?void 0:B.data)==null?void 0:V.message)||"No se pudo cargar más ofertas")}finally{d.disabled=!1,d.textContent="Cargar más",Tt()}})}catch(x){console.error("Error cargando ofertas",x),c.textContent=`Error cargando ofertas: ${((v=x==null?void 0:x.data)==null?void 0:v.message)||x.message}`,c.style.display="block"}}function Yn(){const e=document.querySelector('[data-page="job-offers"]');e&&Xn(e)}function N(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:s.startsWith("on")&&typeof r=="function"?n.addEventListener(s.slice(2).toLowerCase(),r):n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Zn(){return new URL(window.location.href).searchParams.get("id")}async function es(e,t){var n,s,r,o,l,i,c,f;if(!e)return;e.innerHTML="";const a=N("p",{class:"text-slate-500"},"Cargando oferta...");e.appendChild(a);try{const d=t||e.getAttribute("data-id")||Zn();if(!d){a.textContent="Falta el parámetro id (?id=123)";return}const p=await Ka(d);a.remove();const m=(p==null?void 0:p.data)??p;let y=null,g=!1,h=!1,E=!1;try{y=await ue()}catch{}h=y?rt(y):!1,g=y?We(y)||Fn(y,"apply"):!1;const C=(n=y==null?void 0:y.company)==null?void 0:n.id,$=m==null?void 0:m.company_id;h&&C!=null&&$!=null&&(E=String($)===String(C));const v=N("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-8"}),x=N("div",{class:"lg:col-span-2"}),M=N("div",{class:"lg:col-span-1"});v.appendChild(x),v.appendChild(M),e.appendChild(v);const k=N("div",{class:"bg-white rounded-lg shadow-sm p-6 mb-6 border border-blue-900/30"},N("div",{class:"flex justify-between items-start mb-6"},N("div",{class:"flex-1"},N("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},(m==null?void 0:m.title)??`Oferta #${d}`),N("div",{class:"flex items-center text-gray-600 mb-2"},N("i",{class:"fas fa-building w-5 text-center mr-2"}),N("span",{class:"text-lg font-semibold"},((s=m==null?void 0:m.company)==null?void 0:s.name)||"Empresa")),m!=null&&m.location?N("div",{class:"flex items-center text-gray-500"},N("i",{class:"fas fa-map-marker-alt w-5 text-center mr-2"}),N("span",{},m.location)):null),N("div",{class:"flex flex-col items-end space-y-2"},g?N("button",{class:"favorite-btn w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 hover-lift border bg-gray-100 text-gray-400 border-gray-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200",onclick:async j=>{var w;const b=j.currentTarget;b.style.opacity="0.6",b.style.pointerEvents="none";try{const P=!!(await nt({type:"joboffer",id:d})).isFavorite;b.classList.toggle("bg-red-100",P),b.classList.toggle("text-red-600",P),b.classList.toggle("border-red-200",P),b.classList.toggle("bg-gray-100",!P),b.classList.toggle("text-gray-400",!P),b.classList.toggle("border-gray-200",!P)}catch(O){alert(((w=O==null?void 0:O.data)==null?void 0:w.message)||"No se pudo cambiar favorito")}finally{b.style.opacity="1",b.style.pointerEvents="auto"}}},N("i",{class:"fas fa-heart text-lg"})):null,E?N("div",{class:"flex space-x-2"},N("a",{href:`/html/job-offers/edit.html?id=${encodeURIComponent(d)}`,class:"bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors"},"Editar"),N("a",{href:"/html/job-offers/index.html",class:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"},"Eliminar")):null)),Array.isArray(m==null?void 0:m.categories)&&m.categories.length?N("div",{class:"mb-6"},N("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Categorías"),N("div",{class:"flex flex-wrap gap-2"},m.categories.map(j=>N("span",{class:"inline-block bg-blue-100 text-blue-800 rounded-full px-3 py-1 text-sm font-semibold"},(j==null?void 0:j.name)||String((j==null?void 0:j.id)||j))))):null,N("div",{class:"mb-6"},N("h3",{class:"text-lg font-semibold text-gray-800 mb-3"},"Descripción del puesto"),N("div",{class:"prose max-w-none text-gray-700 whitespace-pre-wrap"},(m==null?void 0:m.description)||"Sin descripción")),N("div",{class:"mb-6"},N("div",{class:"flex items-center justify-between mb-3"},N("h3",{class:"text-lg font-semibold text-gray-800"},"Ubicación"),N("button",{class:"flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-300 shadow-sm",onclick:()=>as(m)},N("i",{class:"fas fa-expand-arrows-alt"}),N("span",{class:"text-sm font-medium"},"Ampliar Mapa"))),N("div",{id:"map",class:"w-full h-64 rounded-lg border-2 border-gray-200 shadow-sm"})));x.appendChild(k);const q=N("div",{},N("div",{class:"bg-white rounded-lg shadow-sm p-6 mb-6 border border-blue-900/30"},N("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Información de la empresa"),N("div",{class:"space-y-3"},N("div",{},N("span",{class:"font-medium text-gray-700"},"Empresa:"),N("p",{class:"text-gray-600"},((r=m==null?void 0:m.company)==null?void 0:r.name)||"")),(o=m==null?void 0:m.company)!=null&&o.business_name?N("div",{},N("span",{class:"font-medium text-gray-700"},"Razón social:"),N("p",{class:"text-gray-600"},m.company.business_name)):null,(l=m==null?void 0:m.company)!=null&&l.description?N("div",{},N("span",{class:"font-medium text-gray-700"},"Descripción:"),N("p",{class:"text-gray-600"},String(m.company.description).slice(0,150))):null,(i=m==null?void 0:m.company)!=null&&i.website?N("div",{},N("span",{class:"font-medium text-gray-700"},"Sitio web:"),N("a",{href:m.company.website,target:"_blank",class:"text-blue-600 hover:text-blue-800 break-all"},m.company.website)):null)),N("div",{class:"bg-white rounded-lg shadow-sm p-6 mb-6 border border-blue-900/30"},N("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Detalles del trabajo"),N("div",{class:"space-y-3"},N("div",{class:"flex justify-between"},N("span",{class:"font-medium text-gray-700"},"Salario:"),N("span",{class:"text-green-600 font-semibold"},(m==null?void 0:m.salary_formatted)||(m!=null&&m.salary?String(m.salary):"A convenir"))),m!=null&&m.location?N("div",{class:"flex justify-between"},N("span",{class:"font-medium text-gray-700"},"Ubicación:"),N("span",{class:"text-gray-600"},m.location)):null)));if(M.appendChild(q),y){if(g){let j=!1;try{j=await qn(d)}catch{}const b=N("div",{class:"bg-white rounded-lg shadow-sm p-6 border border-blue-900/30"},N("h3",{class:"text-lg font-semibold text-gray-800 mb-3"},"Aplicar a esta oferta"),j?N("div",{class:"rounded-lg p-4 bg-green-50 border border-green-200 text-green-700"},N("i",{class:"fas fa-check mr-2"}),"Ya has postulado a esta oferta."):N("form",{class:"space-y-3",onsubmit:async w=>{var R;w.preventDefault();const O=new FormData(w.currentTarget),P=O.get("message"),D=O.get("cv");try{if(D&&D.size>5*1024*1024)throw Object.assign(new Error("El archivo supera 5MB"),{status:422});await Xa({job_offer_id:d,message:P,cv:D}),w.currentTarget.replaceWith(N("div",{class:"rounded-lg p-4 bg-green-50 border border-green-200 text-green-700"},N("i",{class:"fas fa-check mr-2"}),"Postulación enviada."))}catch(X){const de=((R=X==null?void 0:X.data)==null?void 0:R.message)||((X==null?void 0:X.status)===401?"Debes iniciar sesión para postular.":X==null?void 0:X.message)||"No se pudo enviar la postulación";alert(de)}}},N("div",{},N("label",{class:"block text-sm font-medium text-gray-700",for:"message"},"Mensaje (opcional)"),N("textarea",{name:"message",id:"message",rows:3,maxlength:2e3,class:"mt-1 block w-full border border-gray-200 rounded-md px-3 py-2"})),N("div",{},N("label",{class:"block text-sm font-medium text-gray-700",for:"cv"},"CV (opcional, PDF/DOC/DOCX, máx. 5MB)"),N("input",{type:"file",name:"cv",id:"cv",accept:".pdf,.doc,.docx",class:"mt-1 block w-full border border-gray-200 rounded px-2 py-1"})),N("button",{type:"submit",class:"w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-semibold"},"Postularme a esta oferta")));M.appendChild(b)}}else{const j=N("div",{class:"bg-white rounded-lg shadow-sm p-6 border border-blue-900/30"},N("h3",{class:"text-lg font-semibold text-gray-800 mb-3"},"¿Quieres postular a esta oferta?"),N("p",{class:"text-gray-600 mb-4"},"Inicia sesión o crea tu cuenta como cesante para postularte."),N("div",{class:"flex gap-3"},N("a",{href:`/html/auth/login.html?redirect=${encodeURIComponent(location.pathname+location.search)}`,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700"},"Iniciar sesión"),N("a",{href:"/html/auth/register.html",class:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-800"},"Crear cuenta")));M.appendChild(j)}try{const j=typeof L<"u",b=document.getElementById("map");if(j&&b){let w=2.4448,O=-76.6147;if(m!=null&&m.geolocation&&typeof m.geolocation=="string"){const R=m.geolocation.split(","),X=parseFloat(R[0]),de=parseFloat(R[1]);!Number.isNaN(X)&&!Number.isNaN(de)&&X!==0&&de!==0&&(w=X,O=de)}const P=L.map(b).setView([w,O],15);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(P),L.marker([w,O]).addTo(P).bindPopup(`<div class="p-2"><h3 class="font-semibold text-gray-800">${(m==null?void 0:m.title)||""}</h3><p class="text-gray-600">${((c=m==null?void 0:m.company)==null?void 0:c.name)||""}</p><p class="text-sm text-gray-500">${(m==null?void 0:m.location)||""}</p><p class="text-xs text-blue-500">Coords: ${w.toFixed(6)}, ${O.toFixed(6)}</p></div>`).openPopup()}}catch{}}catch(d){a.textContent=`Error cargando oferta: ${((f=d==null?void 0:d.data)==null?void 0:f.message)||d.message}`}}function ts(){const e=document.querySelector('[data-page="job-offer-detail"]');e&&es(e)}function as(e){var n;const t=(()=>{let s=2.4448,r=-76.6147;if(e!=null&&e.geolocation&&typeof e.geolocation=="string"){const o=e.geolocation.split(","),l=parseFloat(o[0]),i=parseFloat(o[1]);!Number.isNaN(l)&&!Number.isNaN(i)&&l!==0&&i!==0&&(s=l,r=i)}return{lat:s,lng:r}})();let a=document.getElementById("job-offer-map-modal");a||(a=document.createElement("div"),a.id="job-offer-map-modal",a.className="fixed inset-0 z-[9999] hidden",a.innerHTML=`
      <div class="absolute inset-0 bg-black/70"></div>
      <div class="relative min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl">
          <div class="px-6 py-4 border-b flex items-center justify-between">
            <div>
              <h3 class="text-xl font-bold">${(e==null?void 0:e.title)||"Ubicación"}</h3>
              <p class="text-sm text-gray-500">${((n=e==null?void 0:e.company)==null?void 0:n.name)||""}</p>
            </div>
            <button data-close class="text-gray-600 hover:bg-gray-100 rounded-lg p-2"><i class="fas fa-times text-xl"></i></button>
          </div>
          <div class="p-6">
            <div id="job-offer-modal-map" class="w-full h-[600px] rounded-xl border"></div>
          </div>
          <div class="px-6 py-4 border-t flex justify-end">
            <button data-close class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg">Cerrar</button>
          </div>
        </div>
      </div>`,document.body.appendChild(a),a.addEventListener("click",s=>{(s.target===a||s.target.closest("[data-close]"))&&(a.classList.add("hidden"),document.body.style.overflow="auto")})),a.classList.remove("hidden"),document.body.style.overflow="hidden";try{if(typeof L>"u")return;const s=document.getElementById("job-offer-modal-map"),r=L.map(s).setView([t.lat,t.lng],15);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(r),L.marker([t.lat,t.lng]).addTo(r).bindPopup(`<div class="p-2"><h3 class="font-semibold">${(e==null?void 0:e.title)||""}</h3><p class="text-sm text-gray-500">${(e==null?void 0:e.location)||""}</p></div>`).openPopup(),setTimeout(()=>r.invalidateSize(),150)}catch{}}function Me(e,t=document){return t.querySelector(e)}function Oe(e,t){var n,s;if(!e)return;let a=(n=e.closest("label, div"))==null?void 0:n.querySelector(".field-error");a||(a=document.createElement("span"),a.className="field-error text-xs font-medium text-red-600",(s=e.closest("label, div"))==null||s.appendChild(a)),a.textContent=t||""}function ns(e){const t={},a=e==null?void 0:e.data;if(a!=null&&a.errors&&typeof a.errors=="object")for(const[n,s]of Object.entries(a.errors))Array.isArray(s)&&s.length&&(t[n]=s[0]);return t}async function ss(e){if(!e)return[];try{const t=await st({per_page:100,page:1});e.innerHTML="";const a=document.createElement("div");return a.className="grid grid-cols-1 sm:grid-cols-2 gap-3",e.appendChild(a),(t||[]).forEach(n=>{const s=n.id??n.value??n.uuid,r=n.name??n.label??String(s),o=document.createElement("label");o.className="flex items-center p-3 bg-white rounded-lg hover:bg-blue-50 cursor-pointer transition-colors border border-gray-200 hover:border-blue-300";const l=document.createElement("input");l.type="checkbox",l.name="categories[]",l.value=s,l.className="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2";const i=document.createElement("span");i.className="ml-3 text-sm text-gray-700 font-medium",i.innerHTML=`<i class="fas fa-tag mr-1 text-blue-500 text-xs"></i>${r}`,o.appendChild(l),o.appendChild(i),a.appendChild(o)}),t}catch{return e.innerHTML='<p class="text-sm text-red-600">No se pudieron cargar las categorías.</p>',[]}}function wt(e){if(e==null)return;const t=String(e).trim();if(!t)return;const a=Number(t);return Number.isFinite(a)?a:t}function rs(e){var i,c,f,d,p,m,y;if(!e||typeof e!="object")return{};const t=e.company||e.company_profile||e.companyProfile||((i=e.profile)==null?void 0:i.company)||((c=e.meta)==null?void 0:c.company)||null,a=[t==null?void 0:t.id,t==null?void 0:t.company_id,t==null?void 0:t.uuid,e.company_id,e.companyId,e.companyID,e.company_profile_id,(f=e.profile)==null?void 0:f.company_id,(d=e.meta)==null?void 0:d.company_id],n=[(p=e.company_profile)==null?void 0:p.id,e.company_profile_id,(m=e.profile)==null?void 0:m.company_profile_id,t==null?void 0:t.profile_id],s=[e.id,e.user_id,e.owner_id,e.creator_id,(y=e.account)==null?void 0:y.id],r=a.map(wt).find(g=>g!==void 0),o=n.map(wt).find(g=>g!==void 0),l=s.map(wt).find(g=>g!==void 0);return{company_id:r,company_profile_id:o,user_id:l}}async function os(e){if(!e)return;const{allowed:t,user:a}=await ce("company");if(!t)return;const n=rs(a),s=e.querySelector("form")||e,r=Me("#title",s),o=Me("#description",s),l=Me("#salary",s),i=Me("#location",s),c=Me("#geolocation",s)||Me('[name="geolocation"]',s),f=e.querySelector("[data-categories]"),d=e.querySelector("[data-error-global]");await ss(f),s.addEventListener("submit",async p=>{var g,h,E,C,$;p.preventDefault(),[r,o,l,i].forEach(v=>Oe(v,"")),d&&(d.textContent="");const m=Array.from(s.querySelectorAll('input[name="categories[]"]:checked')).map(v=>wt(v.value)).filter(v=>v!=null),y={title:((g=r==null?void 0:r.value)==null?void 0:g.trim())||"",description:((h=o==null?void 0:o.value)==null?void 0:h.trim())||"",salary:l!=null&&l.value?Number(l.value):void 0,location:((E=i==null?void 0:i.value)==null?void 0:E.trim())||void 0,geolocation:((C=c==null?void 0:c.value)==null?void 0:C.trim())||void 0,categories:m};n.company_id!==void 0&&(y.company_id=n.company_id),n.company_profile_id!==void 0&&(y.company_profile_id=n.company_profile_id),n.user_id!==void 0&&(y.user_id=n.user_id);try{await kn(y),window.location.href="/html/job-offers/index.html"}catch(v){const x=ns(v);if(x.title&&Oe(r,x.title),x.description&&Oe(o,x.description),x.salary&&Oe(l,x.salary),x.location&&Oe(i,x.location),x.geolocation&&Oe(c,x.geolocation),x.categories){const M=typeof x.categories=="string"?x.categories:"Selecciona al menos una categoría",k=document.createElement("p");k.className="mt-2 text-sm text-red-600",k.textContent=M,f==null||f.appendChild(k)}d&&!Object.keys(x).length&&(d.textContent=(($=v==null?void 0:v.data)==null?void 0:$.message)||v.message||"No se pudo crear la oferta"),console.error("create job offer error",v)}})}function is(){const e=document.querySelector('[data-page="job-offers-create"]');e&&os(e)}function ke(e,t=document){return t.querySelector(e)}function Pe(e,t){var n,s;if(!e)return;let a=(n=e.closest("label, div"))==null?void 0:n.querySelector(".field-error");a||(a=document.createElement("span"),a.className="field-error text-xs font-medium text-red-600",(s=e.closest("label, div"))==null||s.appendChild(a)),a.textContent=t||""}function ls(e){const t={},a=e==null?void 0:e.data;if(a!=null&&a.errors&&typeof a.errors=="object")for(const[n,s]of Object.entries(a.errors))Array.isArray(s)&&s.length&&(t[n]=s[0]);return t}function cs(){try{return new URL(window.location.href).searchParams.get("id")}catch{return null}}async function ds(e,t){if(!e)return[];const a=new Set((t||[]).map(String));try{const n=await st({per_page:100,page:1});e.innerHTML="";const s=document.createElement("div");return s.className="grid grid-cols-1 sm:grid-cols-2 gap-3",e.appendChild(s),(n||[]).forEach(r=>{const o=r.id??r.value??r.uuid,l=r.name??r.label??String(o),i=document.createElement("label");i.className="flex items-center p-3 bg-white rounded-lg hover:bg-blue-50 cursor-pointer transition-colors border border-gray-200 hover:border-blue-300";const c=document.createElement("input");c.type="checkbox",c.name="categories[]",c.value=o,c.className="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2",a.has(String(o))&&(c.checked=!0);const f=document.createElement("span");f.className="ml-3 text-sm text-gray-700 font-medium",f.innerHTML=`<i class="fas fa-tag mr-1 text-blue-500 text-xs"></i>${l}`,i.appendChild(c),i.appendChild(f),s.appendChild(i)}),n}catch{return e.innerHTML='<p class="text-sm text-red-600">No se pudieron cargar las categorías.</p>',[]}}async function us(e){var y;if(!e)return;const{allowed:t}=await ce("company");if(!t)return;const a=e.querySelector("form")||e,n=ke("#title",a),s=ke("#description",a),r=ke("#salary",a),o=ke("#location",a),l=ke("#geolocation",a)||ke('[name="geolocation"]',a),i=e.querySelector("[data-categories]"),c=ke("#cancel-link",e),f=e.querySelector("[data-error-global]"),d=cs();if(!d){e.innerHTML='<p class="text-sm text-red-600">Falta el parámetro id (?id=123)</p>';return}let p;try{const g=await Ka(d);p=(g==null?void 0:g.data)??g}catch(g){e.innerHTML=`<p class="text-sm text-red-600">No se pudo cargar la oferta: ${((y=g==null?void 0:g.data)==null?void 0:y.message)||g.message}</p>`;return}n.value=(p==null?void 0:p.title)||"",s.value=(p==null?void 0:p.description)||"",r&&(r.value=(p==null?void 0:p.salary)??""),o&&(o.value=(p==null?void 0:p.location)??""),l&&(l.value=(p==null?void 0:p.geolocation)??""),c&&(p!=null&&p.id)&&(c.href=`/html/job-offers/show.html?id=${encodeURIComponent(p.id)}`);const m=Array.isArray(p==null?void 0:p.categories)?p.categories.map(g=>(g==null?void 0:g.id)??g):[];await ds(i,m),a.addEventListener("submit",async g=>{var C,$,v,x,M;g.preventDefault(),[n,s,r,o].forEach(k=>Pe(k,"")),f&&(f.textContent="");const h=Array.from(a.querySelectorAll('input[name="categories[]"]:checked')).map(k=>k.value),E={title:((C=n==null?void 0:n.value)==null?void 0:C.trim())||"",description:(($=s==null?void 0:s.value)==null?void 0:$.trim())||"",salary:r!=null&&r.value?Number(r.value):void 0,location:((v=o==null?void 0:o.value)==null?void 0:v.trim())||void 0,geolocation:((x=l==null?void 0:l.value)==null?void 0:x.trim())||void 0,categories:h};try{await jn(d,E),window.location.href=`/html/job-offers/show.html?id=${encodeURIComponent(d)}`}catch(k){const q=ls(k);if(q.title&&Pe(n,q.title),q.description&&Pe(s,q.description),q.salary&&Pe(r,q.salary),q.location&&Pe(o,q.location),q.geolocation&&Pe(l,q.geolocation),q.categories){const j=typeof q.categories=="string"?q.categories:"Selecciona al menos una categoría",b=document.createElement("p");b.className="mt-2 text-sm text-red-600",b.textContent=j,i==null||i.appendChild(b)}f&&!Object.keys(q).length&&(f.textContent=((M=k==null?void 0:k.data)==null?void 0:M.message)||k.message||"No se pudo actualizar la oferta"),console.error("update job offer error",k)}})}function fs(){const e=document.querySelector('[data-page="job-offers-edit"]');e&&us(e)}function an(e={}){return H("/classified",{query:e})}function ms(e){return H(`/classified/${e}`)}async function nn(e){return H(`/classified/${e}`,{method:"DELETE"})}async function Jt(e={}){const t=[async()=>await H("/classified/count",{query:e}),async()=>{const a=await H("/classified",{query:{...e,per_page:1}}),n=(a==null?void 0:a.meta)||(a==null?void 0:a.pagination)||{};return n.total!=null?n.total:typeof(a==null?void 0:a.total)=="number"?a.total:null},async()=>{let a=1;const n=50;let s=0;for(let r=0;r<5;r++){const o=await H("/classified",{query:{...e,page:a,per_page:n}}),l=Array.isArray(o)?o:Array.isArray(o==null?void 0:o.data)?o.data:[];s+=l.length;const i=(o==null?void 0:o.meta)||(o==null?void 0:o.pagination);if(!i||i.current_page>=i.last_page||l.length<n)break;a++}return s||null}];for(const a of t)try{const n=await a();if(typeof n=="number")return n}catch{}try{const a=await H("/classified",{query:{...e,per_page:50}});return(Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:[]).length}catch{return 0}}async function ps(){const e=[async()=>await H("/classified/today/count"),async()=>await H("/classified/count",{query:{today:1}})];for(const t of e)try{const a=await t();if(typeof a=="number")return a}catch{}try{const t=await H("/classified",{query:{per_page:100,sort:"created_at:desc"}}),a=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:[],n=new Date().toDateString();return a.filter(s=>new Date(s.created_at||s.date).toDateString()===n).length}catch{return 0}}async function sn(e={}){const t=[{path:"/users",query:e},{path:"/message/contacts",query:e},{path:"/contacts",query:e}];let a=null;for(const n of t)try{const s=await H(n.path,{query:n.query}),r=Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:[];if(r&&Array.isArray(r))return r}catch(s){a=s}try{const n=localStorage.getItem("fake_contacts");if(n)return JSON.parse(n)}catch{}if(a)throw a;return[]}function _(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))r===!1||r===null||r===void 0||(s==="class"?n.className=r:n.setAttribute(s,r));for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function gs(e,t){var E,C,$,v,x,M;const{me:a,onDelete:n,favSet:s,onToggleFavorite:r,isCesante:o}=t,l=!!(a&&((E=a.unemployed)!=null&&E.id&&a.unemployed.id===e.unemployed_id||(C=a.company)!=null&&C.id&&a.company.id===e.company_id)),i=e.salary?`$${Number(e.salary).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:"A convenir",c=Array.isArray(e.categories)?e.categories:[],f=_("div",{class:"flex flex-wrap gap-2"},...c.map(k=>_("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-semibold"},_("i",{class:"fas fa-tag"}),k.name||k.title||""))),d=e.company||e.company_id?"fas fa-building":"fas fa-user",p=(($=e.company)==null?void 0:$.business_name)||((v=e.company)==null?void 0:v.name)||((x=e.unemployed)==null?void 0:x.name)||"Clasificado",m=e.created_at?As(e.created_at):"",y=_("a",{href:`/html/classifieds/show.html?id=${encodeURIComponent(e.id)}`,class:"w-full btn-primary inline-flex items-center justify-center gap-2 px-4 py-2 rounded-xl text-white hover:opacity-95 transition"},_("i",{class:"fas fa-eye"}),"Ver detalles"),g=l?_("div",{class:"mt-3 grid grid-cols-2 gap-2"},_("a",{href:`/html/classifieds/edit.html?id=${encodeURIComponent(e.id)}`,class:"inline-flex items-center justify-center px-3 py-2 rounded-lg border bg-white hover:bg-gray-50 text-gray-700 text-sm"},_("i",{class:"fas fa-edit mr-2"}),"Editar"),_("button",{class:"inline-flex items-center justify-center px-3 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white text-sm",onclick:k=>{k.preventDefault(),n==null||n(e)}},_("i",{class:"fas fa-trash mr-2"}),"Eliminar")):null;let h=null;if(o&&!l){const k=`classified:${e.id}`,q=!!((M=s==null?void 0:s.has)!=null&&M.call(s,k));h=_("button",{class:["favorite-btn w-full h-12 rounded-xl flex items-center justify-center transition-all duration-300",q?"bg-red-100 text-red-600 border-2 border-red-200":"bg-white text-gray-500 border-2 border-gray-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200"].join(" ")},_("i",{class:"fas fa-heart text-lg mr-2"}),_("span",null,q?"Guardado":"Guardar")),h.addEventListener("click",j=>{j.preventDefault(),r==null||r(e,h)})}return _("article",{class:"card-surface rounded-3xl overflow-hidden p-0"},_("div",{class:"flex flex-col md:flex-row"},_("div",{class:"flex-1 p-6 space-y-5"},_("div",{class:"flex items-start justify-between gap-4"},_("div",{class:"space-y-3"},_("a",{href:`/html/classifieds/show.html?id=${encodeURIComponent(e.id)}`,class:"group inline-flex items-center gap-2"},_("span",{class:"text-2xl font-bold text-gray-900 group-hover:text-blue-700 transition"},e.title||"Clasificado"),_("i",{class:"fas fa-arrow-right text-blue-600 opacity-0 group-hover:opacity-100 transition"})),_("div",{class:"flex items-center gap-3"},_("span",{class:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-blue-600 text-white"},_("i",{class:d})),_("div",null,_("p",{class:"text-gray-800 font-semibold"},p),_("p",{class:"text-sm text-gray-500 flex items-center gap-1"},_("i",{class:"fas fa-shield-check text-emerald-500"}),e.company?"Empresa verificada":"Publicado por la comunidad")))),_("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-semibold"},_("i",{class:"fas fa-bullhorn"}),"Clasificado")),_("div",{class:"flex flex-wrap items-center gap-3 text-sm text-gray-600"},_("span",{class:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-gray-100"},_("i",{class:"fas fa-location-dot text-blue-600"}),e.location||"Ubicación no especificada"),_("span",{class:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-gray-100"},_("i",{class:"fas fa-clock text-gray-500"}),m),e.salary?null:_("span",{class:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-50 text-slate-600"},_("i",{class:"fas fa-comments"}),"A convenir")),f,_("p",{class:"text-gray-600 leading-relaxed"},_s(Zt(e.description||""),220))),_("div",{class:"md:w-72 p-6 border-t md:border-t-0 md:border-l border-gray-100 flex flex-col justify-between gap-4"},h,e.salary?_("div",{class:"bg-white rounded-2xl border border-gray-200 p-4 shadow-sm"},_("p",{class:"text-xs text-gray-500 uppercase font-semibold mb-2"},"Oferta económica"),_("p",{class:"text-2xl font-bold text-gray-900"},i),_("p",{class:"text-xs text-gray-500 mt-1"},"Referencial, puede variar según experiencia")):null,y,g)))}async function ys(e){var v,x,M;if(!e)return;const t=document.getElementById("classifieds-hero"),a=document.getElementById("classifieds-filters"),n=document.getElementById("classifieds-load-more");let s=null,r=new Set,o=1;const l=8;let i=!1,c=Es(),f=[];try{s=await ue()}catch{}const d=(localStorage.getItem("display_role")||localStorage.getItem("selected_role")||localStorage.getItem("pending_role")||"").toLowerCase(),p=["unemployed","cesante","desempleado","postulante","candidate","jobseeker"].includes(d),m=!!((v=s==null?void 0:s.unemployed)!=null&&v.id||s!=null&&s.unemployed_id||(M=(x=s==null?void 0:s.profile)==null?void 0:x.unemployed)!=null&&M.id),y=We(s)||m||p;try{const k=await jt({type:"classified",per_page:200}),q=Array.isArray(k)?k:Array.isArray(k==null?void 0:k.data)?k.data:[];for(const j of q){const b=j.classified_id||j.item_id||j.id;b!=null&&r.add(`classified:${b}`)}}catch{}try{const[k,q]=await Promise.all([Jt(Ot(c)),ps()]);Mt(t,{me:s,total:k,today:q,favCount:Array.from(r).length})}catch{Mt(t,{me:s,total:null,today:null,favCount:Array.from(r).length})}try{f=await st({type:"classified"})}catch{f=[]}const g=async k=>{c=k||{},o=1,i=!1,e.innerHTML="",await E(),ks(c),h();try{const q=await Jt(Ot(c));Mt(t,{me:s,total:q,today:null,favCount:Array.from(r).length})}catch{}};function h(){xs(a,c,f,g)}h(),e.innerHTML="",E(),bs(n,async()=>{i||(o+=1,await E())});async function E(){var q;const k=_("p",{class:"text-slate-500"},"Cargando clasificados...");e.childElementCount||e.appendChild(k);try{const j=Ot({...c,page:o,per_page:l,sort:"created_at:desc"}),b=await an(j);let w=Array.isArray(b)?b:Array.isArray(b==null?void 0:b.data)?b.data:[];if(w=ws(w,c),c!=null&&c.search&&(w=Ss(w,c.search)),k.remove(),!w.length&&!e.childElementCount)return e.appendChild(_("p",{class:"text-slate-500"},"No se encontraron clasificados."));const O=e.querySelector(".classifieds-grid")||_("div",{class:"classifieds-grid grid gap-6 animate-slide-in"});O.parentElement||e.appendChild(O);const P={me:s,isCesante:y,favSet:r,onToggleFavorite:C,onDelete:$,onView:()=>{}};for(const R of w)O.appendChild(gs(R,P));const D=(b==null?void 0:b.meta)||(b==null?void 0:b.pagination);((D==null?void 0:D.current_page)>=(D==null?void 0:D.last_page)||w.length<l)&&(i=!0),vs(n,i)}catch(j){k.textContent=`Error: ${((q=j==null?void 0:j.data)==null?void 0:q.message)||j.message}`}}async function C(k,q){var j;q.disabled=!0;try{const{isFavorite:b}=await nt({type:"classified",id:k.id}),w=`classified:${k.id}`;b?r.add(w):r.delete(w),q.classList.toggle("bg-red-100",b),q.classList.toggle("text-red-600",b),q.classList.toggle("border-red-200",b),q.classList.toggle("bg-white",!b),q.classList.toggle("text-gray-500",!b),q.classList.toggle("border-gray-200",!b);const O=q.querySelector("span");O&&(O.textContent=b?"Guardado":"Guardar")}catch(b){alert(((j=b==null?void 0:b.data)==null?void 0:j.message)||b.message||"No se pudo cambiar favorito")}finally{q.disabled=!1}}async function $(k){var q;if(confirm("¿Eliminar este clasificado?"))try{await nn(k.id),location.reload()}catch(j){alert(((q=j==null?void 0:j.data)==null?void 0:q.message)||j.message||"No se pudo eliminar")}}}function hs(){const e=document.querySelector('[data-page="classifieds"]');e&&ys(e)}function Mt(e,{me:t,total:a,today:n,favCount:s}){e&&(e.innerHTML="",e.appendChild(_("div",{class:"gradient-primary rounded-3xl p-8 text-white relative overflow-hidden shadow-soft"},_("div",{class:"absolute -top-20 -right-12 w-72 h-72 bg-white/10 blur-3xl rounded-full"}),_("div",{class:"absolute bottom-0 left-0 w-64 h-64 bg-white/10 blur-3xl rounded-full"}),_("div",{class:"relative z-10 flex flex-col lg:flex-row items-center lg:items-start gap-10"},_("div",{class:"flex-1 text-center lg:text-left space-y-6"},_("div",{class:"inline-flex items-center px-4 py-2 rounded-full bg-white/10 border border-white/30 text-white/90 text-sm uppercase tracking-wide"},_("i",{class:"fas fa-bullhorn mr-2"}),"Mercado de clasificados"),_("div",{class:"space-y-4"},_("h1",{class:"text-4xl md:text-5xl font-bold leading-tight"},"Descubre anuncios relevantes y oportunidades únicas"),_("p",{class:"text-white/80 text-lg max-w-3xl"},"Filtra por ubicación, categoría y palabras clave para encontrar rápidamente el clasificado que estás buscando. Guarda tus favoritos para hacer seguimiento cuando quieras.")),_("div",{class:"flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-start justify-center"},t&&(t.company||t.unemployed)?_("a",{href:"/html/classifieds/create.html",class:"btn-primary text-white inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-semibold transition"},_("i",{class:"fas fa-plus-circle"}),"Publicar clasificado"):null,t!=null&&t.unemployed?_("a",{href:"/html/favorites/index.html",class:"inline-flex items-center justify-center gap-2 bg-white/10 border border-white/40 text-white hover:bg-white/20 px-5 py-3 rounded-xl font-semibold"},_("i",{class:"fas fa-heart"}),`Mis favoritos (${s||0})`):null)),_("div",{class:"w-full max-w-sm"},_("div",{class:"bg-white/10 rounded-3xl p-7 backdrop-blur space-y-5 text-white ring-1 ring-white/15"},_("p",{class:"text-white/70 text-sm uppercase tracking-widest"},"Resumen rápido"),_("div",{class:"flex items-center justify-between"},_("div",null,_("p",{class:"text-sm text-white/70"},"Clasificados activos"),_("p",{class:"text-3xl font-bold"},Pt(a))),_("span",{class:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-white/15"},_("i",{class:"fas fa-layer-group"}))),_("div",{class:"flex items-center justify-between"},_("div",null,_("p",{class:"text-sm text-white/70"},"Publicaciones de hoy"),_("p",{class:"text-3xl font-bold"},Pt(n))),_("span",{class:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-white/15"},_("i",{class:"fas fa-calendar-day"}))),_("div",{class:"flex items-center justify-between"},_("div",null,_("p",{class:"text-sm text-white/70"},"Favoritos guardados"),_("p",{class:"text-3xl font-bold"},Pt(s))),_("span",{class:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-white/15"},_("i",{class:"fas fa-heart"})))))))))}function xs(e,t,a,n){if(!e)return;e.innerHTML="";const s=_("form",{class:"space-y-6"},_("div",{class:"flex flex-wrap items-center gap-3"},_("span",{class:"px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-sm inline-flex items-center gap-2"},_("i",{class:"fas fa-filter"}),"Filtrado inteligente"),t.location?_("span",{class:"px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-sm"},`Ubicación: ${t.location}`):null,t.category_id?_("span",{class:"px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 text-sm"},`Categoría: ${Cs(a,t.category_id)}`):null,t.search?_("span",{class:"px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-sm"},`Buscar: ${t.search}`):null,t.location||t.category_id||t.search?_("button",{type:"button",class:"text-sm text-gray-500 hover:text-gray-700 underline",onclick:r=>{r.preventDefault();const o=s.querySelector("#category_id");o&&(o.value=""),n({})}},"Limpiar filtros"):null),_("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-4"},_("div",{class:"col-span-1"},_("label",{for:"location",class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},_("i",{class:"fas fa-location-dot text-blue-600"}),"Ubicación"),_("input",{type:"text",id:"location",name:"location",value:t.location||"",placeholder:"Ciudad, país o remoto",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})),_("div",{class:"col-span-1"},_("label",{for:"category_id",class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},_("i",{class:"fas fa-tags text-purple-500"}),"Categoría"),_("select",{id:"category_id",name:"category_id",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},_("option",{value:""},"Todas las categorías"),...a.map(r=>_("option",{value:String(r.id),selected:String(t.category_id||"")===String(r.id)||void 0},r.name||r.title||"")))),_("div",{class:"col-span-1"},_("label",{for:"search",class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},_("i",{class:"fas fa-magnifying-glass text-blue-500"}),"Palabras clave"),_("input",{type:"text",id:"search",name:"search",value:t.search||"",placeholder:"Título, descripción o empresa",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})),_("div",{class:"col-span-1 flex items-end"},_("button",{type:"submit",class:"w-full btn-primary inline-flex items-center justify-center gap-2 text-white px-5 py-3 rounded-xl font-semibold transition"},_("i",{class:"fas fa-search"}),"Buscar clasificados"))));s.addEventListener("submit",r=>{r.preventDefault();const o=new FormData(s),l=(o.get("location")||"").toString().trim(),i=(o.get("category_id")||"").toString().trim(),c=(o.get("search")||"").toString().trim();n({location:l||void 0,category_id:i||void 0,search:c||void 0})}),e.appendChild(s)}function bs(e,t){if(!e)return;e.innerHTML="";const a=_("button",{class:"px-5 py-2 rounded-xl btn-primary text-white hover:opacity-95 transition",onclick:t},"Cargar más");e.appendChild(a)}function vs(e,t){if(!e)return;const a=e.querySelector("button");a&&(a.disabled=!!t,a.textContent=t?"No hay más resultados":"Cargar más")}function ws(e,t={}){try{let a=Array.isArray(e)?[...e]:[];const{location:n,category_id:s,search:r}=t||{};if(n){const o=String(n).toLowerCase();a=a.filter(l=>String(l.location||"").toLowerCase().includes(o))}if(s){const o=String(s);a=a.filter(l=>(Array.isArray(l.categories)?l.categories:[]).some(c=>String(c.id)===o||String(c==null?void 0:c.category_id)===o))}if(r){const o=String(r).toLowerCase();a=a.filter(l=>{var d,p;const i=String(l.title||"").toLowerCase(),c=Zt(String(l.description||"").toLowerCase()),f=String(((d=l.company)==null?void 0:d.name)||((p=l.company)==null?void 0:p.business_name)||"").toLowerCase();return i.includes(o)||c.includes(o)||f.includes(o)})}return a}catch{return Array.isArray(e)?e:[]}}function Ss(e,t){try{const a=String(t).toLowerCase(),n=s=>{const r=String(s.title||"").toLowerCase(),o=Zt(String(s.description||"").toLowerCase());let l=0;return r===a&&(l+=100),r.includes(a)&&(l+=50),o.includes(a)&&(l+=10),l};return[...e].sort((s,r)=>n(r)-n(s))}catch{return e}}function Ot(e={}){const t={},a=e||{};return a.search&&(t.search=a.search,t.q=a.search),a.location&&(t.location=a.location,t.city=a.location),a.category_id&&(t.category_id=a.category_id,t.category=a.category_id),a.page&&(t.page=a.page),a.per_page&&(t.per_page=a.per_page,t.perPage=a.per_page),a.sort&&(t.sort=a.sort),a.include?t.include=a.include:t.include="company,unemployed,categories",t}function Cs(e,t){try{if(!t)return"Todas";const n=(Array.isArray(e)?e:[]).find(s=>String(s.id)===String(t));return(n==null?void 0:n.name)||(n==null?void 0:n.title)||"Categoría"}catch{return"Categoría"}}function Zt(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}function _s(e,t){return e?e.length>t?e.slice(0,t-1)+"…":e:""}function As(e){try{const t=new Date(e),a=Math.floor((Date.now()-t.getTime())/1e3);if(a<60)return`hace ${a} segundos`;const n=Math.floor(a/60);if(n<60)return`hace ${n} ${n===1?"minuto":"minutos"}`;const s=Math.floor(n/60);if(s<24)return`hace ${s} ${s===1?"hora":"horas"}`;const r=Math.floor(s/24);if(r<7)return`hace ${r} ${r===1?"día":"días"}`;const o=Math.floor(r/7);if(r<30)return`hace ${o} ${o===1?"semana":"semanas"}`;const l=Math.floor(r/30);if(l<12)return`hace ${l} ${l===1?"mes":"meses"}`;const i=Math.floor(l/12);return`hace ${i} ${i===1?"año":"años"}`}catch{return""}}function Pt(e){if(e==null)return"—";try{return Number(e).toLocaleString()}catch{return String(e)}}function Es(){const e=new URLSearchParams(location.search),t=a=>{const n=e.get(a);return n==null||n===""?void 0:n};return{location:t("location"),category_id:t("category_id"),search:t("search")}}function ks(e){const t=new URLSearchParams;e!=null&&e.location&&t.set("location",e.location),e!=null&&e.category_id&&t.set("category_id",e.category_id),e!=null&&e.search&&t.set("search",e.search);const a=t.toString(),n=location.pathname+(a?`?${a}`:"");history.replaceState(null,"",n)}function G(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function js(e){const t=new URL(window.location.href).searchParams;return(e==null?void 0:e.getAttribute("data-id"))||t.get("id")}async function $s(e,t){var n,s,r,o,l,i;if(!e)return;e.innerHTML="";const a=G("p",{class:"text-slate-500"},"Cargando clasificado...");e.appendChild(a);try{const c=t||js(e);if(!c){a.textContent="Falta id (?id=123)";return}const[f,d,p]=await Promise.all([ms(c),(async()=>{try{return await ue()}catch{return null}})(),(async()=>{try{const j=await jt({type:"classified",per_page:200});return Array.isArray(j)?j:Array.isArray(j==null?void 0:j.data)?j.data:[]}catch{return[]}})()]);a.remove();const m=(f==null?void 0:f.data)??f,y=new Set(p.map(j=>`classified:${j.classified_id||j.item_id||j.id}`)),g=!!(d&&((n=d.unemployed)!=null&&n.id&&d.unemployed.id===m.unemployed_id||(s=d.company)!=null&&s.id&&d.company.id===m.company_id)),h=y.has(`classified:${m.id}`),E=m.company||m.company_id?"fas fa-building":"fas fa-user",C=((r=m.company)==null?void 0:r.business_name)||((o=m.company)==null?void 0:o.name)||((l=m.unemployed)==null?void 0:l.name)||"Clasificado",$=Array.isArray(m.categories)?m.categories:[],v=m.created_at?Is(m.created_at):"",x=G("div",{class:"flex justify-between items-start mb-6"},G("div",{class:"flex-1"},G("h1",{class:"text-3xl font-bold text-gray-900 mb-4"},G("i",{class:"fas fa-bullhorn text-blue-700 mr-3"}),m.title||`Clasificado #${c}`),G("div",{class:"flex items-center mb-4"},G("div",{class:"w-12 h-12 gradient-primary rounded-full flex items-center justify-center mr-3",style:"background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);"},G("i",{class:E+" text-white"})),G("div",null,G("p",{class:"text-lg font-semibold text-gray-800"},C),G("span",{class:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium"},m.company?"Empresa verificada":"Usuario individual"))),G("div",{class:"flex flex-wrap items-center gap-4 text-sm text-gray-600 mb-4"},G("div",{class:"flex items-center"},G("i",{class:"fas fa-map-marker-alt text-blue-700 mr-2"}),G("span",null,m.location||"—")),G("div",{class:"flex items-center"},G("i",{class:"fas fa-clock text-gray-600 mr-2"}),G("span",null,v?`Publicado ${v}`:"")))),G("div",{class:"flex flex-col items-end space-y-2"},!g&&(d!=null&&d.unemployed)?Ts(h,async j=>{const{isFavorite:b}=await nt({type:"classified",id:m.id});j.classList.toggle("bg-red-100",b),j.classList.toggle("text-red-600",b),j.classList.toggle("border-red-200",b),j.classList.toggle("bg-gray-100",!b),j.classList.toggle("text-gray-400",!b),j.classList.toggle("border-gray-200",!b)}):null,g?G("div",{class:"flex space-x-2"},G("a",{href:`/html/classifieds/edit.html?id=${encodeURIComponent(m.id)}`,class:"bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors"},"Editar"),G("button",{class:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",onclick:async()=>{var j;if(confirm("¿Eliminar este clasificado?"))try{await nn(m.id),location.href="/html/classifieds/index.html?success=Clasificado%20eliminado"}catch(b){alert(((j=b==null?void 0:b.data)==null?void 0:j.message)||b.message||"No se pudo eliminar")}}},"Eliminar")):null)),M=$.length?G("div",{class:"mb-6"},G("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Categorías"),G("div",{class:"flex flex-wrap gap-2"},...$.map(j=>G("span",{class:"inline-block bg-purple-100 text-purple-800 rounded-full px-3 py-1 text-sm font-semibold"},j.name||j.title||"")))):null,k=G("div",{class:"mb-6"},G("h3",{class:"text-lg font-semibold text-gray-800 mb-3"},"Descripción"),G("div",{class:"prose max-w-none text-gray-700 whitespace-pre-wrap"},m.description||"")),q=G("article",{class:"card-enhanced p-8 mb-6"},x,M,k);e.appendChild(q),qs(document.getElementById("classified-sidebar"),m,d,g),Ns(m)}catch(c){a.textContent=`Error: ${((i=c==null?void 0:c.data)==null?void 0:i.message)||c.message}`}}function Ls(){const e=document.querySelector('[data-page="classified-detail"]');e&&$s(e)}function Ts(e,t){const a=G("button",{class:`favorite-btn w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 hover-lift border ${e?"bg-red-100 text-red-600 border-red-200":"bg-gray-100 text-gray-400 border-gray-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200"}`},G("i",{class:"fas fa-heart text-lg"}));return a.addEventListener("click",async n=>{n.preventDefault(),a.disabled=!0;try{await t(a)}finally{a.disabled=!1}}),a}function qs(e,t,a,n){if(!e)return;e.innerHTML="";const s=G("div",{class:"bg-white rounded-lg shadow-sm p-6 mb-6 border border-blue-900/30"},G("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Detalles"),G("div",{class:"space-y-3"},t.salary?G("div",{class:"flex justify-between"},G("span",{class:"font-medium text-gray-700"},"Precio/Salario:"),G("span",{class:"text-green-600 font-semibold"},Ms(t.salary))):null,G("div",{class:"flex justify-between"},G("span",{class:"font-medium text-gray-700"},"Ubicación:"),G("span",{class:"text-gray-600"},t.location||"—")),G("div",{class:"flex justify-between"},G("span",{class:"font-medium text-gray-700"},"Publicado:"),G("span",{class:"text-gray-600"},Os(t.created_at))),G("div",{class:"flex justify-between"},G("span",{class:"font-medium text-gray-700"},"Tipo:"),G("span",{class:"text-gray-600"},t.company?"Empresa":"Particular"))));e.appendChild(s),a&&!n&&e.appendChild(G("div",{class:"bg-white rounded-lg shadow-sm p-6 border border-blue-900/30"},G("a",{href:"/html/forms/message-form.html",class:"w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors font-semibold text-center block"},"Contactar")))}function Ns(e){var l,i;if(typeof L>"u"||!document.getElementById("classified-map"))return;let a=2.4448,n=-76.6147;const s=String((e==null?void 0:e.geolocation)||"").split(",").map(c=>parseFloat(c.trim()));if(s.length===2&&!Number.isNaN(s[0])&&!Number.isNaN(s[1])&&s[0]!==0&&s[1]!==0)a=s[0],n=s[1];else{const c=document.getElementById("classified-map-hint");c&&(c.style.display="")}const r=L.map("classified-map").setView([a,n],15);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(r);const o=['<div class="p-2">',`<h3 class="font-semibold text-gray-800">${it((e==null?void 0:e.title)||"Clasificado")}</h3>`,(l=e==null?void 0:e.company)!=null&&l.name?`<p class="text-gray-600">${it(e.company.name)}</p>`:(i=e==null?void 0:e.unemployed)!=null&&i.name?`<p class="text-gray-600">${it(e.unemployed.name)}</p>`:"",e!=null&&e.location?`<p class="text-sm text-gray-500">${it(e.location)}</p>`:"",`<p class="text-xs text-blue-500">Coords: ${a}, ${n}</p>`,"</div>"].join("");L.marker([a,n]).addTo(r).bindPopup(o).openPopup()}function Is(e){try{const t=new Date(e),a=Math.floor((Date.now()-t.getTime())/1e3);if(a<60)return`hace ${a}s`;const n=Math.floor(a/60);if(n<60)return`hace ${n}m`;const s=Math.floor(n/60);if(s<24)return`hace ${s}h`;const r=Math.floor(s/24);return r<7?`hace ${r}d`:t.toLocaleDateString()}catch{return""}}function Ms(e){try{return Number(e).toLocaleString(void 0,{style:"currency",currency:"USD"})}catch{return`$${e}`}}function Os(e){try{return new Date(e).toLocaleDateString()}catch{return""}}function it(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Ps(){const e=document.querySelector('[data-page="classifieds-create"]');e&&Ds(e).catch(t=>console.error("Classified create init error:",t))}async function Ds(e){const t=e.querySelector("form"),a=e.querySelector("[data-categories]"),n=e.querySelector("[data-error-global]");try{const s=await st({type:"classified"});Rs(a,s)}catch{a.innerHTML='<p class="text-red-600">No se pudieron cargar categorías</p>'}t==null||t.addEventListener("submit",async s=>{s.preventDefault(),Bs(t,n);const r=new FormData(t),o=Us(r);try{await Fs(o),location.href="/html/classifieds/index.html?success=Clasificado%20creado"}catch(l){Hs(l,t,n)}})}function Us(e){const t=[];return e.getAll("categories[]").forEach(a=>{a&&t.push(Number(a))}),{title:(e.get("title")||"").toString().trim(),description:(e.get("description")||"").toString().trim(),location:(e.get("location")||"").toString().trim(),geolocation:(e.get("geolocation")||"").toString().trim()||void 0,salary:e.get("salary")?Number(e.get("salary")):void 0,categories:t}}async function Fs(e){const t=[{path:"/classified",method:"POST"},{path:"/classifieds",method:"POST"}];let a=null;for(const n of t)try{return await H(n.path,{method:n.method,body:e})}catch(s){a=s}throw a||new Error("No se pudo crear el clasificado")}function Rs(e,t){if(!e)return;const a=Array.isArray(t)?t:[];if(!a.length){e.innerHTML='<p class="text-slate-500">Sin categorías</p>';return}const n=document.createElement("div");n.className="grid grid-cols-2 sm:grid-cols-3 gap-3";for(const s of a){`${s.id}`;const r=document.createElement("label");r.className="flex items-center gap-2",r.innerHTML=`
      <input type="checkbox" name="categories[]" value="${s.id}" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
      <span class="text-sm text-gray-700">${s.name||s.title||""}</span>
    `,n.appendChild(r)}e.innerHTML="",e.appendChild(n)}function Hs(e,t,a){var r,o,l,i;const n=((r=e==null?void 0:e.data)==null?void 0:r.message)||e.message,s=((o=e==null?void 0:e.data)==null?void 0:o.errors)||{};a&&n&&(a.classList.remove("hidden"),a.className="mb-6 mx-8 mt-6 px-4 py-3 rounded-xl text-sm bg-red-100 text-red-800 border border-red-200",a.textContent=n);for(const[c,f]of Object.entries(s)){const d=t.querySelector(`#${CSS.escape(c)}`)||t.querySelector(`[name="${CSS.escape(c)}"]`);if(!d)continue;const p=((l=d.closest("div"))==null?void 0:l.querySelector("p.text-red-600"))||document.createElement("p");p.className="mt-1 text-sm text-red-600",p.textContent=Array.isArray(f)?f[0]:String(f),p.parentElement||(i=d.closest("div"))==null||i.appendChild(p)}}function Bs(e,t){e.querySelectorAll("p.text-red-600").forEach(a=>a.remove()),t&&(t.textContent="",t.classList.add("hidden"))}function Lt(e={}){return H("/training",{query:e})}function zs(e){return H(`/training/${e}`)}function Vs(e,t){return H(`/training/${e}`,{method:"PUT",body:t})}function Js(e){return H("/training",{method:"POST",body:e})}function I(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function tt(e){if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t}function ga(e){if(!e)return"";const t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return`${t}/${a}/${n}`}function Gs(e){const t=tt(e);if(!t)return e||"";const a=Math.abs(Date.now()-t.getTime()),n=Math.round(a/1e3),s=(p,m="m")=>({1:m==="f"?"una":"un",2:"dos",3:"tres",4:"cuatro",5:"cinco",6:"seis",7:"siete",8:"ocho",9:"nueve",10:"diez"})[p]||String(p);if(n<60){const p=n;return`hace ${s(p,"m")} ${p===1?"segundo":"segundos"}`}const r=Math.round(n/60);if(r<60){const p=r;return`hace ${s(p,"m")} ${p===1?"minuto":"minutos"}`}const o=Math.round(r/60);if(o<24){const p=o;return`hace ${s(p,"f")} ${p===1?"hora":"horas"}`}const l=Math.round(o/24);if(l<30){const p=l;return`hace ${s(p,"m")} ${p===1?"día":"días"}`}const i=Math.round(l/30);if(i<12){const p=i;return`hace ${s(p,"m")} ${p===1?"mes":"meses"}`}const c=Math.round(i/12);return`hace ${s(c,"m")} ${c===1?"año":"años"}`}function Ws(e){const t=tt(e.start_date),a=tt(e.end_date),n=!!(t&&t.getTime()>Date.now()),s=!!(a&&a.getTime()<Date.now()),r=s?"Finalizada":n?"Próxima":"En curso";return I("article",{class:"card-surface rounded-3xl overflow-hidden p-0"},I("div",{class:"flex flex-col md:flex-row"},I("div",{class:"flex-1 p-6"},I("div",{class:"flex items-start justify-between mb-4"},I("div",{class:"flex-1"},I("h3",{class:"text-2xl font-bold text-gray-900 mb-3 group"},I("span",{class:"inline-flex items-center"},e.title||"Capacitación",e.link?I("i",{class:"fas fa-external-link-alt ml-2 text-blue-900 opacity-0 group-hover:opacity-100 transition-all duration-200 transform translate-x-0 group-hover:translate-x-1"}):null)),I("div",{class:"flex items-center mb-4 group cursor-pointer"},I("div",{class:"w-14 h-14 gradient-primary rounded-xl flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300"},I("i",{class:"fas fa-building text-white text-xl"})),I("div",{},I("p",{class:"text-gray-800 font-semibold text-lg"},e.provider||"Proveedor no especificado"),I("p",{class:"text-sm text-gray-500 flex items-center"},I("i",{class:"fas fa-graduation-cap text-blue-900 mr-1"}),"Programa de capacitación")))),I("div",{class:"ml-4"},I("span",{class:"inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-gradient-primary text-white"},I("i",{class:"fas fa-graduation-cap mr-2"}),r))),e.description?I("div",{class:"mb-4"},I("p",{class:"text-gray-700 leading-relaxed"},String(e.description).slice(0,200))):null,I("div",{class:"flex flex-wrap items-center gap-4 mb-4"},t?I("div",{class:"flex items-center text-gray-700 bg-blue-100 px-3 py-2 rounded-lg"},I("i",{class:"fas fa-play-circle text-blue-900 mr-2"}),I("span",{class:"font-medium"},`Inicio: ${ga(t)}`)):null,a?I("div",{class:"flex items-center text-gray-700 bg-blue-100 px-3 py-2 rounded-lg"},I("i",{class:"fas fa-stop-circle text-blue-900 mr-2"}),I("span",{class:"font-medium"},`Fin: ${ga(a)}`)):null,e.created_at?I("div",{class:"flex items-center text-gray-600 bg-blue-100 px-3 py-2 rounded-lg"},I("i",{class:"fas fa-clock text-blue-900 mr-2"}),I("span",{class:"text-sm"},Gs(e.created_at))):null)),I("div",{class:"md:w-72 p-6 bg-white/70 backdrop-blur flex flex-col justify-between border-t border-white/40 md:border-t-0 md:border-l md:border-white/40"},I("div",{class:"space-y-3"},I("div",{class:"rounded-2xl border border-white/60 bg-white/90 p-4 shadow-sm backdrop-blur"},I("p",{class:"text-xs text-gray-500 mb-1 uppercase tracking-wide font-semibold"},"Estado del Programa"),I("p",{class:"text-2xl font-bold text-gray-900 mb-2"},s?"Finalizada":n?"Próxima":"Activa"),I("div",{class:"flex items-center text-xs text-gray-500"},I("i",{class:"fas fa-lightbulb mr-1"}),n?"Planificar participación":"Repasar contenidos")),I("div",{class:"rounded-2xl border border-white/60 bg-white/90 p-4 shadow-sm backdrop-blur"},I("p",{class:"text-xs text-gray-500 mb-2 uppercase tracking-wide font-semibold"},"Disponibilidad"),I("div",{class:"flex items-center text-sm text-gray-700 mb-1"},I("i",{class:"fas fa-link text-blue-900 mr-2 w-4"}),I("span",{},e.link?"Enlace disponible":"Sin enlace")),I("div",{class:"flex items-center text-sm text-gray-700"},I("i",{class:"fas fa-calendar text-blue-900 mr-2 w-4"}),I("span",{},n?"Inicia pronto":s?"Completada":"En progreso")))),I("div",{class:"text-right flex flex-col items-end space-y-2 mt-3"},e.link?I("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",class:"btn-primary text-white px-6 py-3 rounded-xl hover-lift transition-all duration-300 text-sm font-medium shadow-soft w-full flex items-center justify-center group"},I("i",{class:"fas fa-external-link-alt mr-2 group-hover:scale-110 transition-transform"}),"Ver Capacitación"):I("span",{class:"text-blue-900 text-sm w-full text-center py-3 bg-blue-100 rounded-xl"},I("i",{class:"fas fa-ban mr-1"}),"Sin enlace disponible")))))}function Dt({icon:e,label:t,metricKey:a}){return I("div",{class:"metric-summary-row"},I("span",{class:"metric-summary-label"},t),I("div",{class:"flex items-center gap-3"},I("span",{class:"metric-summary-value","data-metric":a},"--"),I("span",{class:"metric-summary-icon"},I("i",{class:e}))))}async function Ks(e){var l;if(!e)return;e.innerHTML="",e.className="page-shell";const t=I("section",{class:"page-hero gradient-primary text-white shadow-card"},I("div",{class:"page-hero-content"},I("div",{class:"space-y-6"},I("div",{class:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 border border-white/25 text-white/70 text-xs uppercase tracking-[0.25em]"},I("i",{class:"fas fa-graduation-cap"}),"Aprende sin límites"),I("div",{class:"space-y-3"},I("h1",{class:"text-3xl md:text-5xl font-bold leading-tight text-white"},"Capacitaciones y recursos actualizados"),I("p",{class:"text-white/85 text-base md:text-lg max-w-2xl"},"Mantén tus habilidades vigentes con talleres cuidadosamente seleccionados y contenidos prácticos listos para aplicar en tus próximas oportunidades."))),I("div",{class:"w-full max-w-sm"},I("div",{class:"metric-summary"},I("p",{class:"metric-summary-title"},"Resumen rápido"),Dt({icon:"fas fa-lightbulb",label:"Programas activos",metricKey:"trainings-total"}),Dt({icon:"fas fa-calendar-plus",label:"Próximas fechas",metricKey:"trainings-upcoming"}),Dt({icon:"fas fa-flag-checkered",label:"Finalizadas",metricKey:"trainings-completed"})))));e.appendChild(t);const a={total:t.querySelector('[data-metric="trainings-total"]'),upcoming:t.querySelector('[data-metric="trainings-upcoming"]'),completed:t.querySelector('[data-metric="trainings-completed"]')},n=(i,c)=>{const f=a[i];if(!f)return;if(c==null||c===""){f.textContent="--";return}const d=Number(c);f.textContent=Number.isFinite(d)?d.toLocaleString():String(c)},s=I("section",{class:"page-section"},I("header",{},I("h2",{},"Agenda y recursos"),I("p",{},"Descubre experiencias formativas diseñadas para fortalecer tu perfil profesional y mantenerte al día con las demandas del mercado laboral."))),r=I("div",{class:"grid grid-cols-1 gap-6"});s.appendChild(r);const o=I("p",{class:"text-slate-500"},"Cargando capacitaciones...");s.appendChild(o),e.appendChild(s);try{const i=await Lt();o.remove();const c=Array.isArray(i)?i:Array.isArray(i==null?void 0:i.data)?i.data:[];if(!c.length){const m=I("div",{class:"card-surface rounded-3xl py-12 text-center space-y-4"},I("div",{class:"w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto"},I("i",{class:"fas fa-graduation-cap text-3xl text-blue-600"})),I("h3",{class:"text-xl font-semibold text-slate-900"},"No hay capacitaciones disponibles"),I("p",{class:"text-slate-600 max-w-xl mx-auto"},"Actualmente no hay capacitaciones publicadas. Vuelve más tarde para descubrir nuevas oportunidades o solicita una nueva capacitación desde el centro de mensajes."));s.appendChild(m);return}const f=Date.now();let d=0,p=0;for(const m of c){const y=tt(m.start_date),g=tt(m.end_date);y&&y.getTime()>f?d+=1:g&&g.getTime()<f&&(p+=1),r.appendChild(Ws(m))}n("total",c.length),n("upcoming",d),n("completed",p)}catch(i){o.textContent=`Error: ${((l=i==null?void 0:i.data)==null?void 0:l.message)||i.message}`}}function Qs(){const e=document.querySelector('[data-page="trainings"]');e&&Ks(e)}function A(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}const Ne=new Intl.NumberFormat("es-CO");async function Xs(e){var n;if(!e)return;const{allowed:t}=await ce("unemployed",{alertMessage:"Debes ingresar como cesante para ver tus favoritos.",redirectTo:"/html/pages/home.html"}).catch(()=>({allowed:!1}));if(!t)return;e.innerHTML="";const a=A("div",{class:"text-slate-600"},"Cargando favoritos...");e.appendChild(a);try{const s=await jt({per_page:200,page:1}),r=Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:[],{jobOffers:o,classifieds:l,latestAt:i}=Ys(r);a.remove(),e.appendChild(er(o,l,i))}catch(s){a.textContent=`Error cargando favoritos: ${((n=s==null?void 0:s.data)==null?void 0:n.message)||s.message}`}}function Ys(e){const t=[],a=[];let n=null;for(const s of e){const r=Zs(s);if(r){if(r.createdAt){const o=new Date(r.createdAt);(!n||o>n)&&(n=o)}r.type==="joboffer"?t.push(r.entity):r.type==="classified"&&a.push(r.entity)}}return{jobOffers:t,classifieds:a,latestAt:n}}function Zs(e){var s,r;const t=((s=e==null?void 0:e.pivot)==null?void 0:s.created_at)||(e==null?void 0:e.created_at)||(e==null?void 0:e.createdAt),a=(e==null?void 0:e.jobOffer)||(e==null?void 0:e.job_offer)||((r=e==null?void 0:e.type)!=null&&r.includes("job")?e.item||e.entity:null);if(a)return{type:"joboffer",createdAt:t,entity:Ut(a,t)};if((e==null?void 0:e.type)==="joboffer"||(e==null?void 0:e.type)==="job_offer")return{type:"joboffer",createdAt:t,entity:Ut(e,t)};const n=(e==null?void 0:e.classified)||((e==null?void 0:e.type)==="classified"?e.item||e.entity:null);return n?{type:"classified",createdAt:t,entity:ya(n,t)}:e!=null&&e.title&&(e!=null&&e.company)?{type:"joboffer",createdAt:t,entity:Ut(e,t)}:e!=null&&e.title?{type:"classified",createdAt:t,entity:ya(e,t)}:null}function Ut(e,t){return{id:e.id,title:e.title,description:e.description||e.summary||"",location:e.location||e.city||e.municipality||null,categories:Array.isArray(e.categories)?e.categories:[],company:e.company||null,salary_formatted:e.salary_formatted||e.salaryFormatted||null,_favorite_at:t}}function ya(e,t){return{id:e.id,title:e.title,description:e.description||"",location:e.location||null,categories:Array.isArray(e.categories)?e.categories:[],company:e.company||e.unemployed||null,salary:e.salary||null,contact_email:e.contact_email||null,contact_phone:e.contact_phone||null,_favorite_at:t}}function er(e,t,a){const n=e.length+t.length,s=A("div",{class:"space-y-12"});return s.appendChild(tr(n,e.length,t.length,a)),s.appendChild(ar(e)),s.appendChild(sr(t)),s}function tr(e,t,a,n){const s=n?ea(n):"Aún no hay actividad";return A("section",{class:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-[#102347] via-[#123468] to-[#0b1a31] text-white shadow-2xl"},A("div",{class:"absolute inset-0 opacity-20"},A("div",{class:"absolute -right-20 -top-16 w-72 h-72 bg-white/30 rounded-full blur-3xl"}),A("div",{class:"absolute right-10 bottom-0 w-60 h-60 bg-white/20 rounded-full blur-2xl"})),A("div",{class:"relative z-10 px-8 py-12 lg:px-12"},A("div",{class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8"},A("div",{class:"max-w-2xl space-y-4"},A("div",{class:"inline-flex items-center gap-3 bg-white/10 backdrop-blur px-4 py-2 rounded-full text-sm font-medium uppercase tracking-wide border border-white/20"},A("i",{class:"fas fa-star text-yellow-300"}),"Favoritos personales"),A("h1",{class:"text-4xl lg:text-5xl font-bold leading-tight"},"Sigue de cerca tus oportunidades favoritas"),A("p",{class:"text-white/70 text-lg leading-relaxed"},"Centralizamos en un solo espacio todas tus ofertas laborales y clasificados guardados para que los retomes cuando quieras."),A("div",{class:"flex flex-wrap items-center gap-4 text-white/70 text-sm"},A("div",{class:"inline-flex items-center gap-2"},A("span",{class:"w-2 h-2 rounded-full bg-lime-300"}),"Actividad reciente · ",A("span",{id:"fav-last-updated"},s)),A("span",{class:"hidden lg:inline text-white/60"},"•"),A("a",{href:"/html/pages/home.html",class:"inline-flex items-center gap-2 text-white hover:text-[#9fd3ff] transition-colors"},A("i",{class:"fas fa-arrow-left"}),"Volver al panel principal"))),A("div",{class:"grid grid-cols-1 sm:grid-cols-3 gap-4 w-full lg:w-auto"},Ft("Total guardados",Ne.format(e)),Ft("Ofertas de trabajo",Ne.format(t)),Ft("Clasificados",Ne.format(a)))),A("div",{class:"mt-10 flex flex-wrap gap-4"},A("a",{href:"/html/job-offers/index.html",class:"inline-flex items-center gap-3 bg-white text-[#102347] font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5"},A("i",{class:"fas fa-briefcase"}),"Explorar más ofertas"),A("a",{href:"/html/classifieds/index.html",class:"inline-flex items-center gap-3 bg-white/10 text-white font-semibold px-6 py-3 rounded-xl border border-white/30 hover:bg-white/20 transition-all"},A("i",{class:"fas fa-bullhorn"}),"Ver clasificados disponibles"))))}function Ft(e,t){return A("div",{class:"bg-white/10 backdrop-blur rounded-2xl p-6 shadow-xl border border-white/10"},A("p",{class:"text-white/60 text-sm mb-2"},e),A("p",{class:"text-3xl font-semibold text-white"},t))}function ar(e){const t=A("section",{id:"job-offers",class:"space-y-6"});if(t.appendChild(A("header",{class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},A("div",null,A("h2",{class:"text-2xl font-bold text-gray-900 flex items-center gap-3"},A("span",{class:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-[#ebf1ff] text-[#204180]"},A("i",{class:"fas fa-briefcase"})),"Tus ofertas laborales favoritas"),A("p",{class:"text-gray-500 mt-1"},"Retoma las vacantes que guardaste para aplicarlas en el mejor momento.")),A("span",{class:"inline-flex items-center gap-2 bg-[#eaf1ff] border border-[#cadeff] text-[#1f315b] px-4 py-2 rounded-full text-sm font-semibold"},`${e.length} favorita${e.length===1?"":"s"}`))),!e.length)return t.appendChild(rn({icon:"fa-briefcase",title:"Aún no has guardado ofertas",desc:"Explora las últimas vacantes y guarda las que quieras comparar con calma o revisar más tarde.",ctaHref:"/html/job-offers/index.html",ctaText:"Descubrir ofertas",ctaClass:"btn-primary inline-flex items-center gap-3 px-6 py-3 rounded-xl text-white font-semibold",ctaStyle:"background:#1f315b"})),t;const a=A("div",{class:"space-y-6"});for(const n of e)a.appendChild(nr(n));return t.appendChild(a),t}function nr(e){var r;const t=(e.categories||[]).slice(0,3),a=e._favorite_at?ea(e._favorite_at):"",n=A("article",{class:"card-enhanced hover-lift p-6 lg:p-8","data-favorite-card":"","data-type":"joboffer"}),s=A("button",{class:"favorite-btn w-12 h-12 rounded-full border border-[#b8c7e6] flex items-center justify-center transition-all duration-300 hover-lift bg-[#e4ecff] text-[#1f315b] hover:bg-[#d7e4ff]",title:"Quitar de favoritos"},A("i",{class:"fas fa-heart text-lg"}));return s.addEventListener("click",async o=>{o.stopPropagation(),confirm("¿Quieres quitar este elemento de tus favoritos?")&&await on("joboffer",e.id,n)}),n.appendChild(A("div",{class:"flex flex-col lg:flex-row gap-6"},A("div",{class:"flex-1 space-y-4"},A("div",{class:"flex items-start justify-between gap-4"},A("div",{class:"space-y-3"},A("div",{class:"flex items-center gap-3"},A("span",{class:"inline-flex items-center gap-2 px-3 py-1 text-sm font-semibold rounded-full bg-[#e2ecff] text-[#1f315b]"},A("i",{class:"fas fa-building"}),((r=e.company)==null?void 0:r.name)||"Empresa"),a?A("span",{class:"text-sm text-gray-500 flex items-center gap-2"},A("i",{class:"fas fa-clock"}),a):null),A("a",{href:`/html/job-offers/show.html?id=${encodeURIComponent(e.id)}`,class:"group block"},A("h3",{class:"text-xl lg:text-2xl font-bold text-gray-900 group-hover:text-blue-700 transition-colors"},e.title||"Oferta")),e.description?A("p",{class:"text-gray-600 leading-relaxed"},cn(ln(e.description),200)):null,A("div",{class:"flex flex-wrap gap-2"},A("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#f2f6ff] text-[#1f315b] text-xs font-semibold"},A("i",{class:"fas fa-map-marker-alt"}),e.location||"Ubicación no disponible"),...t.map(o=>A("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs font-semibold"},A("i",{class:"fas fa-tag"}),o.name||o)))),s)),A("div",{class:"lg:w-72 space-y-4"},A("div",{class:"bg-[#f1f5ff] border border-[#d5e1ff] rounded-2xl p-5"},A("p",{class:"text-xs uppercase tracking-wide text-[#1f3b6d] mb-1 font-semibold"},"Salario estimado"),A("p",{class:"text-2xl font-bold text-[#0d2344]"},e.salary_formatted||"A convenir"),A("span",{class:"inline-flex items-center gap-1 text-xs text-[#3964a6] mt-2"},A("i",{class:"fas fa-info-circle"}),"Puede variar según experiencia")),A("a",{href:`/html/job-offers/show.html?id=${encodeURIComponent(e.id)}`,class:"inline-flex items-center justify-center gap-2 w-full px-4 py-3 rounded-xl border border-[#c7d6f6] text-[#1f315b] font-semibold hover:bg-[#f2f6ff] transition-all"},A("i",{class:"fas fa-eye"}),"Ver detalles")))),n}function sr(e){const t=A("section",{id:"classifieds",class:"space-y-6 pt-4 border-t border-gray-100"});if(t.appendChild(A("header",{class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},A("div",null,A("h2",{class:"text-2xl font-bold text-gray-900 flex items-center gap-3"},A("span",{class:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-[#eef3ff] text-[#1f315b]"},A("i",{class:"fas fa-bullhorn"})),"Clasificados guardados"),A("p",{class:"text-gray-500 mt-1"},"Mantén cerca los servicios o anuncios que planeas revisar con detalle.")),A("span",{class:"inline-flex items-center gap-2 bg-[#eef3ff] border border-[#cfd7ea] text-[#1f315b] px-4 py-2 rounded-full text-sm font-semibold"},`${e.length} favorito${e.length===1?"":"s"}`))),!e.length)return t.appendChild(rn({icon:"fa-bullhorn",title:"Sin clasificados favoritos por ahora",desc:"Guarda los anuncios que más te llamen la atención para hacer seguimiento o contactarte cuando te quede mejor.",ctaHref:"/html/classifieds/index.html",ctaText:"Explorar clasificados",ctaClass:"inline-flex items-center gap-3 px-6 py-3 rounded-xl border",ctaStyle:"border-color:#c7d6f6; color:#1f315b"})),t;const a=A("div",{class:"space-y-6"});for(const n of e)a.appendChild(rr(n));return t.appendChild(a),t}function rr(e){var r,o,l;const t=(e.categories||[]).slice(0,3),a=e._favorite_at?ea(e._favorite_at):"",n=A("article",{class:"card-enhanced hover-lift p-6 lg:p-8","data-favorite-card":"","data-type":"classified"}),s=A("button",{class:"favorite-btn w-12 h-12 rounded-full border border-[#b8c7e6] flex items-center justify-center transition-all duration-300 hover-lift bg-[#e4ecff] text-[#1f315b] hover:bg-[#d7e4ff]",title:"Quitar de favoritos"},A("i",{class:"fas fa-heart text-lg"}));return s.addEventListener("click",async i=>{i.stopPropagation(),confirm("¿Quieres quitar este elemento de tus favoritos?")&&await on("classified",e.id,n)}),n.appendChild(A("div",{class:"flex flex-col lg:flex-row gap-6"},A("div",{class:"flex-1 space-y-4"},A("div",{class:"flex items-start justify-between gap-4"},A("div",{class:"space-y-3"},A("div",{class:"flex items-center gap-3 flex-wrap"},A("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#e2ecff] text-[#1f315b] text-sm font-semibold"},((r=e.company)==null?void 0:r.business_name)||((o=e.company)==null?void 0:o.name)||((l=e.unemployed)==null?void 0:l.name)||"Publicación individual"),a?A("span",{class:"text-sm text-gray-500 flex items-center gap-2"},A("i",{class:"fas fa-clock"}),a):null),A("a",{href:`/html/classifieds/show.html?id=${encodeURIComponent(e.id)}`,class:"group block"},A("h3",{class:"text-xl lg:text-2xl font-bold text-gray-900 group-hover:text-purple-700 transition-colors"},e.title||"Clasificado")),e.description?A("p",{class:"text-gray-600 leading-relaxed"},cn(ln(e.description),220)):null,A("div",{class:"flex flex-wrap gap-2"},A("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#f2f6ff] text-[#1f315b] text-xs font-semibold"},A("i",{class:"fas fa-map-marker-alt"}),e.location||"Ubicación no disponible"),...t.map(i=>A("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs font-semibold"},A("i",{class:"fas fa-tag"}),i.name||i)),e.salary?A("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#fff4e6] text-[#9a6a2a] text-xs font-semibold"},A("i",{class:"fas fa-dollar-sign"}),`$${Ne.format(e.salary)}`):null)),s)),A("div",{class:"lg:w-72 space-y-4"},A("div",{class:"bg-[#f1f5ff] border border-[#d5e1ff] rounded-2xl p-5"},A("p",{class:"text-xs uppercase tracking-wide text-[#1f3b6d] mb-1 font-semibold"},"Contacto"),A("p",{class:"text-base text-[#0d2344]"},e.contact_email||e.contact_phone||"Ver detalles para más información")),A("a",{href:`/html/classifieds/show.html?id=${encodeURIComponent(e.id)}`,class:"inline-flex items-center justify-center gap-2 w-full px-4 py-3 rounded-xl border border-[#c7d6f6] text-[#1f315b] font-semibold hover:bg-[#f2f6ff] transition-all"},A("i",{class:"fas fa-eye"}),"Ver detalles del clasificado")))),n}function rn({icon:e,title:t,desc:a,ctaHref:n,ctaText:s,ctaClass:r,ctaStyle:o}){return A("div",{class:"card-enhanced p-10 text-center space-y-4"},A("div",{class:"flex justify-center"},A("div",{class:"w-20 h-20 rounded-3xl bg-blue-50 text-blue-600 flex items-center justify-center text-4xl"},A("i",{class:`fas ${e}`}))),A("h3",{class:"text-2xl font-semibold text-gray-700"},t),A("p",{class:"text-gray-500 max-w-xl mx-auto"},a),A("a",{href:n,class:r,style:o||""},s))}async function on(e,t,a){var n;try{(await nt({type:e,id:t})).isFavorite||(a.style.transition="all 0.25s ease-out",a.style.transform="translateX(20px)",a.style.opacity="0",setTimeout(()=>{a.remove(),or()},200))}catch(s){alert(((n=s==null?void 0:s.data)==null?void 0:n.message)||s.message||"No se pudo cambiar el estado de favorito.")}}function or(){try{const e=document.querySelectorAll('[data-favorite-card][data-type="joboffer"]').length,t=document.querySelectorAll('[data-favorite-card][data-type="classified"]').length,a=e+t,n=document.querySelector('[data-page="favorites"]');if(!n)return;const s=n.querySelectorAll("section .grid .text-3xl.font-semibold.text-white");(s==null?void 0:s.length)>=3&&(s[0].textContent=Ne.format(a),s[1].textContent=Ne.format(e),s[2].textContent=Ne.format(t));const r=document.querySelector("#job-offers header span");r&&(r.textContent=`${e} favorita${e===1?"":"s"}`);const o=document.querySelector("#classifieds header span");o&&(o.textContent=`${t} favorito${t===1?"":"s"}`);const l=document.getElementById("fav-last-updated");l&&(l.textContent="Actualizado hace un momento")}catch{}}function ea(e){const t=e instanceof Date?e:new Date(e),a=(Date.now()-t.getTime())/1e3;if(a<60)return"hace unos segundos";if(a<3600)return`hace ${Math.floor(a/60)} min`;if(a<86400)return`hace ${Math.floor(a/3600)} h`;const n=Math.floor(a/86400);if(n<30)return`hace ${n} día${n===1?"":"s"}`;const s=Math.floor(n/30);if(s<12)return`hace ${s} mes${s===1?"":"es"}`;const r=Math.floor(s/12);return`hace ${r} año${r===1?"":"s"}`}function ln(e){const t=document.createElement("div");return t.innerHTML=e||"",t.textContent||t.innerText||""}function cn(e,t){return e?e.length>t?e.slice(0,t-1)+"…":e:""}function ir(){const e=document.querySelector('[data-page="favorites"]');e&&Xs(e)}function lr(e={}){return H("/message",{query:e})}async function dn({receiver_id:e,content:t}){if(!e||!t){const r=new Error("receiver_id y content son requeridos");throw r.status=422,r}const a={receiver_id:e,content:t},n=[{path:"/message",method:"POST"},{path:"/messages",method:"POST"},{path:"/send-message",method:"POST"}];let s=null;for(const r of n)try{return await H(r.path,{method:r.method,body:a})}catch(o){s=o}if(location.hostname==="localhost"||location.hostname==="127.0.0.1")return{id:Date.now(),receiver_id:e,content:t,status:"sent",created_at:new Date().toISOString()};throw s||new Error("No se pudo enviar el mensaje")}function W(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}async function cr(e){if(!e)return;e.innerHTML="";const t=W("div",{class:"mb-6"},W("div",{class:"bg-white rounded-2xl shadow-soft p-6 border border-blue-900/30"},W("div",{class:"flex items-center justify-between"},W("div",{class:"flex items-center"},W("i",{class:"fas fa-comments text-blue-700 text-2xl mr-3"}),W("div",null,W("h1",{class:"text-2xl font-bold"},"Centro de Mensajes"),W("p",{class:"text-sm text-gray-500"},"Conversaciones y mensajes en tiempo real (UI simulada)"))),W("div",null,W("a",{href:"/html/forms/message-form.html",class:"text-sm text-blue-600 hover:underline"},"Nuevo mensaje")))));e.appendChild(t);const n=new URLSearchParams(location.search).get("success");n&&e.appendChild(W("div",{class:"bg-gradient-to-r from-green-500 to-green-600 text-white p-3 rounded-xl mb-6 shadow-soft"},n));const s=W("div",{class:"bg-white rounded-2xl shadow-soft overflow-hidden border border-blue-900/30",style:"height:70vh;"},W("div",{class:"flex h-full"},W("aside",{class:"w-80 border-r border-gray-100 p-4 flex flex-col"},W("div",{class:"mb-4"},W("input",{type:"text",id:"searchContacts",placeholder:"Buscar...",class:"w-full border border-gray-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-200"})),W("div",{class:"flex-1 overflow-auto",id:"contactsList"},W("p",{class:"text-slate-500 p-3"},"Cargando contactos…"))),W("section",{class:"flex-1 flex flex-col"},W("div",{class:"border-b border-gray-100 p-4 flex items-center gap-3"},W("div",{id:"convAvatar",class:"w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-semibold"},"?"),W("div",{class:"min-w-0"},W("div",{id:"convName",class:"font-semibold truncate"},"Selecciona un contacto"),W("div",{id:"convMeta",class:"text-xs text-gray-500"}," "))),W("div",{id:"messagesList",class:"flex-1 overflow-auto p-4 space-y-2 bg-gray-50"},W("p",{class:"text-slate-500"},"No hay conversación seleccionada")),W("form",{id:"composer",class:"border-t border-gray-100 p-3 flex items-end gap-2"},W("textarea",{id:"composerInput",rows:"1",placeholder:"Escribe un mensaje…",class:"flex-1 border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-200 resize-none"}),W("button",{id:"composerSend",type:"submit",class:"inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg"},W("i",{class:"fa-solid fa-paper-plane"})," Enviar")))));e.appendChild(s);let r=[],o=new Map,l=null,i=null;const c=e.querySelector("#contactsList"),f=e.querySelector("#searchContacts"),d=e.querySelector("#messagesList"),p=e.querySelector("#convName"),m=e.querySelector("#convMeta"),y=e.querySelector("#convAvatar"),g=e.querySelector("#composer"),h=e.querySelector("#composerInput"),E=e.querySelector("#composerSend");try{i=await ue()}catch{}await $(),await v(),M(),r.length&&k(r[0].id),f==null||f.addEventListener("input",()=>C()),g==null||g.addEventListener("submit",async w=>{var P,D;w.preventDefault();const O=h.value.trim();if(l&&O){E.disabled=!0;try{const R=await dn({receiver_id:l,content:O}),X=o.get(l)||{messages:[],lastAt:null};X.messages.push(x(R)),X.lastAt=((P=X.messages[X.messages.length-1])==null?void 0:P.created_at)||X.lastAt,o.set(l,X),h.value="",q(),j(),M()}catch(R){alert(((D=R==null?void 0:R.data)==null?void 0:D.message)||R.message||"No se pudo enviar el mensaje")}finally{E.disabled=!1}}});function C(){const w=((f==null?void 0:f.value)||"").toLowerCase();for(const O of c.querySelectorAll(".contact-item")){const P=(O.getAttribute("data-name")||"").toLowerCase();O.style.display=P.includes(w)?"flex":"none"}}async function $(){var w;try{r=await sn(),Array.isArray(r)||(r=[])}catch(O){c.innerHTML="",c.appendChild(W("p",{class:"text-red-600 p-3"},`Error cargando contactos: ${((w=O==null?void 0:O.data)==null?void 0:w.message)||O.message}`))}}async function v(){try{const w=await lr({per_page:100}),P=(Array.isArray(w)?w:Array.isArray(w==null?void 0:w.data)?w.data:[]).map(x).filter(Boolean);o=new Map;for(const D of P){let R=null;if((i==null?void 0:i.id)!=null&&(D.sender_id===i.id?R=D.receiver_id:D.receiver_id===i.id&&(R=D.sender_id)),R==null&&(R=D.other_user_id||D.receiver_id||D.sender_id),!R)continue;const X=o.get(R)||{messages:[],lastAt:null};X.messages.push(D),X.lastAt=D.created_at||X.lastAt,o.set(R,X)}for(const D of o.values())D.messages.sort((R,X)=>new Date(R.created_at)-new Date(X.created_at))}catch(w){console.warn("Error cargando mensajes:",w)}}function x(w){var re,Ee;if(!w)return null;const O=w.id??w.message_id??void 0,P=w.sender_id??w.user_id??w.from_id??((re=w.sender)==null?void 0:re.id),D=w.receiver_id??w.to_id??((Ee=w.receiver)==null?void 0:Ee.id),R=w.content??w.body??w.text??w.message??"",X=w.created_at??w.sent_at??w.date??new Date().toISOString();return{id:O,sender_id:P,receiver_id:D,content:R,created_at:X,other_user_id:D||P}}function M(){var O;if(c.innerHTML="",!r.length&&o.size===0){c.appendChild(W("p",{class:"text-slate-500 p-3"},"Sin contactos"));return}const w=r.map(P=>{var D,R,X,de;return{id:P.id,name:P.name||P.email||`ID ${P.id}`,lastMsg:((X=(R=(D=o.get(P.id))==null?void 0:D.messages)==null?void 0:R.slice(-1)[0])==null?void 0:X.content)||"",lastAt:((de=o.get(P.id))==null?void 0:de.lastAt)||null}});for(const[P,D]of o.entries())w.find(R=>R.id===P)||w.push({id:P,name:`Usuario ${P}`,lastMsg:((O=D.messages.slice(-1)[0])==null?void 0:O.content)||"",lastAt:D.lastAt});w.sort((P,D)=>new Date(D.lastAt||0)-new Date(P.lastAt||0));for(const P of w){const D=W("button",{type:"button",class:`contact-item w-full text-left p-3 rounded-xl mb-2 flex items-center hover:bg-gray-50 transition ${l===P.id?"bg-gray-100":""}`,"data-id":String(P.id),"data-name":P.name}),R=W("div",{class:"w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center font-semibold mr-3"},(P.name||"?").charAt(0).toUpperCase()),X=W("div",{class:"flex-1 min-w-0"},W("div",{class:"flex justify-between items-center"},W("div",{class:"text-sm font-semibold truncate"},P.name),W("div",{class:"text-xs text-gray-400"},P.lastAt?b(P.lastAt):" ")),W("div",{class:"text-xs text-gray-500 truncate"},P.lastMsg||" "));D.append(R,X),D.addEventListener("click",()=>k(P.id)),c.appendChild(D)}C()}function k(w){l=w;const O=r.find(R=>R.id===w),P=(O==null?void 0:O.name)||(O==null?void 0:O.email)||`Usuario ${w}`;y.textContent=(P||"?").charAt(0).toUpperCase(),p.textContent=P;const D=o.get(w);m.textContent=D!=null&&D.lastAt?`Último mensaje ${b(D.lastAt)}`:" ",M(),q(),j()}function q(){if(d.innerHTML="",!l){d.appendChild(W("p",{class:"text-slate-500"},"No hay conversación seleccionada"));return}const w=o.get(l);if(!w||!w.messages.length){d.appendChild(W("p",{class:"text-slate-500"},"Aún no hay mensajes. ¡Escribe el primero!"));return}for(const O of w.messages){const P=(i==null?void 0:i.id)!=null&&O.sender_id===i.id,D=W("div",{class:`max-w-[70%] rounded-2xl px-4 py-2 ${P?"bg-indigo-600 text-white self-end ml-auto":"bg-white border border-gray-200"} shadow-sm`},O.content||""),R=W("div",{class:`w-full flex ${P?"justify-end":""}`},W("div",{class:"flex flex-col"},D,W("div",{class:"text-[10px] text-gray-400 mt-1"},b(O.created_at))));d.appendChild(R)}}function j(){d.scrollTop=d.scrollHeight}h==null||h.addEventListener("keydown",w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),g==null||g.requestSubmit())});function b(w){try{const O=new Date(w),P=Math.floor((Date.now()-O.getTime())/1e3);if(P<60)return`hace ${P}s`;const D=Math.floor(P/60);if(D<60)return`hace ${D}m`;const R=Math.floor(D/60);if(R<24)return`hace ${R}h`;const X=Math.floor(R/24);return X<7?`hace ${X}d`:O.toLocaleDateString()}catch{return""}}}function dr(){const e=document.querySelector('[data-page="messages"]');e&&cr(e)}function ur(){const e=document.querySelector('[data-page="message-form"]');e&&fr(e).catch(t=>console.error("Message form init error:",t))}async function fr(e){var y;const t=e.querySelector("#contactList"),a=e.querySelector("#contactSearch"),n=e.querySelector("#receiver_id"),s=e.querySelector("#selectedRecipient"),r=e.querySelector("#selectedAvatar"),o=e.querySelector("#selectedName"),l=e.querySelector("#selectedSubtitle"),i=e.querySelector("#content"),c=e.querySelector("#sendBtn"),f=e.querySelector("#messageForm");t.innerHTML='<p class="text-slate-500 p-3">Cargando contactos…</p>';let d=[];try{d=await sn()}catch(g){t.innerHTML=`<p class="text-red-600 p-3">Error cargando contactos: ${((y=g==null?void 0:g.data)==null?void 0:y.message)||g.message}</p>`}Array.isArray(d)||(d=[]),mr(t,d,m),a&&a.addEventListener("input",()=>{const g=a.value.trim().toLowerCase();Array.from(t.querySelectorAll(".contact-row")).forEach(h=>{const E=(h.getAttribute("data-name")||"").toLowerCase();h.style.display=E.includes(g)?"flex":"none"})});const p=t.querySelector(".contact-row");p&&p.click(),i&&i.addEventListener("keydown",g=>{if(g.key==="Enter"&&!g.shiftKey){if(g.preventDefault(),!n.value)return;f==null||f.requestSubmit()}}),f==null||f.addEventListener("submit",async g=>{var E;if(g.preventDefault(),!n.value)return alert("Selecciona un destinatario primero");const h=i.value.trim();if(!h)return alert("Escribe un mensaje");c.disabled=!0;try{await dn({receiver_id:n.value,content:h}),i.value="",i.focus()}catch(C){alert(((E=C==null?void 0:C.data)==null?void 0:E.message)||C.message||"No se pudo enviar el mensaje")}finally{c.disabled=!1}});function m(g,h){n.value=g.id,s.textContent=g.name||g.email||`ID ${g.id}`,r.textContent=(g.name||g.email||"?").charAt(0).toUpperCase(),o.textContent=g.name||"Nuevo mensaje",l.textContent="Envíale un mensaje",Array.from(t.querySelectorAll(".contact-row")).forEach(E=>E.classList.remove("bg-gray-100")),h&&h.classList.add("bg-gray-100"),c.disabled=!1,i.focus()}}function mr(e,t,a){if(e.innerHTML="",!t.length)return e.appendChild(ve("p",{class:"text-slate-500 p-3"},"Sin contactos"));for(const n of t){const s=ve("button",{type:"button",class:"w-full text-left p-3 hover:bg-gray-50 contact-row flex items-center gap-3 focus:outline-none focus:ring-2 focus:ring-indigo-100","data-id":n.id,"data-name":n.name||n.email||`ID ${n.id}`}),r=ve("div",{class:"w-12 h-12 bg-gradient-to-r from-indigo-600 to-indigo-500 text-white rounded-full flex items-center justify-center font-semibold text-sm"},(n.name||n.email||"?").charAt(0).toUpperCase()),o=ve("div",{class:"font-medium text-sm truncate"},n.name||n.email||`ID ${n.id}`),l=ve("div",{class:"text-xs text-gray-500 truncate"},n.role||"Perfil"),i=ve("div",{class:"flex-1 min-w-0"},ve("div",{class:"flex items-center justify-between"},o,ve("div",{class:"text-xs text-gray-400"}," ")),l);s.append(r,i),s.addEventListener("click",()=>a(n,s)),e.appendChild(s)}}function ve(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function De(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function pr(e){e&&(e.innerHTML="",e.appendChild(De("div",{class:"rounded-2xl border border-dashed border-blue-200 bg-blue-50 p-10 text-center space-y-4 text-blue-900"},De("div",{class:"text-4xl"},"🔔"),De("h2",{class:"text-2xl font-bold"},"Módulo de notificaciones en desarrollo"),De("p",{class:"text-sm max-w-2xl mx-auto text-blue-900/80"},"Pronto podrás recibir avisos de postulaciones, entrevistas y mensajes importantes directamente aquí. Estamos trabajando en esta funcionalidad."),De("a",{href:"/html/pages/home.html",class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition"},De("i",{class:"fas fa-arrow-left"}),"Volver al panel principal"))))}function gr(){const e=document.querySelector('[data-page="notifications"]');e&&pr(e)}function yr(e={}){return H("/portfolio",{query:e})}function hr(e){return H(`/portfolio/${e}`)}async function xr(e){const t=new FormData;e.title&&t.append("title",e.title),e.description&&t.append("description",e.description),e.url_proyect&&t.append("url_proyect",e.url_proyect),e.url_project&&t.append("url_project",e.url_project),e.url_pdf instanceof File&&t.append("url_pdf",e.url_pdf);const a=["/portfolio","/portfolios","/agg-portfolio"];let n;for(const s of a)try{return await H(s,{method:"POST",body:t})}catch(r){if(n=r,(r==null?void 0:r.status)===401||(r==null?void 0:r.status)===403||(r==null?void 0:r.status)===422)throw r;continue}throw n||new Error("No fue posible crear el portafolio")}function br(e,t){return H(`/portfolio/${e}`,{method:"PUT",body:t})}function vr(e){return H(`/portfolio/${e}`,{method:"DELETE"})}function Y(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:s.startsWith("on")&&typeof r=="function"?n.addEventListener(s.slice(2).toLowerCase(),r):n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function wr(e){return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:[]}function Sr(e){return e?/^https?:\/\//i.test(e)?e:`${Qt}/storage/portfolios/${encodeURIComponent(e)}`:null}function Cr(){return Y("div",{class:"mb-8 animate-fade-in-up"},Y("div",{class:"bg-white rounded-2xl shadow-soft p-8 mb-6 border border-blue-900/30"},Y("div",{class:"flex flex-col md:flex-row justify-between items-center"},Y("div",{class:"mb-4 md:mb-0"},Y("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},Y("i",{class:"fas fa-briefcase text-blue-800 mr-3"}),"Mis Portafolios"),Y("p",{class:"text-gray-600"},"Muestra tus proyectos y logros profesionales")),Y("div",{class:"flex items-center space-x-4"},Y("a",{href:"/html/portfolio/create.html",class:"btn-primary text-white px-6 py-3 rounded-xl hover-lift flex items-center shadow-soft"},Y("i",{class:"fas fa-plus mr-2"}),"Agregar Portafolio")))))}function _r(e,t){const a=e.url_proyect||e.url_project||e.file_url||"",n=Sr(e.url_pdf),s=e.id,r=Y("div",{class:"card-enhanced hover-lift p-6 animate-slide-in"},Y("div",{class:"flex justify-between items-start"},Y("div",{class:"flex-1"},Y("div",{class:"flex items-start justify-between mb-4"},Y("div",{class:"flex-1"},Y("h2",{class:"text-xl font-semibold text-gray-800 mb-2"},Y("i",{class:"fas fa-folder-open text-blue-700 mr-2"}),e.title||"Portafolio"),Y("p",{class:"text-gray-600 mb-4 leading-relaxed"},e.description||""),Y("div",{class:"flex items-center flex-wrap gap-4 mb-4"},a?Y("a",{href:a,target:"_blank",rel:"noopener",class:"flex items-center text-blue-600 hover:text-blue-800 transition-colors"},Y("i",{class:"fas fa-globe mr-1"}),"Ver Proyecto"):null,n?Y("a",{href:n,target:"_blank",rel:"noopener",class:"flex items-center text-purple-600 hover:text-purple-800 transition-colors"},Y("i",{class:"fas fa-file-pdf mr-1"}),"Ver PDF"):null)))),Y("div",{class:"text-right flex flex-col items-end"},Y("div",{class:"flex space-x-2 mb-3"},Y("a",{href:`/html/portfolio/edit.html?id=${encodeURIComponent(s)}`,class:"bg-gradient-to-r from-gray-600 to-gray-700 text-white px-4 py-2 rounded-xl hover-lift transition-all duration-300 text-sm font-medium shadow-soft"},Y("i",{class:"fas fa-edit mr-1"}),"Editar"),Y("button",{type:"button",class:"bg-gradient-to-r from-red-800 to-red-900 text-white px-4 py-2 rounded-xl hover-lift transition-all duration-300 text-sm font-medium shadow-soft",onClick:async()=>{var l;if(!(!s||!confirm("¿Estás seguro de eliminar este portafolio?")))try{await vr(s),t==null||t(r)}catch(i){alert(((l=i==null?void 0:i.data)==null?void 0:l.message)||i.message||"No se pudo eliminar.")}}},Y("i",{class:"fas fa-trash mr-1"}),"Eliminar")))));return r}async function Ar(e){var r;if(!e)return;const{allowed:t}=await ce("unemployed");if(!t)return;e.innerHTML="";const a=Cr();e.appendChild(a);const n=Y("div",{class:"grid grid-cols-1 gap-6"}),s=Y("p",{class:"text-slate-500"},"Cargando portafolios...");n.appendChild(s),e.appendChild(n);try{const o=await yr(),l=wr(o);if(n.innerHTML="",!l.length){const i=Y("div",{class:"card-enhanced p-12 text-center animate-fade-in-up"},Y("div",{class:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},Y("i",{class:"fas fa-briefcase text-3xl text-gray-400"})),Y("h3",{class:"text-xl font-semibold text-gray-800 mb-2"},"No tienes portafolios aún"),Y("p",{class:"text-gray-600 mb-6"},"Comienza a mostrar tus proyectos y logros profesionales."),Y("a",{href:"/html/portfolio/create.html",class:"btn-primary text-white px-6 py-3 rounded-xl hover-lift inline-flex items-center"},Y("i",{class:"fas fa-plus mr-2"}),"Crear Primer Portafolio"));n.appendChild(i);return}for(const i of l){const c=_r(i,f=>f==null?void 0:f.remove());n.appendChild(c)}}catch(o){n.innerHTML="",n.appendChild(Y("p",{class:"text-red-600"},((r=o==null?void 0:o.data)==null?void 0:r.message)||o.message||"Error al cargar los portafolios"))}}function Er(){const e=document.querySelector('[data-page="portfolios"]');e&&Ar(e)}function lt(e,t=document){return t.querySelector(e)}function Qe(e,t){var n,s;if(!e)return;let a=(n=e.closest("label, div"))==null?void 0:n.querySelector(".field-error");a||(a=document.createElement("span"),a.className="field-error text-xs font-medium text-red-600",(s=e.closest("label, div"))==null||s.appendChild(a)),a.textContent=t||""}function kr(e){const t={},a=e==null?void 0:e.data;if(a!=null&&a.errors&&typeof a.errors=="object")for(const[n,s]of Object.entries(a.errors))Array.isArray(s)&&s.length&&(t[n]=s[0]);return t}async function jr(e){if(!e)return;const{allowed:t}=await ce("unemployed");if(!t)return;const a=e.querySelector("form")||e,n=lt("#title",a),s=lt("#description",a),r=lt("#url_proyect",a),o=lt("#url_pdf",a),l=e.querySelector("[data-error]")||null;a.addEventListener("submit",async i=>{var f,d,p,m,y;i.preventDefault(),[n,s,r,o].forEach(g=>Qe(g,"")),l&&(l.textContent="");const c={title:((f=n==null?void 0:n.value)==null?void 0:f.trim())||"",description:((d=s==null?void 0:s.value)==null?void 0:d.trim())||"",url_proyect:((p=r==null?void 0:r.value)==null?void 0:p.trim())||"",url_pdf:(m=o==null?void 0:o.files)==null?void 0:m[0]};try{await xr(c),window.location.href="/html/portfolio/list.html"}catch(g){const h=kr(g);h.title&&Qe(n,h.title),h.description&&Qe(s,h.description),(h.url_proyect||h.url_project)&&Qe(r,h.url_proyect||h.url_project),h.url_pdf&&Qe(o,h.url_pdf),l&&!Object.keys(h).length&&(l.textContent=((y=g==null?void 0:g.data)==null?void 0:y.message)||g.message||"Error al crear el portafolio"),console.error("create portfolio error",g)}})}function $r(){const e=document.querySelector('[data-page="portfolio-create"]');e&&jr(e)}function Rt(e,t=document){return t.querySelector(e)}function ct(e,t){var n,s;if(!e)return;let a=(n=e.closest("label, div"))==null?void 0:n.querySelector(".field-error");a||(a=document.createElement("span"),a.className="field-error text-xs font-medium text-red-600",(s=e.closest("label, div"))==null||s.appendChild(a)),a.textContent=t||""}function Lr(e){const t={},a=e==null?void 0:e.data;if(a!=null&&a.errors&&typeof a.errors=="object")for(const[n,s]of Object.entries(a.errors))Array.isArray(s)&&s.length&&(t[n]=s[0]);return t}async function Tr(e){var c;if(!e)return;const{allowed:t}=await ce("unemployed");if(!t)return;const n=new URLSearchParams(window.location.search).get("id"),s=e.querySelector("[data-error]"),r=e.querySelector("form")||e,o=Rt("#title",r),l=Rt("#description",r),i=Rt("#file_url",r);if(!n){s&&(s.classList.remove("hidden"),s.textContent="Falta el parámetro id.");return}try{const f=await hr(n),d=f!=null&&f.data&&!Array.isArray(f.data)?f.data:f;o&&(o.value=(d==null?void 0:d.title)||""),l&&(l.value=(d==null?void 0:d.description)||"");const p=(d==null?void 0:d.file_url)||(d==null?void 0:d.url_proyect)||(d==null?void 0:d.url_project)||"";i&&(i.value=p)}catch(f){s&&(s.classList.remove("hidden"),s.textContent=((c=f==null?void 0:f.data)==null?void 0:c.message)||f.message||"No se pudo cargar el portafolio.")}r.addEventListener("submit",async f=>{var m,y,g,h;f.preventDefault(),[o,l,i].forEach(E=>ct(E,"")),s&&(s.textContent="",s.classList.add("hidden"));const d=((m=i==null?void 0:i.value)==null?void 0:m.trim())||"",p={title:((y=o==null?void 0:o.value)==null?void 0:y.trim())||"",description:((g=l==null?void 0:l.value)==null?void 0:g.trim())||"",file_url:d,url_proyect:d,url_project:d};try{await br(n,p),window.location.href="/html/portfolio/list.html"}catch(E){const C=Lr(E);C.title&&ct(o,C.title),C.description&&ct(l,C.description),(C.file_url||C.url_proyect||C.url_project)&&ct(i,C.file_url||C.url_proyect||C.url_project),s&&!Object.keys(C).length&&(s.classList.remove("hidden"),s.textContent=((h=E==null?void 0:E.data)==null?void 0:h.message)||E.message||"Error al actualizar el portafolio"),console.error("update portfolio error",E)}})}function qr(){const e=document.querySelector('[data-page="portfolio-edit"]');e&&Tr(e)}function dt(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Nr(e){try{return new Date(e).toLocaleString()}catch{return e||""}}function Ir(e){return{pending:"bg-yellow-100 text-yellow-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",scheduled:"bg-blue-100 text-blue-800"}[e]||"bg-gray-100 text-gray-700"}function Mr(e){var y,g,h,E,C,$,v;const t=document.getElementById("job-application-card-template");if(!t)return null;const a=t.content.firstElementChild.cloneNode(!0),n=(((g=(y=e==null?void 0:e.unemployed)==null?void 0:y.user)==null?void 0:g.name)||(e==null?void 0:e.applicant_name)||"??").slice(0,2).toUpperCase();a.querySelector("[data-initials]").textContent=n;const s=((h=e==null?void 0:e.jobOffer)==null?void 0:h.title)||(e==null?void 0:e.title)||`Oferta #${(e==null?void 0:e.job_offer_id)||(e==null?void 0:e.jobOfferId)||""}`,r=((C=(E=e==null?void 0:e.jobOffer)==null?void 0:E.company)==null?void 0:C.name)||(($=e==null?void 0:e.company)==null?void 0:$.name)||"Empresa",o=a.querySelector("[data-job-link]");o&&(o.href=`/html/job-offers/show.html?id=${((v=e==null?void 0:e.jobOffer)==null?void 0:v.id)||(e==null?void 0:e.job_offer_id)||""}`),a.querySelector("[data-job-title]").textContent=s,a.querySelector("[data-company-name]").textContent=r;const l=a.querySelector("[data-status-badge]");l&&(l.textContent=(e==null?void 0:e.status_label)||(e==null?void 0:e.status)||"Estado",l.className=`ml-2 inline-block px-2 py-0.5 rounded text-xs font-semibold ${Ir(e==null?void 0:e.status)}`);const i=a.querySelector("[data-created-at]");i&&(i.textContent=(e==null?void 0:e.created_at)||"");const c=a.querySelector("[data-message]");if(c.textContent=(e==null?void 0:e.message)||"Sin mensaje",e!=null&&e.cv_url){const x=a.querySelector("[data-cv-link]");x.href=e.cv_url,x.classList.remove("hidden")}const f=a.querySelector("[data-latest-interview]"),d=Array.isArray(e==null?void 0:e.interviews)?[...e.interviews].sort((x,M)=>new Date(M.scheduled_at)-new Date(x.scheduled_at))[0]:null;d&&f&&(f.classList.remove("hidden"),f.querySelector("[data-interview-when]").textContent=Nr(d.scheduled_at),f.querySelector("[data-interview-mode]").textContent=d.mode||"N/A",f.querySelector("[data-interview-duration]").textContent=d.duration_minutes||30);const p=a.querySelector('[data-modal="message"]'),m=a.querySelector('[data-action="view-message"]');return m&&(e!=null&&e.message)&&(m.classList.remove("hidden"),m.addEventListener("click",()=>{p==null||p.classList.remove("hidden"),a.querySelector("[data-message-content]").textContent=e.message}),a.querySelector('[data-action="close-message"]').addEventListener("click",()=>p==null?void 0:p.classList.add("hidden"))),a}async function Or(e){var a;if(!e)return;e.innerHTML="";const t=dt("p",{class:"text-slate-500"},"Cargando postulaciones...");e.appendChild(t);try{if(!document.getElementById("job-application-card-template"))try{const o=await fetch("/html/includes/job-application-card.html",{credentials:"same-origin"});if(o.ok){const l=await o.text(),i=document.createElement("div");i.style.display="none",i.innerHTML=l,document.body.appendChild(i)}}catch{}const n=await ge(),s=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:[];if(t.remove(),!s.length)return e.appendChild(dt("p",{class:"text-slate-500"},"Sin postulaciones"));const r=dt("div",{class:"space-y-4"});for(const o of s){const l=Mr(o);r.appendChild(l||dt("div",{class:"rounded-lg border p-3 bg-white"},`Postulación #${o.id||""}`))}e.appendChild(r)}catch(n){t.textContent=`Error: ${((a=n==null?void 0:n.data)==null?void 0:a.message)||n.message}`}}function Pr(){const e=document.querySelector('[data-page="job-applications"]');e&&Or(e)}function Q(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Dr(e){try{return new Date(e).toLocaleString()}catch{return e||""}}function Ur(e){return{pending:"bg-yellow-100 text-yellow-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",scheduled:"bg-blue-100 text-blue-800"}[e]||"bg-gray-100 text-gray-700"}async function Fr(){if(!document.getElementById("job-application-card-template"))try{const e=await fetch("/html/includes/job-application-card.html",{credentials:"same-origin"});if(e.ok){const t=await e.text(),a=document.createElement("div");a.style.display="none",a.innerHTML=t,document.body.appendChild(a)}}catch{}}function Rr(e){var y,g,h,E,C,$,v;const t=document.getElementById("job-application-card-template");if(!t)return null;const a=t.content.firstElementChild.cloneNode(!0),n=(((g=(y=e==null?void 0:e.unemployed)==null?void 0:y.user)==null?void 0:g.name)||(e==null?void 0:e.applicant_name)||"??").slice(0,2).toUpperCase();a.querySelector("[data-initials]").textContent=n;const s=((h=e==null?void 0:e.jobOffer)==null?void 0:h.title)||(e==null?void 0:e.title)||`Oferta #${(e==null?void 0:e.job_offer_id)||(e==null?void 0:e.jobOfferId)||""}`,r=((C=(E=e==null?void 0:e.jobOffer)==null?void 0:E.company)==null?void 0:C.name)||(($=e==null?void 0:e.company)==null?void 0:$.name)||"Empresa",o=a.querySelector("[data-job-link]");o&&(o.href=`/html/job-offers/show.html?id=${((v=e==null?void 0:e.jobOffer)==null?void 0:v.id)||(e==null?void 0:e.job_offer_id)||""}`),a.querySelector("[data-job-title]").textContent=s,a.querySelector("[data-company-name]").textContent=r;const l=a.querySelector("[data-status-badge]");l&&(l.textContent=(e==null?void 0:e.status_label)||(e==null?void 0:e.status)||"Estado",l.className=`ml-2 inline-block px-2 py-0.5 rounded text-xs font-semibold ${Ur(e==null?void 0:e.status)}`);const i=a.querySelector("[data-created-at]");i&&(i.textContent=(e==null?void 0:e.created_at)||"");const c=a.querySelector("[data-message]");if(c&&(c.textContent=(e==null?void 0:e.message)||"Sin mensaje"),e!=null&&e.cv_url){const x=a.querySelector("[data-cv-link]");x&&(x.href=e.cv_url,x.classList.remove("hidden"))}const f=a.querySelector("[data-latest-interview]"),d=Array.isArray(e==null?void 0:e.interviews)?[...e.interviews].sort((x,M)=>new Date(M.scheduled_at)-new Date(x.scheduled_at))[0]:null;d&&f&&(f.classList.remove("hidden"),f.querySelector("[data-interview-when]").textContent=Dr(d.scheduled_at),f.querySelector("[data-interview-mode]").textContent=d.mode||"N/A",f.querySelector("[data-interview-duration]").textContent=d.duration_minutes||30);const p=a.querySelector('[data-modal="message"]'),m=a.querySelector('[data-action="view-message"]');return m&&(e!=null&&e.message)&&(m.classList.remove("hidden"),m.addEventListener("click",()=>{p==null||p.classList.remove("hidden"),a.querySelector("[data-message-content]").textContent=e.message}),a.querySelector('[data-action="close-message"]').addEventListener("click",()=>p==null?void 0:p.classList.add("hidden"))),a}function Hr({q:e,status:t}){const a=Q("form",{class:"home-hero-actions flex items-center gap-3",role:"search"}),n=Q("input",{type:"search",name:"q",value:e||"",placeholder:"Buscar por título o empresa",class:"border rounded px-3 py-2 text-sm w-56"}),s=Q("select",{name:"status",class:"border rounded px-3 py-2 text-sm"},Q("option",{value:""},"Todos los estados"),Q("option",{value:"pending",selected:t==="pending"?"":null},"Pendiente"),Q("option",{value:"accepted",selected:t==="accepted"?"":null},"Aceptada"),Q("option",{value:"rejected",selected:t==="rejected"?"":null},"Rechazada")),r=Q("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded text-sm"},"Filtrar");return a.append(n,s,r),a.addEventListener("submit",l=>{l.preventDefault();const i=new URLSearchParams(location.search);i.set("q",n.value||""),i.set("status",s.value||""),i.delete("page"),history.replaceState(null,"",`${location.pathname}?${i.toString()}`);const c=document.querySelector('[data-page="job-applications-unemployed"]');c&&St(c)}),Q("section",{class:"home-hero"},Q("div",{class:"home-hero-pattern"}),Q("div",{class:"home-hero-content container mx-auto px-4"},Q("div",{class:"home-hero-main"},Q("span",{class:"home-hero-badge"},"Postulaciones"),Q("h1",{class:"home-hero-title"},"Mis postulaciones a ofertas"),Q("p",{class:"home-hero-subtitle"},"Revisa el estado de tus postulaciones, descarga tu CV y gestiona entrevistas."),a),Q("aside",{class:"home-hero-summary"},Q("div",{class:"home-hero-metric"},Q("div",null,"Total"),Q("div",{"data-kpi":"total"},"0")),Q("div",{class:"home-hero-metric"},Q("div",null,"Pendientes"),Q("div",{"data-kpi":"pending"},"0")),Q("div",{class:"home-hero-metric"},Q("div",null,"Aceptadas"),Q("div",{"data-kpi":"accepted"},"0")),Q("div",{class:"home-hero-metric"},Q("div",null,"Rechazadas"),Q("div",{"data-kpi":"rejected"},"0")))))}function Br(e){const t={total:e.length,pending:0,accepted:0,rejected:0};for(const a of e){const n=((a==null?void 0:a.status)||"").toLowerCase();n==="pending"?t.pending++:n==="accepted"?t.accepted++:n==="rejected"&&t.rejected++}return t}async function St(e){var l,i,c;if(!e)return;const{user:t,allowed:a}=await ce("unemployed").catch(()=>({allowed:!1}));if(!a)return;e.innerHTML="";const n=Object.fromEntries(new URLSearchParams(location.search).entries()),s=Hr({q:n.q||"",status:n.status||""});e.appendChild(s),n.success&&((l=window.UI)!=null&&l.createAlert)&&e.appendChild(window.UI.createAlert({type:"success",content:n.success})),n.error&&((i=window.UI)!=null&&i.createAlert)&&e.appendChild(window.UI.createAlert({type:"error",content:n.error}));const r=Q("div",{class:"min-h-[120px]"});e.appendChild(r);const o=Q("p",{class:"text-slate-500"},"Cargando postulaciones...");r.appendChild(o),await Fr();try{const f=parseInt(n.page||"1",10)||1,p=await ge({q:n.q||void 0,status:n.status||void 0,page:f,per_page:10}),m=Array.isArray(p)?p:Array.isArray(p==null?void 0:p.data)?p.data:[],y=Br(m);for(const[C,$]of Object.entries(y)){const v=s.querySelector(`[data-kpi="${C}"]`);v&&(v.textContent=String($))}if(o.remove(),!m.length){const C=Q("div",{class:"bg-white rounded-lg shadow p-8 text-center"},Q("div",{class:"text-4xl"},"🙌"),Q("h3",{class:"mt-4 text-xl font-semibold text-gray-800"},"Aún no tienes postulaciones"),Q("p",{class:"mt-2 text-sm text-gray-500"},"Explora ofertas y aplica a las que te interesen. Cuando te postules, aquí verás el estado y los horarios de entrevistas."),Q("div",{class:"mt-4"},Q("a",{href:"/html/job-offers/index.html",class:"bg-indigo-600 text-white px-4 py-2 rounded"},"Ver ofertas")));r.appendChild(C);return}const g=Q("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"});for(const C of m){const $=Rr(C);g.appendChild($||Q("div",{class:"rounded-lg border p-3 bg-white"},`Postulación #${C.id||""}`))}r.appendChild(g);const h=(p==null?void 0:p.meta)||{},E=h.last_page||h.lastPage||void 0;if(E&&E>1){const C=Q("div",{class:"mt-8 flex items-center gap-2"},Q("button",{class:"px-3 py-1 border rounded "+(f<=1?"opacity-50 cursor-not-allowed":""),disabled:f<=1?"":null},"Anterior"),Q("span",{class:"text-sm text-gray-600"},`Página ${f} de ${E}`),Q("button",{class:"px-3 py-1 border rounded "+(f>=E?"opacity-50 cursor-not-allowed":""),disabled:f>=E?"":null},"Siguiente")),[$,,v]=C.children;$.addEventListener("click",()=>{if(f>1){const x=new URLSearchParams(location.search);x.set("page",String(f-1)),history.replaceState(null,"",`${location.pathname}?${x}`),St(e)}}),v.addEventListener("click",()=>{if(f<E){const x=new URLSearchParams(location.search);x.set("page",String(f+1)),history.replaceState(null,"",`${location.pathname}?${x}`),St(e)}}),r.appendChild(C)}}catch(f){o.textContent=`Error: ${((c=f==null?void 0:f.data)==null?void 0:c.message)||f.message}`}}function zr(){const e=document.querySelector('[data-page="job-applications-unemployed"]');e&&St(e)}function Z(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Vr(e){try{return new Date(e).toLocaleString()}catch{return e||""}}function Jr(e){return{pending:"bg-yellow-100 text-yellow-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",scheduled:"bg-blue-100 text-blue-800"}[e]||"bg-gray-100 text-gray-700"}async function Gr(){if(!document.getElementById("job-application-card-template"))try{const e=await fetch("/html/includes/job-application-card.html",{credentials:"same-origin"});if(e.ok){const t=await e.text(),a=document.createElement("div");a.style.display="none",a.innerHTML=t,document.body.appendChild(a)}}catch{}}function Wr(e){var y,g,h,E,C,$,v;const t=document.getElementById("job-application-card-template");if(!t)return null;const a=t.content.firstElementChild.cloneNode(!0),n=(((g=(y=e==null?void 0:e.unemployed)==null?void 0:y.user)==null?void 0:g.name)||(e==null?void 0:e.applicant_name)||"??").slice(0,2).toUpperCase();a.querySelector("[data-initials]").textContent=n;const s=((h=e==null?void 0:e.jobOffer)==null?void 0:h.title)||(e==null?void 0:e.title)||`Oferta #${(e==null?void 0:e.job_offer_id)||(e==null?void 0:e.jobOfferId)||""}`,r=((C=(E=e==null?void 0:e.jobOffer)==null?void 0:E.company)==null?void 0:C.name)||(($=e==null?void 0:e.company)==null?void 0:$.name)||"Empresa",o=a.querySelector("[data-job-link]");o&&(o.href=`/html/job-offers/show.html?id=${((v=e==null?void 0:e.jobOffer)==null?void 0:v.id)||(e==null?void 0:e.job_offer_id)||""}`),a.querySelector("[data-job-title]").textContent=s,a.querySelector("[data-company-name]").textContent=r;const l=a.querySelector("[data-status-badge]");l&&(l.textContent=(e==null?void 0:e.status_label)||(e==null?void 0:e.status)||"Estado",l.className=`ml-2 inline-block px-2 py-0.5 rounded text-xs font-semibold ${Jr(e==null?void 0:e.status)}`);const i=a.querySelector("[data-created-at]");i&&(i.textContent=(e==null?void 0:e.created_at)||"");const c=a.querySelector("[data-message]");if(c&&(c.textContent=(e==null?void 0:e.message)||"Sin mensaje"),e!=null&&e.cv_url){const x=a.querySelector("[data-cv-link]");x&&(x.href=e.cv_url,x.classList.remove("hidden"))}const f=a.querySelector("[data-latest-interview]"),d=Array.isArray(e==null?void 0:e.interviews)?[...e.interviews].sort((x,M)=>new Date(M.scheduled_at)-new Date(x.scheduled_at))[0]:null;d&&f&&(f.classList.remove("hidden"),f.querySelector("[data-interview-when]").textContent=Vr(d.scheduled_at),f.querySelector("[data-interview-mode]").textContent=d.mode||"N/A",f.querySelector("[data-interview-duration]").textContent=d.duration_minutes||30);const p=a.querySelector('[data-modal="message"]'),m=a.querySelector('[data-action="view-message"]');return m&&(e!=null&&e.message)&&(m.classList.remove("hidden"),m.addEventListener("click",()=>{p==null||p.classList.remove("hidden"),a.querySelector("[data-message-content]").textContent=e.message}),a.querySelector('[data-action="close-message"]').addEventListener("click",()=>p==null?void 0:p.classList.add("hidden"))),a}function Kr({q:e,status:t,counts:a}){const n=Z("form",{class:"home-hero-actions flex items-center gap-2 bg-white rounded-lg shadow-sm px-3 py-2",role:"search"}),s=Z("input",{type:"search",name:"q",placeholder:"Buscar candidato u oferta",value:e||"",class:"text-sm rounded border-gray-200 px-3 py-2"}),r=Z("select",{name:"status",class:"text-sm rounded border-gray-200 px-2 py-2"},Z("option",{value:""},"Todos"),Z("option",{value:"pending",selected:t==="pending"?"":null},"Pendiente"),Z("option",{value:"accepted",selected:t==="accepted"?"":null},"Aceptada"),Z("option",{value:"rejected",selected:t==="rejected"?"":null},"Rechazada")),o=Z("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded text-sm"},"Buscar");return n.append(s,r,o),n.addEventListener("submit",i=>{i.preventDefault();const c=new URLSearchParams(location.search);c.set("q",s.value||""),c.set("status",r.value||""),c.delete("page"),history.replaceState(null,"",`${location.pathname}?${c.toString()}`);const f=document.querySelector('[data-page="job-applications-company"]');f&&Ct(f)}),Z("section",{class:"home-hero"},Z("div",{class:"home-hero-pattern"}),Z("div",{class:"home-hero-content container mx-auto px-4"},Z("div",{class:"home-hero-main"},Z("span",{class:"home-hero-badge"},"Postulaciones"),Z("h1",{class:"home-hero-title"},"Postulaciones a mis ofertas"),Z("p",{class:"home-hero-subtitle"},"Revisa, filtra y responde a las postulaciones en un solo lugar."),n),Z("aside",{class:"home-hero-summary"},Z("div",{class:"home-hero-metric"},Z("div",null,"Total"),Z("div",{"data-kpi":"total"},String((a==null?void 0:a.total)||0))),Z("div",{class:"home-hero-metric"},Z("div",null,"Pendientes"),Z("div",{"data-kpi":"pending"},String((a==null?void 0:a.pending)||0))),Z("div",{class:"home-hero-metric"},Z("div",null,"Aceptadas"),Z("div",{"data-kpi":"accepted"},String((a==null?void 0:a.accepted)||0))),Z("div",{class:"home-hero-metric"},Z("div",null,"Rechazadas"),Z("div",{"data-kpi":"rejected"},String((a==null?void 0:a.rejected)||0))))))}function Qr(e){const t={total:e.length,pending:0,accepted:0,rejected:0};for(const a of e){const n=((a==null?void 0:a.status)||"").toLowerCase();n==="pending"?t.pending++:n==="accepted"?t.accepted++:n==="rejected"&&t.rejected++}return t}async function Ct(e){var o,l,i;if(!e)return;const{allowed:t}=await ce("company").catch(()=>({allowed:!1}));if(!t)return;e.innerHTML="";const a=Object.fromEntries(new URLSearchParams(location.search).entries()),n=Z("div");e.appendChild(n);const s=Z("div",{class:"container mx-auto px-4 mt-6"});n.appendChild(s),a.success&&((o=window.UI)!=null&&o.createAlert)&&s.appendChild(window.UI.createAlert({type:"success",content:a.success})),a.error&&((l=window.UI)!=null&&l.createAlert)&&s.appendChild(window.UI.createAlert({type:"error",content:a.error}));const r=Z("p",{class:"text-slate-500"},"Cargando postulaciones...");s.appendChild(r),await Gr();try{const c=parseInt(a.page||"1",10)||1,d=await ge({q:a.q||void 0,status:a.status||void 0,page:c,per_page:10}),p=Array.isArray(d)?d:Array.isArray(d==null?void 0:d.data)?d.data:[],m=Qr(p);if(n.insertBefore(Kr({q:a.q,status:a.status,counts:m}),s),r.remove(),!p.length){s.appendChild(Z("div",{class:"bg-white rounded-lg p-6 text-center text-gray-500"},"No hay postulaciones para mostrar."));return}const y=Z("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"});for(const E of p){const C=Wr(E);y.appendChild(C||Z("div",{class:"rounded-lg border p-3 bg-white"},`Postulación #${E.id||""}`))}s.appendChild(y);const g=(d==null?void 0:d.meta)||{},h=g.last_page||g.lastPage||void 0;if(h&&h>1){const E=Z("div",{class:"mt-6 flex items-center gap-2"},Z("button",{class:"px-3 py-1 border rounded "+(c<=1?"opacity-50 cursor-not-allowed":""),disabled:c<=1?"":null},"Anterior"),Z("span",{class:"text-sm text-gray-600"},`Página ${c} de ${h}`),Z("button",{class:"px-3 py-1 border rounded "+(c>=h?"opacity-50 cursor-not-allowed":""),disabled:c>=h?"":null},"Siguiente")),[C,,$]=E.children;C.addEventListener("click",()=>{if(c>1){const v=new URLSearchParams(location.search);v.set("page",String(c-1)),history.replaceState(null,"",`${location.pathname}?${v}`),Ct(e)}}),$.addEventListener("click",()=>{if(c<h){const v=new URLSearchParams(location.search);v.set("page",String(c+1)),history.replaceState(null,"",`${location.pathname}?${v}`),Ct(e)}}),s.appendChild(E)}}catch(c){r.textContent=`Error: ${((i=c==null?void 0:c.data)==null?void 0:i.message)||c.message}`}}function Xr(){const e=document.querySelector('[data-page="job-applications-company"]');e&&Ct(e)}function oe(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Yr(e){if(!e)return;tn(!0).then(o=>{if(be(o)!=="unemployed"){const i=new URL("/html/pages/home.html",location.origin);i.searchParams.set("error","No tienes permisos para postular a ofertas con este rol."),location.assign(i.toString());return}}).catch(()=>{});const t=Object.fromEntries(new URLSearchParams(location.search).entries()),a=document.referrer||"/html/job-offers/index.html",n=oe("div",{class:"max-w-3xl mx-auto py-10 px-4"},oe("div",{class:"mb-6"},oe("a",{href:a,class:"text-sm text-gray-600 hover:text-gray-800 inline-flex items-center gap-2"},"← Volver")),oe("div",{class:"bg-white rounded-lg shadow p-6"},oe("h2",{class:"text-2xl font-extrabold text-gray-800 mb-3"},"Postularse a una oferta"),oe("div",{id:"alert-area"}),oe("form",{class:"space-y-4"},oe("input",{type:"hidden",name:"unemployed_id",value:t.unemployed_id||""}),oe("input",{type:"hidden",name:"job_offer_id",value:t.job_offer_id||t.id||""}),oe("div",null,oe("label",{for:"message",class:"block text-sm font-medium text-gray-700"},"Mensaje (opcional)"),oe("textarea",{name:"message",id:"message",rows:"4",maxlength:"2000",class:"mt-1 block w-full border border-gray-200 rounded-md px-3 py-2"})),oe("div",null,oe("label",{for:"cv",class:"block text-sm font-medium text-gray-700"},"Adjuntar CV (opcional, PDF/DOC/DOCX, máx 5MB)"),oe("input",{type:"file",name:"cv",id:"cv",accept:".pdf,.doc,.docx",class:"mt-1 block w-full border border-gray-200 rounded px-2 py-1"})),oe("div",{class:"pt-2"},oe("button",{type:"submit",class:"w-full bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 font-semibold"},"Enviar postulación")))));e.innerHTML="",e.appendChild(n);const s=n.querySelector("form"),r=n.querySelector("#alert-area");s.addEventListener("submit",async o=>{var f,d,p,m;o.preventDefault(),r.innerHTML="";const l=new FormData(s),i={unemployed_id:l.get("unemployed_id")||void 0,job_offer_id:l.get("job_offer_id")||void 0,message:l.get("message")||""},c=(d=(f=s.querySelector("#cv"))==null?void 0:f.files)==null?void 0:d[0];c&&(i.cv=c);try{await Xa(i);const y="/html/job-applications/index-unemployed.html?success="+encodeURIComponent("Postulación enviada correctamente");location.assign(y)}catch(y){const g=((p=y==null?void 0:y.data)==null?void 0:p.message)||(y==null?void 0:y.message)||"Error al enviar la postulación";(m=window.UI)!=null&&m.createAlert?r.appendChild(window.UI.createAlert({type:"error",content:g})):(r.textContent=g,r.className="bg-red-50 border border-red-200 text-red-800 px-4 py-2 rounded mb-4")}})}function Zr(){const e=document.querySelector('[data-page="job-application-create"]');e&&Yr(e)}function eo(e){return e?typeof e=="string"?e:typeof e!="object"?null:[e.token,e.access_token,e.accessToken,e.bearer_token,e.bearerToken,e.plainTextToken,e.plain_text_token,e.value].find(a=>typeof a=="string")||null:null}function _t(e){var a,n,s,r,o,l,i,c,f,d,p,m,y,g,h,E,C,$;const t=[e==null?void 0:e.token,e==null?void 0:e.access_token,e==null?void 0:e.accessToken,e==null?void 0:e.auth_token,e==null?void 0:e.bearer_token,(a=e==null?void 0:e.data)==null?void 0:a.token,(n=e==null?void 0:e.data)==null?void 0:n.access_token,(s=e==null?void 0:e.data)==null?void 0:s.accessToken,(r=e==null?void 0:e.data)==null?void 0:r.auth_token,(o=e==null?void 0:e.data)==null?void 0:o.bearer_token,(l=e==null?void 0:e.meta)==null?void 0:l.token,(i=e==null?void 0:e.meta)==null?void 0:i.access_token,(f=(c=e==null?void 0:e.data)==null?void 0:c.token)==null?void 0:f.plainTextToken,(p=(d=e==null?void 0:e.data)==null?void 0:d.token)==null?void 0:p.token,(y=(m=e==null?void 0:e.data)==null?void 0:m.token)==null?void 0:y.access_token,(h=(g=e==null?void 0:e.data)==null?void 0:g.token)==null?void 0:h.value,(E=e==null?void 0:e.token)==null?void 0:E.plainTextToken,(C=e==null?void 0:e.token)==null?void 0:C.token,($=e==null?void 0:e.token)==null?void 0:$.access_token];for(const v of t){const x=eo(v);if(x)return x}return null}function Gt(e,t=new Set){if(!e||typeof e!="object"||t.has(e))return null;if(t.add(e),Array.isArray(e)){for(const r of e){const o=Gt(r,t);if(o)return o}return null}const a=["data","user","attributes","payload"];for(const r of a)if(e[r]&&typeof e[r]=="object"){const o=Gt(e[r],t);if(o)return o}return["id","uuid","name","email","role","roles","type","company","unemployed"].some(r=>r in e)?e:null}function un(e){var a,n,s,r,o,l,i,c;const t=[e==null?void 0:e.user,(a=e==null?void 0:e.data)==null?void 0:a.user,(s=(n=e==null?void 0:e.data)==null?void 0:n.data)==null?void 0:s.user,(o=(r=e==null?void 0:e.data)==null?void 0:r.user)==null?void 0:o.data,(l=e==null?void 0:e.user)==null?void 0:l.data,(i=e==null?void 0:e.data)==null?void 0:i.data,e==null?void 0:e.data,(c=e==null?void 0:e.payload)==null?void 0:c.user,e==null?void 0:e.payload];for(const f of t){const d=Gt(f);if(d)return d}return null}function At(e){if(e){try{localStorage.setItem("auth_token",e)}catch{}try{localStorage.setItem("auth_mode","bearer")}catch{}Te({mode:"bearer",token:e}),pe(e)}}function Et(){try{localStorage.setItem("auth_mode","cookie"),localStorage.removeItem("auth_token")}catch{}Te({mode:"cookie"}),pe(void 0)}async function fn({email:e,password:t}){const a={email:e,password:t},n=Ie(),s=["/login","/inicia-sesion","/sign-in"],r=[],o=new Set;let l=null;const i=(d,p)=>{for(const m of s){const y=`${d}|${p}|${m}`;o.has(y)||(o.add(y),r.push({transport:d,authMode:p,path:m}))}};n==="bearer"?(i("api","bearer"),i("api","cookie"),i("web","cookie")):(i("web","cookie"),i("api","cookie"),i("api","bearer"));const c=async({transport:d,authMode:p,path:m})=>(d==="web"?Ae:H)(m,{method:"POST",body:a,auth:p});let f=null;for(const d of r)try{const p=await c(d),m=un(p);if(d.authMode==="bearer"){const g=_t(p);if(g)return At(g),{mode:"bearer",token:g,user:m||null,response:p};l||(l={response:p,user:m||null});continue}const y=_t(p);return y?(At(y),{mode:"bearer",token:y,user:m||null,response:p}):(Et(),{mode:"cookie",token:null,user:m||null,response:p})}catch(p){f=p;const m=p==null?void 0:p.status;if(m===404||m===405||m===419||m===401)continue;if(m===422||m===423||m===429||m===400)throw p}if(l)return Et(),{mode:"cookie",token:null,user:l.user,response:l.response};throw f||new Error("Unable to login")}async function to(e){const t=Ie(),a=["/register","/create-user","/agg-user"],n=[],s=new Set;let r=null;const o=(c,f)=>{for(const d of a){const p=`${c}|${f}|${d}`;s.has(p)||(s.add(p),n.push({transport:c,authMode:f,path:d}))}};t==="bearer"?(o("api","bearer"),o("api","cookie"),o("web","cookie")):(o("web","cookie"),o("api","cookie"),o("api","bearer"));const l=async({transport:c,authMode:f,path:d})=>(c==="web"?Ae:H)(d,{method:"POST",body:e,auth:f});let i=null;for(const c of n)try{const f=await l(c),d=un(f);if(c.authMode==="bearer"){const m=_t(f);if(m)return At(m),{mode:"bearer",token:m,user:d||null,response:f};r||(r={response:f,user:d||null});continue}const p=_t(f);return p?(At(p),{mode:"bearer",token:p,user:d||null,response:f}):(Et(),{mode:"cookie",token:null,user:d||null,response:f})}catch(f){i=f;const d=f==null?void 0:f.status;if(d===404||d===405||d===419||d===401)continue;throw f}if(r)return Et(),{mode:"cookie",token:null,user:r.user,response:r.response};throw i||new Error("Unable to register")}async function mn({redirect:e="/html/pages/home.html",params:t={}}={}){var i,c,f,d;const a=(((c=(i=import.meta)==null?void 0:i.env)==null?void 0:c.VITE_GOOGLE_OAUTH_URL)||"").trim(),n=(((d=(f=import.meta)==null?void 0:f.env)==null?void 0:d.VITE_GOOGLE_OAUTH_PATH)||"").trim(),s=new URLSearchParams(t);if(e&&typeof e=="string"&&s.set("redirect",e),a.startsWith("http")){const p=ha(a,s);window.location.href=p;return}const r=[];n&&r.push(n),r.push("/auth/google/redirect","/auth/google","/login/google","/oauth/google/redirect","/oauth/google","/social/google/redirect","/social/google","/api/auth/google/redirect","/api/auth/google","/api/login/google");const o=[];for(const p of no(r))try{const m=ao(p);if(o.push(m),(await fetch(m,{method:"GET",credentials:"include",mode:"cors"})).status!==404){const g=ha(m,s);window.location.href=g;return}}catch{}const l=`No se encontró el endpoint de Google en el backend. Probé:
`+o.join(`
`);alert(l)}function ao(e){return/^https?:\/\//i.test(e)?e:Qt+(e.startsWith("/")?e:`/${e}`)}function no(e){const t=[],a=new Set;for(const n of e){const s=String(n).trim();!s||a.has(s)||(a.add(s),t.push(s))}return t}function ha(e,t){if(!t||t instanceof URLSearchParams&&!Array.from(t.keys()).length)return e;const a=new URL(e);for(const[n,s]of t instanceof URLSearchParams?t:new URLSearchParams(t))s!=null&&s!==""&&a.searchParams.set(n,String(s));return a.toString()}function Ht(e={}){return H("/company",{query:e})}async function so(e){var r,o;const t=[{body:{...e}},{body:{company_name:e.name,email:e.email,nit:e.nit,website:e.website,description:e.description}},{body:{companyName:e.name,email:e.email,tax_id:e.nit,website_url:e.website,description:e.description}},{body:{name:e.name,email:e.email,nit:e.nit,website:e.website,about:e.description}}],a=[{fn:H,path:"/company"}];Ie()==="cookie"&&a.push({fn:(l,i)=>H(l,{...i,auth:"cookie"}),path:"/company"});let n,s;for(const l of a)for(const i of t)try{return await l.fn(l.path,{method:"POST",body:i.body})}catch(c){if(n=c,!s&&(c!=null&&c.status)&&c.status!==404&&c.status!==405&&(s=c),(c==null?void 0:c.status)===401||(c==null?void 0:c.status)===403||(c==null?void 0:c.status)===422)throw c;if((c==null?void 0:c.status)===404)break}try{if((()=>{try{return new URL(window.location.origin).origin===new URL(ROOT_BASE_URL||window.location.origin).origin}catch{return!1}})()){const i=["/agg-company","/register-company","/empresa","/empresas","/empresas/crear"];for(const c of i)try{return await Ae(c,{method:"POST",body:e})}catch(f){if(n=f,(f==null?void 0:f.status)===401||(f==null?void 0:f.status)===403||(f==null?void 0:f.status)===422)throw f;continue}}}catch{}try{if(typeof import.meta<"u"&&((o=(r=import.meta)==null?void 0:r.env)==null?void 0:o.VITE_FAKE_COMPANY_WHEN_FAIL)==="true"||["localhost","127.0.0.1"].includes(window.location.hostname)){const i={id:Date.now(),...e,company_name:e.name,created_at:new Date().toISOString()},c="local_companies",f=JSON.parse(localStorage.getItem(c)||"[]");return f.push(i),localStorage.setItem(c,JSON.stringify(f)),i}}catch{}throw s||n||new Error("No fue posible registrar la empresa")}async function ta(e={}){var n,s,r;const t=["/company/count","/companies/count","/empresas/count"];let a=null;for(const o of t)try{const l=await H(o,{query:e}),i=typeof l=="number"?l:(l==null?void 0:l.total)??(l==null?void 0:l.count)??((n=l==null?void 0:l.data)==null?void 0:n.total);if(Number.isFinite(i))return i}catch(l){a=l}try{const o=await Ht({...e,per_page:1,page:1}),l=((s=o==null?void 0:o.meta)==null?void 0:s.total)??(o==null?void 0:o.total)??void 0;if(Number.isFinite(l))return l}catch(o){a=o}try{const o=[{per_page:1e3,page:1},{limit:1e3,page:1},{per_page:5e3,page:1}];for(const l of o){const i=await Ht({...e,...l}),c=((r=i==null?void 0:i.meta)==null?void 0:r.total)??(i==null?void 0:i.total);if(Number.isFinite(c))return c;const f=Array.isArray(i)?i:Array.isArray(i==null?void 0:i.data)?i.data:[];if(f.length>0)return f.length}}catch(o){a=o}try{const o=await Ht({...e});return(Array.isArray(o)?o:Array.isArray(o==null?void 0:o.data)?o.data:[]).length}catch(o){a=o}if(a)throw a;return 0}function ut(e,t=document){return t.querySelector(e)}function ro(e,t,a){e&&e.addEventListener(t,a)}function oo(e){return e.querySelector("form")||e}function Bt(e,t){e&&(e.textContent=t||"")}function ft(e,t){var n,s;if(!e)return;let a=(n=e.closest("label, div"))==null?void 0:n.querySelector(".field-error");a||(a=document.createElement("span"),a.className="field-error text-xs font-medium text-red-600",(s=e.closest("label, div"))==null||s.appendChild(a)),a.textContent=t||""}function xa(){const t=new URLSearchParams(window.location.search).get("redirect");return t&&t.startsWith("/")?t:"/html/pages/home.html"}function io(e){const t=e==null?void 0:e.data;if(t&&t.errors&&typeof t.errors=="object"){const a=Object.values(t.errors)[0];if(Array.isArray(a)&&a.length)return a[0]}return(t==null?void 0:t.message)||(e==null?void 0:e.message)||"Error inesperado"}async function lo(e){if(!e)return;const t=oo(e),a=ut('input[name="email"]',t),n=ut('input[name="password"]',t),s=e.querySelector("[data-auth-error]")||null,r=e.querySelector("[data-stat-jobs]"),o=e.querySelector("[data-stat-companies]");try{const c=e.querySelector('a[href^="/auth/google"]');c&&c.addEventListener("click",f=>{f.preventDefault();const d=new URL(c.getAttribute("href"),window.location.origin),p=new URLSearchParams(d.search),m=new URLSearchParams(window.location.search).get("redirect"),y=m&&m.startsWith("/")?m:"/html/pages/home.html";mn({redirect:y,params:Object.fromEntries(p.entries())})})}catch{}const l=ut("#togglePassword"),i=ut("#eyeIcon");if(l&&n&&l.addEventListener("click",()=>{const c=n.getAttribute("type")==="password";n.setAttribute("type",c?"text":"password"),i==null||i.classList.toggle("fa-eye"),i==null||i.classList.toggle("fa-eye-slash")}),Ie()==="bearer")try{const c=localStorage.getItem("auth_token");c&&pe(c)}catch{}try{const c=await ue();if(c&&(c.id||c.email)){window.location.href=xa();return}}catch{}(async()=>{try{const[c,f]=await Promise.all([Ce({status:"active"}),ta()]);r&&(r.textContent=String(c)),o&&(o.textContent=String(f))}catch{r&&(r.textContent="—"),o&&(o.textContent="—")}})(),ro(t,"submit",async c=>{var d,p,m,y,g,h,E,C;c.preventDefault(),Bt(s,""),ft(a,""),ft(n,"");const f={email:((d=a==null?void 0:a.value)==null?void 0:d.trim())||"",password:(n==null?void 0:n.value)||""};try{const $=await fn(f);let v=($==null?void 0:$.user)||null;try{v||(v=await ue())}catch{}if(!v&&($!=null&&$.response)&&typeof $.response=="object"){const x=((m=(p=$.response)==null?void 0:p.data)==null?void 0:m.user)||((y=$.response)==null?void 0:y.user)||null;x&&typeof x=="object"&&(v=x)}if(v){const x=be(v);try{const M=((g=v==null?void 0:v.company)==null?void 0:g.company_name)||((h=v==null?void 0:v.company)==null?void 0:h.name)||(v==null?void 0:v.company_name)||"",k=x==="company"?M||(v==null?void 0:v.name)||"":(v==null?void 0:v.name)||"";x&&x!=="guest"&&localStorage.setItem("display_role",x),k&&localStorage.setItem("display_name",k)}catch{}if(x==="admin"){window.location.href="/html/admin/dashboard.html";return}}window.location.href=xa()}catch($){const v=$==null?void 0:$.data;v!=null&&v.errors?((E=v.errors.email)!=null&&E[0]&&ft(a,v.errors.email[0]),(C=v.errors.password)!=null&&C[0]&&ft(n,v.errors.password[0]),v.message||Bt(s,"Corrige los campos marcados.")):Bt(s,io($)),console.error("login error",$)}})}function co(){const e=document.querySelector('[data-page="auth-login"]');e&&lo(e)}function je(e,t=document){return t.querySelector(e)}function uo(e,t,a){e&&e.addEventListener(t,a)}function fo(e){return e.querySelector("form")||e}function zt(e,t){e&&(e.textContent=t||"")}function we(e,t){var n,s;if(!e)return;let a=(n=e.closest("label, div"))==null?void 0:n.querySelector(".field-error");a||(a=document.createElement("span"),a.className="field-error text-xs font-medium text-red-600",(s=e.closest("label, div"))==null||s.appendChild(a)),a.textContent=t||""}function mo(){const t=new URLSearchParams(window.location.search).get("redirect");return t&&t.startsWith("/")?t:"/html/pages/home.html"}function po(e){const t=e==null?void 0:e.data;if(t&&t.errors&&typeof t.errors=="object"){const a=Object.values(t.errors)[0];if(Array.isArray(a)&&a.length)return a[0]}return(t==null?void 0:t.message)||(e==null?void 0:e.message)||"Error inesperado"}async function go(e){if(!e)return;const t=fo(e),a=je('input[name="name"]',t),n=je('input[name="email"]',t),s=je('input[name="password"]',t),r=je('input[name="password_confirmation"]',t),o=()=>je('input[name="type"]:checked',t),l=e.querySelector("[data-auth-error]")||null,i=e.querySelector("[data-stat-jobs]"),c=e.querySelector("[data-stat-companies]"),f=je("#togglePassword"),d=je("#eyeIcon");if(f&&s&&f.addEventListener("click",()=>{const p=s.getAttribute("type")==="password";s.setAttribute("type",p?"text":"password"),d==null||d.classList.toggle("fa-eye"),d==null||d.classList.toggle("fa-eye-slash")}),Ie()==="bearer")try{const p=localStorage.getItem("auth_token");p&&pe(p)}catch{}try{const p=e.querySelectorAll('a[href^="/auth/google"]'),y=new URLSearchParams(window.location.search).get("redirect");for(const g of p)g.addEventListener("click",h=>{h.preventDefault();const E=new URL(g.getAttribute("href"),window.location.origin),C=new URLSearchParams(E.search),$=y&&y.startsWith("/")?y:"/html/pages/home.html";mn({redirect:$,params:Object.fromEntries(C.entries())})})}catch{}try{const p=await ue();if(p&&(p.id||p.email)){const m=(pageQS.get("type")||"").toLowerCase(),y=m.includes("company")||m.includes("empresa")?"company":m.includes("unemployed")||m.includes("cesante")?"unemployed":"";if(y==="company"){window.location.href="/html/forms/company-form.html";return}if(y==="unemployed"){window.location.href="/html/forms/unemployed-form.html";return}window.location.href="/html/pages/home.html";return}}catch{}(async()=>{try{const[p,m]=await Promise.all([Ce({status:"active"}),ta()]);i&&(i.textContent=String(p)),c&&(c.textContent=String(m))}catch{i&&(i.textContent="—"),c&&(c.textContent="—")}})(),uo(t,"submit",async p=>{var y,g,h,E,C,$,v,x,M,k;p.preventDefault(),zt(l,""),we(a,""),we(n,""),we(s,""),we(r,"");const m={name:((y=a==null?void 0:a.value)==null?void 0:y.trim())||"",email:((g=n==null?void 0:n.value)==null?void 0:g.trim())||"",password:(s==null?void 0:s.value)||"",password_confirmation:(r==null?void 0:r.value)||"",...(h=o())!=null&&h.value?{type:o().value}:{}};try{const q=await to(m);let j=q;try{const R=await fn({email:m.email,password:m.password});R&&(j=R)}catch(R){console.warn("auto-login after register failed:",R)}const b=(j==null?void 0:j.user)||(q==null?void 0:q.user)||null,w=b?be(b):null,O=(((E=o())==null?void 0:E.value)||"").toLowerCase(),P=O.includes("empresa")||O.includes("company")?"company":O.includes("cesante")||O.includes("unemployed")?"unemployed":"",D=w&&w!=="guest"?w:P;try{D&&(localStorage.setItem("pending_role",D),localStorage.setItem("display_role",D));let R=(b==null?void 0:b.name)||"";D==="company"&&(R=((C=b==null?void 0:b.company)==null?void 0:C.company_name)||(($=b==null?void 0:b.company)==null?void 0:$.name)||(b==null?void 0:b.company_name)||R),!R&&(a!=null&&a.value)&&(R=a.value.trim()),R&&(localStorage.setItem("pending_name",R),localStorage.setItem("display_name",R))}catch{}D==="unemployed"?window.location.href="/html/forms/unemployed-form.html":D==="company"?window.location.href="/html/forms/company-form.html":window.location.href=mo()}catch(q){const j=q==null?void 0:q.data;j!=null&&j.errors?((v=j.errors.name)!=null&&v[0]&&we(a,j.errors.name[0]),(x=j.errors.email)!=null&&x[0]&&we(n,j.errors.email[0]),(M=j.errors.password)!=null&&M[0]&&we(s,j.errors.password[0]),(k=j.errors.password_confirmation)!=null&&k[0]&&we(r,j.errors.password_confirmation[0]),j.message||zt(l,"Corrige los campos marcados.")):zt(l,po(q)),console.error("register error",q)}})}function yo(){const e=document.querySelector('[data-page="auth-register"]');e&&go(e)}function ho(e,t=document){return t.querySelector(e)}function xo(e,t,a){e&&e.addEventListener(t,a)}function mt(e,t){e&&(e.textContent=t||"")}function bo(e){const t=e==null?void 0:e.data;if(t&&t.errors&&typeof t.errors=="object"){const a=Object.values(t.errors)[0];if(Array.isArray(a)&&a.length)return a[0]}return(t==null?void 0:t.message)||(e==null?void 0:e.message)||"Error inesperado"}function vo(e){if(!e)return;const t=e.querySelector("form"),a=ho('input[name="email"]',t),n=e.querySelector("[data-ok]"),s=e.querySelector("[data-error]");xo(t,"submit",async r=>{var o;r.preventDefault(),mt(n,""),mt(s,"");try{await Ae("/forgot-password",{method:"POST",body:{email:((o=a==null?void 0:a.value)==null?void 0:o.trim())||""}}),mt(n,"Si el correo existe, enviamos el enlace de recuperación.")}catch(l){mt(s,bo(l)),console.error("forgot-password error",l)}})}function wo(){const e=document.querySelector('[data-page="auth-forgot-password"]');e&&vo(e)}function pt(e,t=document){return t.querySelector(e)}function So(e,t,a){e&&e.addEventListener(t,a)}function gt(e,t){e&&(e.textContent=t||"")}function Co(e){const t=e==null?void 0:e.data;if(t&&t.errors&&typeof t.errors=="object"){const a=Object.values(t.errors)[0];if(Array.isArray(a)&&a.length)return a[0]}return(t==null?void 0:t.message)||(e==null?void 0:e.message)||"Error inesperado"}function _o(e){if(!e)return;const t=e.querySelector("form"),a=pt('input[name="token"]',t),n=pt('input[name="email"]',t),s=pt('input[name="password"]',t),r=pt('input[name="password_confirmation"]',t),o=e.querySelector("[data-error]"),l=e.querySelector("[data-ok]"),i=new URLSearchParams(window.location.search);!(a!=null&&a.value)&&i.get("token")&&(a.value=i.get("token")),!(n!=null&&n.value)&&i.get("email")&&(n.value=i.get("email")),So(t,"submit",async c=>{var d;c.preventDefault(),gt(o,""),gt(l,"");const f={token:(a==null?void 0:a.value)||"",email:((d=n==null?void 0:n.value)==null?void 0:d.trim())||"",password:(s==null?void 0:s.value)||"",password_confirmation:(r==null?void 0:r.value)||""};try{await Ae("/reset-password",{method:"POST",body:f}),gt(l,"Contraseña actualizada. Redirigiendo al inicio de sesión..."),setTimeout(()=>{window.location.href="/html/auth/login.html"},1200)}catch(p){gt(o,Co(p)),console.error("reset-password error",p)}})}function Ao(){const e=document.querySelector('[data-page="auth-reset-password"]');e&&_o(e)}function he(e,t=document){return t.querySelector(e)}function Eo(e,t,a){e&&e.addEventListener(t,a)}function ko(e){const t=e==null?void 0:e.data;if(t&&t.errors&&typeof t.errors=="object"){const a=Object.values(t.errors)[0];if(Array.isArray(a)&&a.length)return a[0]}return(t==null?void 0:t.message)||(e==null?void 0:e.message)||"Error inesperado"}function jo(e){if(!e)return;const t=e.querySelector("form"),a=e.querySelector("[data-ok]"),n=e.querySelector("[data-error]"),s=t==null?void 0:t.querySelector('button[type="submit"]');function r(i,c){i&&(i.classList.remove("hidden"),i.textContent=c||i.textContent)}function o(i){i&&(i.classList.add("hidden"),i.textContent="")}function l(i,c){var d,p;if(!i)return;let f=(d=i.closest("label, div"))==null?void 0:d.querySelector(".field-error");f||(f=document.createElement("span"),f.className="field-error text-xs font-medium text-red-600",(p=i.closest("label, div"))==null||p.appendChild(f)),f.textContent=c||""}Eo(t,"submit",async i=>{var f,d,p,m,y,g,h,E,C,$,v,x,M,k,q,j;i.preventDefault(),o(a),o(n),s&&(s.disabled=!0,s.classList.add("opacity-60","cursor-not-allowed"));const c={name:((d=(f=he("#name",t))==null?void 0:f.value)==null?void 0:d.trim())||"",email:((m=(p=he("#email",t))==null?void 0:p.value)==null?void 0:m.trim())||"",nit:((g=(y=he("#nit",t))==null?void 0:y.value)==null?void 0:g.trim())||"",website:((E=(h=he("#website",t))==null?void 0:h.value)==null?void 0:E.trim())||"",description:(($=(C=he("#description",t))==null?void 0:C.value)==null?void 0:$.trim())||""};try{await so(c),r(a,"Empresa registrada correctamente.");try{localStorage.removeItem("pending_role");const b=localStorage.getItem("pending_name");b&&localStorage.setItem("display_name",b),localStorage.removeItem("pending_name"),localStorage.setItem("display_role","company"),c!=null&&c.name&&localStorage.setItem("display_name",c.name),localStorage.setItem("profile_completed","1")}catch{}setTimeout(()=>{window.location.href="/html/pages/home.html"},1e3)}catch(b){const w=b==null?void 0:b.data;if((b==null?void 0:b.status)===401||(b==null?void 0:b.code)==="AUTH_REQUIRED"){r(n,"Debes iniciar sesión para registrar una empresa. Redirigiendo al login..."),setTimeout(()=>{const P=encodeURIComponent("/html/forms/company-form.html");window.location.href=`/html/auth/login.html?redirect=${P}`},800);return}w!=null&&w.errors&&((v=w.errors.name)!=null&&v[0]&&l(he("#name",t),w.errors.name[0]),(x=w.errors.email)!=null&&x[0]&&l(he("#email",t),w.errors.email[0]),(M=w.errors.nit)!=null&&M[0]&&l(he("#nit",t),w.errors.nit[0]),(k=w.errors.website)!=null&&k[0]&&l(he("#website",t),w.errors.website[0]),(q=w.errors.description)!=null&&q[0]&&l(he("#description",t),w.errors.description[0]));const O=(b==null?void 0:b.status)===500&&!((j=b==null?void 0:b.data)!=null&&j.message)?"Error del servidor (500). Inténtalo más tarde o verifica los datos.":ko(b);r(n,O),console.error("create company error",b)}finally{s&&(s.disabled=!1,s.classList.remove("opacity-60","cursor-not-allowed"))}})}function $o(){const e=document.querySelector('[data-page="company-form"]');e&&jo(e)}function ae(e,t=document){return t.querySelector(e)}function Lo(e,t=document){return Array.from(t.querySelectorAll(e))}function me(e,t,a="ok"){if(!e)return;e.innerHTML="";const n=document.createElement("div");n.className=a==="ok"?"mb-4 rounded-xl border border-green-200 bg-green-50 text-green-800 px-4 py-3 flex items-center gap-3":"mb-4 rounded-xl border border-red-200 bg-red-50 text-red-800 px-4 py-3",n.textContent=typeof t=="string"?t:(t==null?void 0:t.message)||"Algo salió mal",e.appendChild(n)}function To(e){if(!e||typeof e!="string")return"";const[t,a]=e.split("@"),[n="",s=""]=(a||"").split("."),r=t?t[0]+"*".repeat(Math.max(t.length-1,1)):"",o=n?n[0]+"*".repeat(Math.max(n.length-1,1)):"";return`${r}@${o}${s?"."+s:""}`}async function Ue(e,{method:t="POST",body:a}={}){return await Ae(e,{method:t,body:a})}function Fe(e){const t={},a=new FormData(e);for(const[n,s]of a.entries())t[n]!==void 0?(Array.isArray(t[n])||(t[n]=[t[n]]),t[n].push(s)):t[n]=s;return Lo('input[type="checkbox"][name]',e).forEach(n=>{const s=n.name;t[s]=n.checked?1:t[s]??0}),t}function qo(e){const t=ae("#settingsNav",e);if(!t)return;t.querySelectorAll('a[href^="#"]').forEach(r=>{r.addEventListener("click",o=>{o.preventDefault();const l=r.getAttribute("href"),i=l?ae(l):null;i==null||i.scrollIntoView({behavior:"smooth",block:"start"})})});const a=["#cuenta","#notificaciones","#apariencia","#seguridad","#zona-peligro"].map(r=>ae(r)).filter(Boolean),n=Array.from(t.querySelectorAll("a")),s=new IntersectionObserver(r=>{r.forEach(o=>{if(o.isIntersecting){const l="#"+o.target.id;n.forEach(i=>{i.classList.remove("bg-blue-50","text-blue-800"),i.getAttribute("href")===l&&i.classList.add("bg-blue-50","text-blue-800")})}})},{rootMargin:"-40% 0px -55% 0px",threshold:.1});a.forEach(r=>s.observe(r))}function No(e){const t=ae("#deleteAccountForm",e),a=ae("#deleteAccountBtn",e);if(!t||!a)return;const n=()=>{const s=t.querySelector('input[name="current_password"]').value.trim(),r=t.querySelector('input[name="email_confirm"]').value.trim(),o=t.querySelector('input[name="confirm"]').value.trim().toUpperCase(),l=t.querySelector('input[name="acknowledge"]').checked,i=s.length>0&&r.length>0&&o==="ELIMINAR"&&l;a.disabled=!i,a.classList.toggle("opacity-60",!i),a.classList.toggle("cursor-not-allowed",!i)};t.querySelectorAll("input").forEach(s=>s.addEventListener("input",n)),n()}function Io(e){return{cuenta:ae("#cuenta [data-messages]")||ae("#cuenta"),notificaciones:ae("#notificaciones [data-messages]")||ae("#notificaciones"),apariencia:ae("#apariencia [data-messages]")||ae("#apariencia"),seguridad:ae("#seguridad [data-messages]")||ae("#seguridad"),peligro:ae("#zona-peligro [data-messages]")||ae("#zona-peligro")}}async function Mo(e){if(!e)return;qo(document),No(document);const t=Io();try{const i=await ue();if(i){const c=ae('#profileForm input[name="name"]'),f=ae('#profileForm input[name="email"]');c&&!c.value&&(c.value=i.name||""),f&&!f.value&&(f.value=i.email||"");const d=ae("[data-user-name]"),p=ae("[data-user-email-masked]");d&&(d.textContent=i.name||""),p&&(p.textContent=To(i.email||""))}}catch{}const a=ae("#profileForm");a==null||a.addEventListener("submit",async i=>{var f;i.preventDefault();const c=Fe(a);try{await Ue("/settings/profile",{method:"PATCH",body:c}),me(t.cuenta,"Perfil actualizado correctamente","ok")}catch(d){me(t.cuenta,((f=d==null?void 0:d.data)==null?void 0:f.message)||"No se pudo actualizar el perfil","error")}});const n=ae("#notificationsForm");n==null||n.addEventListener("submit",async i=>{var f;i.preventDefault();const c=Fe(n);try{await Ue("/settings",{method:"PATCH",body:c}),me(t.notificaciones,"Preferencias guardadas","ok")}catch(d){me(t.notificaciones,((f=d==null?void 0:d.data)==null?void 0:f.message)||"No se pudo guardar","error")}});const s=ae("#appearanceForm");s==null||s.addEventListener("submit",async i=>{var f;i.preventDefault();const c=Fe(s);try{await Ue("/settings",{method:"PATCH",body:c}),me(t.apariencia,"Tema guardado","ok")}catch(d){me(t.apariencia,((f=d==null?void 0:d.data)==null?void 0:f.message)||"No se pudo guardar el tema","error")}});const r=ae("#passwordForm");r==null||r.addEventListener("submit",async i=>{var f;i.preventDefault();const c=Fe(r);try{await Ue("/settings/password",{method:"PATCH",body:c}),me(t.seguridad,"Contraseña actualizada","ok"),r.reset()}catch(d){me(t.seguridad,((f=d==null?void 0:d.data)==null?void 0:f.message)||"No se pudo actualizar la contraseña","error")}});const o=ae("#logoutAllForm");o==null||o.addEventListener("submit",async i=>{var f;i.preventDefault();const c=Fe(o);try{await Ue("/settings/logout-all",{method:"POST",body:c}),me(t.peligro,"Sesiones cerradas en todos los dispositivos","ok"),o.reset()}catch(d){me(t.peligro,((f=d==null?void 0:d.data)==null?void 0:f.message)||"No se pudo cerrar sesión global","error")}});const l=ae("#deleteAccountForm");l==null||l.addEventListener("submit",async i=>{var f;i.preventDefault();const c=Fe(l);try{await Ue("/settings",{method:"DELETE",body:c}),window.location.href="/html/pages/landing.html"}catch(d){me(t.peligro,((f=d==null?void 0:d.data)==null?void 0:f.message)||"No se pudo eliminar la cuenta","error")}})}function Oo(){const e=document.querySelector('[data-page="settings"]');e&&Mo(e)}function u(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:s.startsWith("on")&&typeof r=="function"?n.addEventListener(s.slice(2).toLowerCase(),r):n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Je(e){return Array.isArray(e)?e:e&&Array.isArray(e.data)?e.data:[]}function pn(e){return isFinite(e)?`${Math.round(e)}%`:"0%"}function _e(e,t,a){return u("div",{class:"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 mb-6"},u("div",{},u("h2",{class:"text-3xl font-bold text-gray-900"},e),t?u("p",{class:"text-gray-600 mt-2 max-w-3xl"},t):null),a?u("span",{class:"inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full bg-blue-100 text-blue-700"},a):null)}function te(e,...t){const a=e||"",n=["rounded-3xl","shadow-card","p-6","transition-all","duration-300"];/bg-/.test(a)||n.push("bg-white"),/border/.test(a)||n.push("border","border-slate-100/70"),/backdrop-/.test(a)||n.push("backdrop-blur-sm");const s=`${n.join(" ")} ${a}`.trim();return u("div",{class:s},t)}function ee(e,t,a=0){t&&(t.classList&&(t.classList.add("animate-fade-in-up"),t.style.animationDelay=`${Math.min(a*.08,.4)}s`),e.appendChild(t))}function gn(e=0,t="bg-blue-500"){const a=Math.max(0,Math.min(100,Math.round(e)));return u("div",{class:"w-full bg-slate-100 rounded-full h-2 overflow-hidden"},u("div",{class:`h-2 rounded-full transition-all duration-500 ${t}`,style:`width:${a}%`}))}function kt({icon:e,label:t,value:a,trendLabel:n,trendClass:s="bg-emerald-100 text-emerald-700",trendIcon:r="fas fa-arrow-trend-up"}){return te("flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between bg-white/90",u("div",{class:"flex items-center gap-3"},u("span",{class:"inline-flex w-12 h-12 items-center justify-center rounded-2xl bg-slate-900/90 text-white text-xl shadow-lg"},u("i",{class:e})),u("div",{},u("p",{class:"text-sm uppercase tracking-wide text-slate-500 font-semibold"},t),u("p",{class:"text-3xl font-extrabold text-slate-900"},a))),n?u("span",{class:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold ${s}`},u("i",{class:r}),n):null)}function yn({icon:e,label:t,value:a,hint:n}){return u("div",{class:"home-hero-metric"},u("span",{class:"home-hero-metric-icon"},u("i",{class:e})),u("div",{class:"home-hero-metric-content"},u("p",{class:"home-hero-metric-label"},t),u("p",{class:"home-hero-metric-value"},a),n?u("span",{class:"home-hero-metric-hint"},n):null))}async function Po(e){var f;const t=(f=e==null?void 0:e.company)==null?void 0:f.id;let a=[],n=null,s=null;if(t){try{n=await Ce({company_id:t})}catch{}try{s=await Ce({company_id:t,status:"active"})}catch{}}try{a=Je(await xe(t?{company_id:t}:{})),t&&!a.length&&(a=Je(await xe()).filter(p=>String(p.company_id)===String(t)))}catch{}const r=Number.isFinite(n)?n:a.length,o=Number.isFinite(s)?s:a.filter(d=>(d.status||d.state||"").toLowerCase()==="active").length;let l=0;if(r)try{const d=a.map(m=>m.id).filter(Boolean),p=await(async()=>{try{return await Ye({job_offer_ids:d.join(",")})}catch{return null}})();if(Number.isFinite(p))l=p;else{const m=d.slice(0,10);let y=0;for(const g of m)try{const h=await(async()=>{try{return await Ye({job_offer_id:g})}catch{return null}})();Number.isFinite(h)?y+=h:y+=Je(await ge({job_offer_id:g})).length}catch{}l=y}}catch{}const i=r>0?o/r*100:0,c=r>0||l>0;return{offers:a,totalOffers:r,activeOffers:o,applicationsCount:l,activityRate:i,hasStatsData:c}}async function ba(e){let t=0,a=0,n=0;const s={pending:0,reviewed:0,accepted:0,rejected:0};try{t=await Ce({status:"active"})}catch{}try{a=await ta()}catch{}try{const c=Je(await ge({me:1}));n=c.length;for(const f of c){const d=(f.status||"").toLowerCase();d==="pending"?s.pending++:d==="reviewed"?s.reviewed++:d==="accepted"?s.accepted++:d==="rejected"&&s.rejected++}}catch{}let r=[];try{r=Je(await xe({status:"active",limit:3}))}catch{}let o=[];try{o=Je(await Lt({limit:3}))}catch{}const l=new Set;for(const c of r)if(Array.isArray(c.categories))for(const f of c.categories)l.add((f==null?void 0:f.name)||String(f));const i=Array.from(l).slice(0,6);return{totalActiveOffers:t,totalCompanies:a,myApplications:n,applicationStats:s,featuredJobs:r,recommendedTrainings:o,recommendedCategories:i}}function Do(e,t){var s,r;let a=((s=e==null?void 0:e.company)==null?void 0:s.company_name)||((r=e==null?void 0:e.company)==null?void 0:r.name)||(e==null?void 0:e.company_name)||(e==null?void 0:e.name)||"";if(!a)try{a=localStorage.getItem("display_name")||localStorage.getItem("pending_name")||""}catch{}a||(a="Tu empresa"),Number.isFinite(t.totalOffers)?t.totalOffers:Number(t.totalOffers);const n=[{icon:"fas fa-briefcase",label:"Ofertas activas",value:String(t.activeOffers||0),hint:null},{icon:"fas fa-users",label:"Postulaciones",value:String(t.applicationsCount||0),hint:null},{icon:"fas fa-chart-line",label:"Tasa de actividad",value:pn(t.activityRate),hint:null}];return u("section",{class:"home-hero-section"},u("div",{class:"home-hero-card shadow-soft text-white"},u("span",{class:"home-hero-pattern"}),u("div",{class:"home-hero-content"},u("div",{class:"home-hero-main"},u("span",{class:"home-hero-badge"},u("i",{class:"fas fa-rocket"}),"Panel de empresa"),u("div",{class:"home-hero-greeting"},u("i",{class:"fas fa-hand-holding-heart"}),"Hola, ",u("strong",{},a.toUpperCase())),u("h1",{class:"home-hero-title"},"Impulsa el crecimiento de ",u("span",{class:"home-hero-title-highlight"},a)),u("p",{class:"home-hero-subtitle"},"Centraliza tus vacantes, sigue el progreso de los candidatos y toma decisiones con datos en tiempo real."),u("div",{class:"home-hero-actions"},u("a",{href:"/html/job-offers/create.html",class:"btn-primary"},u("i",{class:"fas fa-plus-circle"}),"Publicar nueva oferta"),u("a",{href:"/html/job-offers/index.html",class:"btn-secondary"},u("i",{class:"fas fa-list-check"}),"Administrar vacantes"))),u("div",{class:"home-hero-summary"},u("p",{class:"home-hero-summary-title"},u("i",{class:"fas fa-sparkles"}),"Resumen rápido"),...n.map(yn)))))}function Uo(){return u("section",{class:"space-y-8"},_e("Acciones recomendadas","Mantén tu pipeline activo con estos atajos para publicar, gestionar y seguir a tus candidatos.","Optimiza tu tiempo"),u("div",{class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},te("relative overflow-hidden border border-blue-900/30",u("div",{class:"space-y-5 relative z-10"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl gradient-primary text-white"},u("i",{class:"fas fa-file-circle-plus"})),u("div",{},u("h3",{class:"text-xl font-bold text-blue-900"},"Publicar oferta"),u("p",{class:"text-blue-900/80 mt-2"},"Define requisitos, beneficios y recibe candidatos en minutos.")),u("ul",{class:"space-y-2 text-sm text-blue-900/70"},u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Plantillas prearmadas"),u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Visibilidad inmediata")),u("a",{href:"/html/job-offers/create.html",class:"btn-primary inline-flex items-center gap-2"},u("i",{class:"fas fa-arrow-right"}),"Crear oferta"))),te("relative overflow-hidden border border-blue-900/30",u("div",{class:"space-y-5 relative z-10"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl gradient-primary text-white"},u("i",{class:"fas fa-users-gear"})),u("div",{},u("h3",{class:"text-xl font-bold text-indigo-900"},"Revisar postulaciones"),u("p",{class:"text-indigo-900/80 mt-2"},"Clasifica candidatos, deja notas internas y coordina entrevistas.")),u("ul",{class:"space-y-2 text-sm text-blue-900/70"},u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Filtros avanzados"),u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Trazabilidad de estados")),u("a",{href:"/html/job-applications/index-company.html",class:"btn-primary inline-flex items-center gap-2"},u("i",{class:"fas fa-arrow-right"}),"Gestionar postulaciones"))),te("relative overflow-hidden border border-blue-900/30",u("div",{class:"space-y-5 relative z-10"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl gradient-primary text-white"},u("i",{class:"fas fa-building"})),u("div",{},u("h3",{class:"text-xl font-bold text-purple-900"},"Perfil de empresa"),u("p",{class:"text-purple-900/80 mt-2"},"Refuerza tu marca empleadora con una presentación atractiva.")),u("ul",{class:"space-y-2 text-sm text-blue-900/70"},u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Información centralizada"),u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Imagen destacada")),u("a",{href:"/html/company-form.html",class:"inline-flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg"},u("i",{class:"fas fa-arrow-right"}),"Actualizar perfil")))))}function Fo(e){const t=e.totalOffers||0,a=e.activeOffers||0,n=e.applicationsCount||0,s=e.activityRate||0,r=t>0?`${a} de ${t} vacantes activas`:"Publica tu primera vacante",o=a>0?Math.round(n/a):n;return u("section",{class:"space-y-8"},_e("Indicadores clave","Visualiza la salud de tu proceso de selección y detecta oportunidades de mejora.",`Última actualización · ${new Date().toLocaleDateString("es-CO",{day:"numeric",month:"short"})}`),u("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},te("bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white relative overflow-hidden",u("div",{class:"absolute inset-0 decorative-pattern animate-pulse-slow"}),u("div",{class:"relative space-y-5"},u("div",{class:"flex items-center justify-between"},u("p",{class:"text-sm uppercase tracking-widest text-white/70 font-semibold"},"Participación"),u("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 text-white text-xs"},u("i",{class:"fas fa-bolt"}),"Visibilidad")),u("div",{class:"space-y-2"},u("h3",{class:"text-2xl font-bold text-white"},r),gn(s,"bg-blue-500"),u("p",{class:"text-xs text-white/70"},"Mantén el porcentaje por encima del 60% para asegurar un flujo constante de candidatos.")),u("div",{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},kt({icon:"fas fa-users",label:"Aplicaciones totales",value:n,trendLabel:o?`${o} por oferta`:null,trendClass:"bg-emerald-100 text-emerald-700",trendIcon:"fas fa-user-check"}),kt({icon:"fas fa-clock-rotate-left",label:"Tiempo recomendado de respuesta",value:"48h",trendLabel:"Experiencia óptima",trendClass:"bg-blue-100 text-blue-700",trendIcon:"fas fa-stopwatch"})))),te("bg-slate-50 border border-slate-200 space-y-5",u("div",{class:"flex items-start gap-3"},u("span",{class:"w-10 h-10 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"},u("i",{class:"fas fa-route"})),u("div",{},u("h3",{class:"text-lg font-semibold text-slate-900"},"Próximos pasos sugeridos"),u("p",{class:"text-sm text-slate-500"},"Incorpora estas acciones para mantener tu marca empleadora siempre activa."))),u("ul",{class:"space-y-4 text-sm text-slate-600"},["Actualiza tu descripción de empresa con logros recientes.","Programa entrevistas virtuales en bloques de 30 minutos.","Comparte testimonios de colaboradores en tus ofertas más vistas."].map((l,i)=>u("li",{class:"flex items-start gap-3"},u("span",{class:"mt-1 text-blue-600 font-semibold"},i+1),u("span",{},l)))),u("a",{href:"/html/job-applications/index-company.html",class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 w-fit"},u("i",{class:"fas fa-gauge-high"}),"Ver panel de seguimiento"))))}function Ro(){const e=[{title:"Define tu oferta ideal",text:"Resume funciones clave y beneficios diferenciales para atraer al talento correcto.",icon:"fas fa-lightbulb",color:"bg-amber-100 text-amber-600"},{title:"Clasifica candidatos",text:"Organiza entrevistas con etiquetas y notas para tu equipo de reclutamiento.",icon:"fas fa-filter",color:"bg-blue-100 text-blue-600"},{title:"Mide el impacto",text:"Exporta reportes y analiza qué vacantes tienen mayor conversión.",icon:"fas fa-chart-simple",color:"bg-emerald-100 text-emerald-600"}];return u("section",{class:"space-y-6"},_e("Hoja de ruta sugerida","Un flujo sencillo para mantener tu estrategia de atracción con ritmo."),u("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},...e.map((t,a)=>te("relative overflow-hidden group bg-white",u("div",{class:`inline-flex items-center justify-center w-14 h-14 rounded-2xl ${t.color} shadow-inner`},u("i",{class:t.icon})),u("div",{class:"mt-5 space-y-3"},u("div",{class:"flex items-center justify-between"},u("h3",{class:"text-lg font-bold text-slate-900"},t.title),u("span",{class:"text-sm font-semibold text-slate-400"},`Paso ${a+1}`)),u("p",{class:"text-slate-600"},t.text))))))}function Ho(){return u("section",{class:"space-y-8"},u("h2",{class:"text-2xl md:text-3xl font-extrabold text-gray-900"},"Ideas para fortalecer tu atracción de talento"),u("p",{class:"text-gray-600 max-w-3xl"},"Incorpora estas mejores prácticas y recursos recomendados para atraer candidatos más calificados y cerrar vacantes con rapidez."),u("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},te("relative overflow-hidden border",u("div",{class:"space-y-4"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-emerald-100 text-emerald-600"},u("i",{class:"fas fa-leaf"})),u("h3",{class:"text-lg font-bold text-gray-900"},"Historias de impacto"),u("p",{class:"text-gray-600"},"Incluye testimonios de tu equipo y describe desafíos reales para captar perfiles alineados con tu cultura."),u("ul",{class:"text-sm text-emerald-700 space-y-1"},u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Humaniza tu propuesta de valor"),u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Muestra oportunidades de desarrollo")))),te("relative overflow-hidden border",u("div",{class:"space-y-4"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-amber-100 text-amber-600"},u("i",{class:"fas fa-hourglass-half"})),u("h3",{class:"text-lg font-bold text-gray-900"},"Tiempo de respuesta"),u("p",{class:"text-gray-600"},"Configura recordatorios internos para contactar candidatos en menos de 48 horas y mejorar la experiencia."),u("ul",{class:"text-sm text-amber-700 space-y-1"},u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Automatiza correos de seguimiento"),u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Etiqueta perfiles prioritarios")))),te("relative overflow-hidden border",u("div",{class:"space-y-4"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-sky-100 text-sky-600"},u("i",{class:"fas fa-graduation-cap"})),u("h3",{class:"text-lg font-bold text-gray-900"},"Recursos de capacitación"),u("p",{class:"text-gray-600"},"Fortalece a tu equipo con talleres y cursos en habilidades digitales, liderazgo y metodología ágil."),u("ul",{class:"text-sm text-sky-700 space-y-1"},u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Metodologías ágiles"),u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Entrevistas efectivas"),u("li",{class:"flex items-center gap-2"},u("i",{class:"fas fa-check"}),"Onboarding"))))))}function va(e,t={}){var i,c,f,d,p,m;let a=(e==null?void 0:e.name)||"";if(!a)try{a=localStorage.getItem("display_name")||localStorage.getItem("pending_name")||""}catch{}const n=Number(t.totalActiveOffers)||0,s=Number(t.myApplications)||0,r=(((i=t.applicationStats)==null?void 0:i.pending)||0)+(((c=t.applicationStats)==null?void 0:c.accepted)||0)+(((f=t.applicationStats)==null?void 0:f.reviewed)||0)+(((d=t.applicationStats)==null?void 0:d.rejected)||0),o=r?Math.round(((((p=t.applicationStats)==null?void 0:p.pending)||0)+(((m=t.applicationStats)==null?void 0:m.accepted)||0))/r*100):0,l=[{icon:"fas fa-briefcase",label:"Ofertas activas",value:String(n),hint:n?"Nuevas cada día":"Vuelve pronto"},{icon:"fas fa-paper-plane",label:"Mis postulaciones",value:String(s),hint:s?"Haz seguimiento":"Comienza hoy"},{icon:"fas fa-bolt",label:"Índice de avance",value:`${o}%`,hint:o>=60?"Buen ritmo":"Puedes mejorar"}];return u("section",{class:"home-hero-section"},u("div",{class:"home-hero-card shadow-soft text-white"},u("span",{class:"home-hero-pattern"}),u("div",{class:"home-hero-content"},u("div",{class:"home-hero-main"},u("span",{class:"home-hero-badge"},u("i",{class:"fas fa-compass"}),"Tu carrera"),u("div",{class:"home-hero-greeting"},u("i",{class:"fas fa-hand-holding-heart"}),"Hola, ",u("strong",{},(a||"Usuario").toUpperCase())),u("h1",{class:"home-hero-title"},"Descubre oportunidades y potencia tu perfil profesional"),u("p",{class:"home-hero-subtitle"},"Te conectamos con empleos verificados, capacitaciones prácticas y herramientas para destacar."),u("div",{class:"home-hero-actions"},u("a",{href:"/html/job-offers/index.html",class:"btn-primary"},u("i",{class:"fas fa-search"}),"Explorar empleos"),u("a",{href:"/html/training/index.html",class:"btn-secondary"},u("i",{class:"fas fa-graduation-cap"}),"Ver capacitaciones"))),u("div",{class:"home-hero-summary"},u("p",{class:"home-hero-summary-title"},u("i",{class:"fas fa-sparkles"}),"Resumen rápido"),...l.map(yn)))))}function wa(){return u("div",{class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-6"},te("relative overflow-hidden border border-blue-100 bg-blue-50",u("div",{class:"space-y-5 relative z-10"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-blue-600 text-white"},u("i",{class:"fas fa-briefcase"})),u("div",{},u("h3",{class:"text-xl font-bold text-blue-900"},"Explorar empleos"),u("p",{class:"text-blue-900/80 mt-2"},"Filtra por ubicación, modalidad y rango salarial para encontrar el rol ideal.")),u("a",{href:"/html/job-offers/index.html",class:"inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700"},"Ver ofertas"))),te("relative overflow-hidden border border-emerald-100 bg-emerald-50",u("div",{class:"space-y-5 relative z-10"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-emerald-600 text-white"},u("i",{class:"fas fa-id-card-clip"})),u("div",{},u("h3",{class:"text-xl font-bold text-emerald-900"},"Optimiza tu portafolio"),u("p",{class:"text-emerald-900/80 mt-2"},"Presenta proyectos, logros y certificaciones en un solo lugar.")),u("a",{href:"/html/portfolio/list.html",class:"inline-flex items-center gap-2 px-4 py-2 rounded-md bg-emerald-600 text-white hover:bg-emerald-700"},"Gestionar portafolio"))),te("relative overflow-hidden border border-purple-100 bg-purple-50",u("div",{class:"space-y-5 relative z-10"},u("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-purple-600 text-white"},u("i",{class:"fas fa-graduation-cap"})),u("div",{},u("h3",{class:"text-xl font-bold text-purple-900"},"Capacítate y crece"),u("p",{class:"text-purple-900/80 mt-2"},"Suma nuevas habilidades digitales y blandas para destacar en entrevistas.")),u("a",{href:"/html/training/index.html",class:"inline-flex items-center gap-2 px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700"},"Ver capacitaciones"))))}function Sa(e){var i,c,f,d;const t=e.totalActiveOffers||0,a=e.myApplications||0,n=((i=e.applicationStats)==null?void 0:i.pending)||0,s=((c=e.applicationStats)==null?void 0:c.accepted)||0,r=n+s+(((f=e.applicationStats)==null?void 0:f.reviewed)||0)+(((d=e.applicationStats)==null?void 0:d.rejected)||0),o=r?(n+s)/r*100:0,l=[{icon:"fas fa-compass",title:"Afinar búsqueda",desc:"Configura alertas según ciudad, modalidad y salario objetivo.",href:"/html/job-offers/index.html",color:"bg-blue-100 text-blue-600"},{icon:"fas fa-wand-magic-sparkles",title:"Actualizar CV",desc:"Destaca logros medibles y proyectos recientes en tu portafolio.",href:"/html/portfolio/list.html",color:"bg-purple-100 text-purple-600"},{icon:"fas fa-people-group",title:"Networking",desc:"Comparte tu perfil con mentores y comunidades alineadas a tu industria.",href:"/html/messages/index.html",color:"bg-emerald-100 text-emerald-600"}];return u("section",{class:"space-y-8"},_e("Tu progreso a la fecha","Sigue estos indicadores para mantener el ritmo de tu búsqueda."),u("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},te("bg-gradient-to-br from-blue-700 via-indigo-700 to-blue-900 text-white relative overflow-hidden",u("div",{class:"absolute inset-0 decorative-pattern animate-pulse-slow"}),u("div",{class:"relative space-y-6"},u("div",{class:"flex items-center justify-between"},u("p",{class:"text-sm uppercase tracking-widest text-white/70 font-semibold"},"Visibilidad"),u("span",{class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 text-white text-xs"},u("i",{class:"fas fa-circle-nodes"}),"Plan activo")),u("div",{class:"space-y-2"},u("h3",{class:"text-2xl font-bold text-white"},`${a} postulaciones enviadas`),gn(a?Math.min(a*10,100):0,"bg-emerald-500"),u("p",{class:"text-xs text-white/70"},"Procura enviar al menos 3 postulaciones relevantes por semana.")),u("div",{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},kt({icon:"fas fa-briefcase",label:"Ofertas activas disponibles",value:t||"—",trendLabel:"Fuente actualizada",trendClass:"bg-blue-100 text-blue-700",trendIcon:"fas fa-bolt"}),kt({icon:"fas fa-bell",label:"Seguimientos pendientes",value:n||"0",trendLabel:o?`${Math.round(o)}% en seguimiento`:"Sin pendientes",trendClass:o>60?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700",trendIcon:o>60?"fas fa-circle-check":"fas fa-circle-info"})))),te("bg-white space-y-5 border border-slate-200",u("div",{class:"flex items-start gap-3"},u("span",{class:"w-10 h-10 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"},u("i",{class:"fas fa-map-location-dot"})),u("div",{},u("h3",{class:"text-lg font-semibold text-slate-900"},"Áreas para reforzar esta semana"),u("p",{class:"text-sm text-slate-500"},"Prioriza estas acciones para incrementar tus oportunidades."))),u("div",{class:"space-y-4"},...l.map(p=>u("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border border-slate-100 rounded-2xl px-4 py-3 hover:border-blue-200 transition"},u("div",{class:"flex items-start gap-3"},u("span",{class:`mt-1 inline-flex items-center justify-center w-10 h-10 rounded-xl ${p.color}`},u("i",{class:p.icon})),u("div",{},u("p",{class:"font-semibold text-slate-800"},p.title),u("p",{class:"text-sm text-slate-500"},p.desc))),u("a",{href:p.href,class:"inline-flex items-center gap-2 text-sm font-semibold text-blue-600 hover:text-blue-800"},"Ir ahora",u("i",{class:"fas fa-arrow-up-right-from-square text-xs"}))))))))}function Ca(){const e=[{title:"Refresca tu perfil profesional",text:"Agrega proyectos recientes, certificaciones y logros cuantificables.",icon:"fas fa-user-astronaut",color:"bg-indigo-100 text-indigo-600"},{title:"Postula con estrategia",text:"Adapta tu CV a cada oferta e incluye palabras clave del rol.",icon:"fas fa-target",color:"bg-blue-100 text-blue-600"},{title:"Prepárate para entrevistas",text:"Practica historias STAR y preguntas frecuentes en tu industria.",icon:"fas fa-comments",color:"bg-emerald-100 text-emerald-600"}];return u("section",{class:"space-y-6"},_e("Ruta sugerida para esta semana","Organiza tus esfuerzos y mantén visibilidad constante."),u("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},...e.map((t,a)=>te("relative overflow-hidden group bg-white",u("div",{class:`inline-flex items-center justify-center w-14 h-14 rounded-2xl ${t.color} shadow-inner`},u("i",{class:t.icon})),u("div",{class:"mt-5 space-y-3"},u("div",{class:"flex items-center justify-between"},u("h3",{class:"text-lg font-bold text-slate-900"},t.title),u("span",{class:"text-sm font-semibold text-slate-400"},`Paso ${a+1}`)),u("p",{class:"text-slate-600"},t.text))))))}function _a(e){const t=[{icon:"fas fa-briefcase",label:"Ofertas activas",value:e.totalActiveOffers},{icon:"fas fa-building",label:"Empresas confiables",value:e.totalCompanies},{icon:"fas fa-file-import",label:"Mis postulaciones",value:e.myApplications}];return u("section",{},u("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},...t.map(a=>te("text-center space-y-4 py-8",u("div",{class:`inline-flex w-16 h-16 items-center justify-center rounded-2xl ${a.icon.includes("building")?"bg-indigo-100 text-indigo-600":a.icon.includes("briefcase")?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-600"} text-2xl`},u("i",{class:a.icon})),u("p",{class:"text-4xl font-extrabold text-gray-900"},String(a.value??"—")),u("p",{class:"text-gray-600 font-semibold"},a.label),u("span",{class:`inline-flex items-center gap-2 text-xs px-2 py-1 rounded-full ${a.icon.includes("file")?"bg-amber-100 text-amber-700":a.icon.includes("building")?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`},u("i",{class:a.icon.includes("file")?"fas fa-paper-plane":a.icon.includes("building")?"fas fa-shield-check":"fas fa-bullhorn"}),a.icon.includes("file")?"Seguimiento":a.icon.includes("building")?"Verificadas":"Actualizado")))))}function Aa(e){return e!=null&&e.length?u("section",{class:"space-y-6"},_e("Oportunidades que podrían interesarte","Explora las últimas vacantes activas publicadas por empresas verificadas."),u("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},...e.map(t=>{var a;return te("",u("div",{class:"space-y-4"},u("div",{class:"flex items-start justify-between gap-4"},u("div",{},u("p",{class:"text-sm font-semibold text-blue-600 uppercase tracking-wide"},((a=t.company)==null?void 0:a.name)||"Empresa confidencial"),u("h3",{class:"text-xl font-bold text-gray-900"},t.title||"Oferta")),u("span",{class:"inline-flex items-center gap-2 text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700"},u("i",{class:"fas fa-location-dot"}),t.location||"Remoto")),t.description?u("p",{class:"text-gray-600 leading-relaxed"},String(t.description).slice(0,140)):null),u("div",{class:"mt-6 flex items-center justify-between text-sm text-gray-500"},u("div",{class:"flex items-center gap-2"},u("i",{class:"fas fa-wallet text-green-500"}),u("span",{},t.salary_formatted||t.salary||"A convenir")),u("a",{href:`/html/job-offers/show.html?id=${encodeURIComponent(t.id)}`,class:"btn-primary text-white inline-flex items-center gap-2 px-3 py-2 rounded-md"},u("i",{class:"fas fa-arrow-right"}),"Detalles")))}))):null}function Ea(e){return e!=null&&e.length?u("section",{class:"space-y-6"},u("h2",{class:"text-3xl font-bold text-gray-900"},"Formaciones recomendadas para ti"),u("div",{class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},...e.map(t=>te("",u("div",{class:"space-y-4"},u("div",{class:"space-y-1"},u("p",{class:"text-sm font-semibold text-indigo-600 uppercase tracking-wide"},t.provider||"Capacitación"),u("h3",{class:"text-xl font-bold text-gray-900"},t.title||"Formación")),t.description?u("p",{class:"text-gray-600 leading-relaxed"},String(t.description).slice(0,140)):null),u("div",{class:"mt-6 space-y-3 text-sm text-gray-500"},u("div",{class:"flex items-center gap-2"},u("i",{class:"fas fa-calendar"}),u("span",{},t.start_date||"Inicio flexible")),u("div",{class:"flex items-center gap-2"},u("i",{class:"fas fa-link"}),u("span",{},t.link?"Modalidad virtual":"Consulta disponibilidad")),u("a",{href:t.link||"/html/training/index.html",class:"btn-primary text-white inline-flex items-center gap-2 px-3 py-2 rounded-md"},u("i",{class:"fas fa-arrow-up-right-from-square"}),"Conocer más")))))):null}function ka(e){return e!=null&&e.length?u("section",{class:"space-y-4"},u("h2",{class:"text-3xl font-bold text-gray-900"},"Explora categorías populares"),u("p",{class:"text-gray-600"},"Descubre áreas con alta demanda y filtra las oportunidades que se ajustan a tu perfil."),u("div",{class:"flex flex-wrap gap-3"},...e.map(t=>u("span",{class:"px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-semibold flex items-center gap-2"},u("i",{class:"fas fa-hashtag text-gray-500"}),t)))):null}function ja(e){if(!e)return null;const t=[{color:"yellow",label:"Pendientes",value:e.pending},{color:"blue",label:"En revisión",value:e.reviewed},{color:"green",label:"Aceptadas",value:e.accepted},{color:"red",label:"Rechazadas",value:e.rejected}];return u("section",{},u("div",{class:"rounded-2xl bg-white shadow-sm p-6 border-l-4 border-green-600"},u("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-6"},u("div",{class:"space-y-2"},u("div",{class:"inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-semibold"},u("i",{class:"fas fa-clipboard-list mr-2"}),"Seguimiento activo"),u("h3",{class:"text-2xl font-bold text-gray-900"},"Estado de tus postulaciones"),u("p",{class:"text-gray-600"},"Mantén un panorama claro de cada etapa y prioriza tus seguimientos.")),u("div",{class:"grid grid-cols-2 md:grid-cols-4 gap-4 flex-1"},...t.map(a=>u("div",{class:`text-center p-4 bg-${a.color}-50 rounded-xl`},u("p",{class:`text-2xl font-extrabold text-${a.color}-700`},String(a.value??"—")),u("p",{class:`text-xs uppercase tracking-wide text-${a.color}-700`},a.label)))))))}function $a(){const e=[{icon:"fas fa-id-badge",title:"Perfil completo",text:"Actualiza tu portafolio con proyectos recientes y resultados cuantificables."},{icon:"fas fa-paper-plane",title:"Personaliza tus aplicaciones",text:"Adapta tu CV y carta de presentación resaltando logros relevantes."},{icon:"fas fa-comments",title:"Prepárate para entrevistas",text:"Practica tus respuestas y prepara ejemplos concretos de tus experiencias."}];return u("section",{},u("h2",{class:"text-3xl font-bold text-gray-900 mb-6"},"Consejos para destacar en tu búsqueda"),u("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},...e.map(t=>te("",u("div",{class:"space-y-3"},u("span",{class:`inline-flex items-center justify-center w-12 h-12 rounded-xl ${t.title.includes("Perfil")?"bg-purple-100 text-purple-600":t.title.includes("aplicaciones")?"bg-amber-100 text-amber-600":"bg-green-100 text-green-600"}`},u("i",{class:t.icon})),u("h3",{class:"text-xl font-bold text-gray-900"},t.title),u("p",{class:"text-gray-600"},t.text))))))}async function Bo(e){var l,i,c,f,d,p;if(!e)return;e.innerHTML="";const t=u("p",{class:"text-slate-500"},"Cargando tu inicio...");e.appendChild(t);let a=null;try{a=await ue()}catch{const y=encodeURIComponent("/html/pages/home.html");window.location.href=`/html/auth/login.html?redirect=${y}`;return}t.remove();const n=u("div",{class:"relative container mx-auto py-12 px-4 sm:px-6 lg:px-8 space-y-12"});try{const y=new URLSearchParams(location.search).get("error");y&&ee(n,te("border-l-4 border-amber-500 bg-amber-50",u("div",{class:"flex items-start gap-3 text-amber-900"},u("div",{class:"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0"},u("i",{class:"fas fa-triangle-exclamation"})),u("div",{},u("p",{class:"font-semibold mb-1"},"Aviso"),u("p",{},y)))))}catch{}let s=rt(a),r=We(a);const o=$t(a);try{const m=(localStorage.getItem("display_role")||localStorage.getItem("pending_role")||"").toLowerCase();!s&&m==="company"?(s=!0,r=!1):!r&&m==="unemployed"&&(r=!0,m==="unemployed"&&(s=!1))}catch{}if(s){let m=!!(a!=null&&a.company&&Vo(a.company));try{const g=localStorage.getItem("profile_completed")==="1";!m&&g&&(m=!0)}catch{}const y=m?await Po(a):{hasStatsData:!1,activeOffers:0,applicationsCount:0,totalOffers:0,activityRate:0};if(ee(n,Do(a,y)),m||ee(n,te("max-w-3xl mx-auto text-blue-900 bg-blue-50 border border-blue-200",u("div",{class:"flex items-start gap-3"},u("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0"},u("i",{class:"fas fa-circle-info"})),u("div",{},u("p",{class:"font-semibold mb-2"},"Completa la información de tu empresa para visualizar estadísticas y agilizar la publicación de ofertas."),u("a",{href:"/html/company-form.html",class:"underline font-semibold"},"Ir al formulario de empresa"))))),m&&y.hasStatsData){const g=u("section",{},u("div",{class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6"},te("group text-center",u("span",{class:"inline-flex w-16 h-16 items-center justify-center rounded-2xl bg-gradient-primary text-white group-hover:scale-110 transition"},u("i",{class:"fas fa-bullseye"})),u("p",{class:"text-4xl font-extrabold text-gray-900"},String(y.activeOffers)),u("p",{class:"text-gray-600 font-semibold"},"Ofertas activas")),te("group text-center",u("span",{class:"inline-flex w-16 h-16 items-center justify-center rounded-2xl bg-indigo-100 text-indigo-700 group-hover:scale-110 transition"},u("i",{class:"fas fa-user-group"})),u("p",{class:"text-4xl font-extrabold text-gray-900"},String(y.applicationsCount)),u("p",{class:"text-gray-600 font-semibold"},"Postulaciones totales")),te("group text-center",u("span",{class:"inline-flex w-16 h-16 items-center justify-center rounded-2xl bg-slate-100 text-slate-700 group-hover:scale-110 transition"},u("i",{class:"fas fa-file-signature"})),u("p",{class:"text-4xl font-extrabold text-gray-900"},String(y.totalOffers)),u("p",{class:"text-gray-600 font-semibold"},"Vacantes creadas")),te("group text-center",u("span",{class:"inline-flex w-16 h-16 items-center justify-center rounded-2xl bg-gray-100 text-gray-700 group-hover:scale-110 transition"},u("i",{class:"fas fa-percent"})),u("p",{class:"text-4xl font-extrabold text-gray-900"},pn(y.activityRate)),u("p",{class:"text-gray-600 font-semibold"},"Tasa de actividad"))));ee(n,g,1)}else ee(n,te("text-center py-14",u("div",{class:"max-w-2xl mx-auto space-y-6"},u("span",{class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 text-blue-600 text-2xl"},u("i",{class:"fas fa-paper-plane"})),u("h3",{class:"text-2xl font-bold text-gray-900"},"Aún no tienes actividad registrada"),u("p",{class:"text-gray-600"},"Publica tu primera oferta para comenzar a recibir postulaciones y desbloquear estadísticas detalladas."),u("div",{class:"flex flex-col sm:flex-row gap-4 justify-center"},u("a",{href:"/html/job-offers/create.html",class:"btn-primary inline-flex items-center gap-2"},u("i",{class:"fas fa-plus-circle"}),"Publicar primera oferta")))),1);ee(n,Fo(y),1.5),ee(n,Uo(),2),ee(n,Ro(),2.5),ee(n,Ho(),3)}else if(r||!s&&!r&&!o){const m=await ba();ee(n,va(a,m)),ee(n,_a(m),.5),ee(n,Sa(m),1),(l=m.featuredJobs)!=null&&l.length&&ee(n,Aa(m.featuredJobs),1.5),ee(n,_e("Impulsa tu perfil profesional","Aprovecha estos recursos para posicionarte mejor frente a los reclutadores.","Tu crecimiento"),1.6),ee(n,wa(),1.7),(i=m.recommendedTrainings)!=null&&i.length&&ee(n,Ea(m.recommendedTrainings),2),(c=m.recommendedCategories)!=null&&c.length&&ee(n,ka(m.recommendedCategories),2.3),m.myApplications>0&&ee(n,ja(m.applicationStats),2.6),ee(n,Ca(),2.8),ee(n,$a(),3)}else if(o){const m=await ba();ee(n,va(a,m)),ee(n,_a(m),.5),ee(n,Sa(m),1),(f=m.featuredJobs)!=null&&f.length&&ee(n,Aa(m.featuredJobs),1.5),ee(n,_e("Impulsa tu perfil profesional","Aprovecha estos recursos para posicionarte mejor frente a los reclutadores.","Tu crecimiento"),1.6),ee(n,wa(),1.7),(d=m.recommendedTrainings)!=null&&d.length&&ee(n,Ea(m.recommendedTrainings),2),(p=m.recommendedCategories)!=null&&p.length&&ee(n,ka(m.recommendedCategories),2.3),m.myApplications>0&&ee(n,ja(m.applicationStats),2.6),ee(n,Ca(),2.8),ee(n,$a(),3)}e.appendChild(n)}function zo(){const e=document.querySelector('[data-page="home"]');e&&Bo(e)}function Vo(e){if(!e||typeof e!="object")return!1;const t=(...o)=>o.find(l=>{const i=e[l];return i!=null&&String(i).trim().length>0}),a=!!t("company_name","name"),n=!!t("email"),s=!!t("nit","tax_id","ruc","identification"),r=!!t("description","about");return a&&n&&r&&(s||!0)}async function Jo(e){var n,s;const t=Ie()==="cookie"?Ae:H;async function a(r,o="POST"){return await t(r,{method:o,body:e})}try{return await a("/unemployed")}catch(r){if((r==null?void 0:r.status)===404||(r==null?void 0:r.status)===405)try{return await a("/agg-unemployed")}catch(o){if((o==null?void 0:o.status)===404||(o==null?void 0:o.status)===405)try{return await a("/unemployeds")}catch(l){if((l==null?void 0:l.status)===404||(l==null?void 0:l.status)===405)return await a("/unemployed-profile");throw l}throw o}try{if(typeof import.meta<"u"&&((s=(n=import.meta)==null?void 0:n.env)==null?void 0:s.VITE_FAKE_UNEMPLOYED_WHEN_FAIL)==="true"||["localhost","127.0.0.1"].includes(window.location.hostname)){const l="local_unemployed_profiles",i=JSON.parse(localStorage.getItem(l)||"[]"),c={id:Date.now(),...e,created_at:new Date().toISOString()};return i.push(c),localStorage.setItem(l,JSON.stringify(i)),c}}catch{}throw r}}function Go(e){const t=e==null?void 0:e.data;if(t&&t.errors&&typeof t.errors=="object"){const a=Object.values(t.errors)[0];if(Array.isArray(a)&&a.length)return a[0]}return(t==null?void 0:t.message)||(e==null?void 0:e.message)||"Error inesperado"}function Re(e,t=document){return t.querySelector(e)}function He(e,t){var n,s;if(!e)return;let a=(n=e.closest("label, div"))==null?void 0:n.querySelector(".field-error");a||(a=document.createElement("span"),a.className="field-error text-xs font-medium text-red-600",(s=e.closest("label, div"))==null||s.appendChild(a)),a.textContent=t||""}async function Wo(e){e||(e=document);const t=e.querySelector('form[action*="unemployed"]')||e.querySelector("form");if(!t)return;const a=Re('input[name="profession"]',t)||Re("#profession",t),n=Re('textarea[name="experience"]',t)||Re("#experience",t),s=Re('input[name="location"]',t)||Re("#location",t),r=e.querySelector("[data-error]"),o=e.querySelector("[data-error-text]");r&&r.classList.add("hidden"),t.addEventListener("submit",async l=>{var c,f,d,p,m,y;l.preventDefault(),He(a,""),He(n,""),He(s,""),r&&(r.classList.add("hidden"),o&&(o.textContent=""));const i={profession:((c=a==null?void 0:a.value)==null?void 0:c.trim())||"",experience:((f=n==null?void 0:n.value)==null?void 0:f.trim())||"",location:((d=s==null?void 0:s.value)==null?void 0:d.trim())||""};try{await Jo(i);try{localStorage.removeItem("pending_role"),localStorage.removeItem("pending_name"),localStorage.setItem("profile_completed","1")}catch{}window.location.href="/html/pages/home.html"}catch(g){const h=g==null?void 0:g.data;if((g==null?void 0:g.status)===401||(g==null?void 0:g.code)==="AUTH_REQUIRED"){r&&(r.classList.remove("hidden"),o&&(o.textContent="Debes iniciar sesión para completar tu perfil. Redirigiendo al login...")),setTimeout(()=>{const E=encodeURIComponent("/html/forms/unemployed-form.html");window.location.href=`/html/auth/login.html?redirect=${E}`},800);return}h!=null&&h.errors&&((p=h.errors.profession)!=null&&p[0]&&He(a,h.errors.profession[0]),(m=h.errors.experience)!=null&&m[0]&&He(n,h.errors.experience[0]),(y=h.errors.location)!=null&&y[0]&&He(s,h.errors.location[0])),r&&(r.classList.remove("hidden"),o&&(o.textContent=Go(g)||"No se pudo enviar el formulario. Intenta de nuevo.")),console.error("unemployed form error",g)}})}function Ko(){const e=document.querySelector('[data-page="unemployed-form"]')||document.querySelector('form[action*="unemployed"], form[action*="agg-unemployed"]');e&&Wo(e.closest("main")||document)}async function Wt(e={}){const t=["/interview","/interviews"];let a=null;for(const n of t)try{return await H(n,{query:e})}catch(s){a=s}throw a||new Error("No se pudo obtener entrevistas")}async function Qo(e={}){const t=["/interview/count","/interviews/count"];for(const a of t)try{const n=await H(a,{query:e});if(typeof n=="number")return n;if(Number.isFinite(n==null?void 0:n.total))return n.total}catch{}try{const a=await Wt({...e,per_page:1,page:1}),n=(a==null?void 0:a.meta)||(a==null?void 0:a.pagination),s=(n==null?void 0:n.total)??(a==null?void 0:a.total);if(Number.isFinite(s))return s}catch{}try{const a=await Wt({...e,per_page:50,page:1});return(Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:[]).length}catch{return 0}}function le(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}async function Xo(e){var c,f;if(!e)return;e.innerHTML="";const t=new URLSearchParams(location.search),a=e.getAttribute("data-application-id")||t.get("application_id")||t.get("id"),n=le("div",{class:"flex items-start justify-between gap-4 mb-4"},le("div",null,le("a",{href:"/html/job-applications/index-unemployed.html",class:"text-sm text-gray-600 hover:text-gray-800 inline-flex items-center gap-2"},"← Volver"),le("h2",{class:"text-2xl font-extrabold text-gray-800 mt-2",id:"title"},"Entrevistas"),le("p",{class:"text-sm text-gray-500 mt-1"},"Lista de entrevistas programadas para esta postulación.")),le("div",{class:"text-sm text-gray-600",id:"total"},"Total: 0"));e.appendChild(n);const s=le("div",{class:"hidden mb-4 p-3 rounded",id:"alert"});e.appendChild(s);const r=le("div",{class:"grid grid-cols-1 gap-4",id:"list"});if(e.appendChild(r),a)try{const d=await Tn(a),p=(d==null?void 0:d.data)??d,m=((c=p==null?void 0:p.jobOffer)==null?void 0:c.title)||((f=p==null?void 0:p.job_offer)==null?void 0:f.title);m&&(n.querySelector("#title").textContent=`Entrevistas para: ${m}`)}catch{}const o=t.get("success")||t.get("message");o&&i(o==="1"||o==="true"?"Acción realizada con éxito":o,"success"),await l(a);async function l(d){var y;r.innerHTML="";const p=d?{job_application_id:d,per_page:100}:{per_page:100};let m=[];try{const g=await Wt(p);m=Array.isArray(g)?g:Array.isArray(g==null?void 0:g.data)?g.data:[];const h=await Qo(p);n.querySelector("#total").textContent=`Total: ${h??m.length}`}catch(g){i(`Error cargando entrevistas: ${((y=g==null?void 0:g.data)==null?void 0:y.message)||g.message}`,"error")}if(!m.length){r.appendChild(le("div",{class:"p-4 bg-gray-50 border border-gray-200 rounded text-gray-700"},"No hay entrevistas programadas."));return}for(const g of m)r.appendChild(Yo(g))}function i(d,p="info"){if(!s)return;s.classList.remove("hidden");const m="mb-4 p-3 rounded",y=p==="error"?"bg-red-50 text-red-800 border border-red-200":p==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-blue-50 text-blue-800 border border-blue-200";s.className=`${m} ${y}`,s.textContent=d}}function Yo(e){const t={"in-person":"Presencial",online:"En línea"},a={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",scheduled:"bg-blue-100 text-blue-800"},n=ei(e.scheduled_at||e.date||e.when),s=e.duration_minutes||e.duration||0,r=t[e.mode]||(e.mode?hn(e.mode):"—"),o=e.location||"",l=e.status||e.state||"pending",i=a[l]||"bg-gray-100 text-gray-700";return le("div",{class:"p-4 bg-white border rounded flex items-center justify-between"},le("div",null,le("div",{class:"font-semibold"},`${n}${s?` (${s} min)`:""}`),le("div",{class:"text-sm text-gray-600"},`${r}${o?` · ${o}`:""}`)),le("div",{class:"flex items-center gap-4"},le("span",{class:`px-2 py-1 rounded ${i} text-xs font-semibold`},Zo(l))))}function Zo(e){return{pending:"Pendiente",accepted:"Aceptada",rejected:"Rechazada",scheduled:"Programada"}[e]||hn(e)}function hn(e){return(e||"").charAt(0).toUpperCase()+(e||"").slice(1)}function ei(e){try{const t=new Date(e),a=t.toLocaleDateString(),n=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`${a} ${n}`}catch{return String(e||"")}}function ti(){const e=document.querySelector('[data-page="interviews-index"]');e&&Xo(e)}function F(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}const Xe=new Intl.NumberFormat("es-CO");async function ai(e){if(!e)return;e.innerHTML="";const{allowed:t}=await ce("admin");if(!t)return;const a=new URLSearchParams(location.search);let n=parseInt(a.get("page")||"1",10);n<1&&(n=1);const s=parseInt(a.get("per_page")||"10",10),r=F("div",{class:"mb-8"},F("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},F("div",null,F("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Clasificados"),F("p",{class:"text-gray-600"},"Gestiona todas las publicaciones de clasificados")),F("div",{class:"mt-4 md:mt-0 flex items-center space-x-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl shadow-soft"},F("i",{class:"fas fa-list-check text-xl"}),F("div",null,F("p",{class:"text-xs text-blue-100"},"Total de Clasificados"),F("p",{class:"text-2xl font-bold",id:"total"},"0")))),F("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},m("Total Publicaciones","0","fa-file-alt","from-blue-400 to-blue-600"),m("Por Empresas","0","fa-building","from-indigo-400 to-indigo-600"),m("Por Desempleados","0","fa-user-tie","from-green-400 to-green-600")));e.appendChild(r);const o=F("div",{class:"card-enhanced overflow-hidden"}),l=F("table",{class:"min-w-full divide-y divide-gray-200"});l.innerHTML=`
    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
      <tr>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-heading mr-2 text-blue-500"></i>Título</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-user mr-2 text-blue-500"></i>Creado por</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-tag mr-2 text-blue-500"></i>Tipo</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>Ubicación</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-dollar-sign mr-2 text-blue-500"></i>Salario</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-folder mr-2 text-blue-500"></i>Categorías</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-calendar mr-2 text-blue-500"></i>Fecha</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-cog mr-2 text-blue-500"></i>Acciones</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200" id="tbody"></tbody>
  `;const i=F("div",{class:"overflow-x-auto"},l);o.appendChild(i);const c=F("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200",id:"pager"});o.appendChild(c),e.appendChild(o),await f();async function f(){var M;const g=await an({per_page:s,page:n}),h=Array.isArray(g)?g:Array.isArray(g==null?void 0:g.data)?g.data:[],E=((M=g==null?void 0:g.meta)==null?void 0:M.total)??(g==null?void 0:g.total)??h.length,C=h.filter(k=>!!k.company_id||k.company).length,$=h.filter(k=>!!k.unemployed_id||k.unemployed).length;r.querySelector("#total").textContent=Xe.format(E);const v=r.querySelectorAll(".card-enhanced p.text-2xl");v.length>=3&&(v[0].textContent=Xe.format(E),v[1].textContent=Xe.format(C),v[2].textContent=Xe.format($));const x=l.querySelector("#tbody");if(x.innerHTML="",h.length)for(const k of h)x.appendChild(d(k));else{const k=F("tr",null,F("td",{colspan:"8",class:"px-6 py-12 text-center"},ri()));x.appendChild(k)}p(g==null?void 0:g.meta,E)}function d(y){var $,v,x,M,k,q,j,b,w;const g=y.created_at?new Date(y.created_at):null,h=y.company?{type:"Empresa",icon:"fa-building",name:((v=($=y.company)==null?void 0:$.user)==null?void 0:v.name)||((x=y.company)==null?void 0:x.name)||"N/A",email:((k=(M=y.company)==null?void 0:M.user)==null?void 0:k.email)||""}:y.unemployed?{type:"Desempleado",icon:"fa-user",name:((j=(q=y.unemployed)==null?void 0:q.user)==null?void 0:j.name)||"N/A",email:((w=(b=y.unemployed)==null?void 0:b.user)==null?void 0:w.email)||""}:null,E=Array.isArray(y.categories)?y.categories:[],C=F("tr",{class:"hover:bg-gray-50 transition-colors duration-200"});return C.appendChild(Se(F("div",{class:"text-sm font-semibold text-gray-900"},y.title||"—"),F("div",{class:"text-xs text-gray-500 mt-1 truncate max-w-xs"},ii(oi(y.description||""),60)))),C.appendChild(Se(h?ni(h):F("span",{class:"text-sm text-gray-400"},"N/A"))),C.appendChild(Se(F("span",{class:`inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-lg shadow-sm ${(h==null?void 0:h.type)==="Empresa"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gradient-to-r from-green-500 to-green-600 text-white"}`},F("i",{class:`fas ${h==null?void 0:h.icon} mr-1.5`}),(h==null?void 0:h.type)||"—"))),C.appendChild(Se(cellIcon("fa-location-dot",y.location||"—"))),C.appendChild(Se(y.salary?F("div",{class:"flex items-center text-sm font-semibold text-green-600"},F("i",{class:"fas fa-money-bill-wave mr-2"}),`$${Xe.format(y.salary)}`):F("span",{class:"text-xs text-gray-400 italic"},"No especificado"))),C.appendChild(Se(E.length?F("div",{class:"flex flex-wrap gap-1 max-w-xs"},...E.map(O=>F("span",{class:"inline-block bg-gradient-to-r from-gray-100 to-gray-200 rounded-lg px-2.5 py-1 text-xs font-medium text-gray-700 shadow-sm"},F("i",{class:"fas fa-tag text-gray-500 mr-1"}),O.name||O))):F("span",{class:"text-xs text-gray-400 italic"},"Sin categorías"))),C.appendChild(Se(F("div",{class:"text-sm text-gray-700 font-medium"},F("i",{class:"far fa-calendar-alt text-gray-400 mr-1"}),g?fmtDate(g):"—"),F("div",{class:"text-xs text-gray-500 mt-0.5"},F("i",{class:"far fa-clock text-gray-400 mr-1"}),g?fmtTime(g):"—"))),C.appendChild(Se(F("div",{class:"flex items-center space-x-2"},La("fa-eye","Ver detalles",`/html/classifieds/show.html?id=${encodeURIComponent(y.id)}`,!0),La("fa-edit","Editar",`/html/admin/classifieds/edit.html?id=${encodeURIComponent(y.id)}`),si(y.id)))),C}function p(y,g){c.innerHTML="";const h=((y==null?void 0:y.last_page)??Math.ceil((g||0)/s))||1,E=F("div",{class:"flex items-center justify-between"}),C=F("a",{class:`px-3 py-2 rounded border ${n>1?"text-gray-700 hover:bg-gray-100":"text-gray-400 cursor-not-allowed"}`,href:n>1?Ta({page:n-1}):"#"},"Anterior"),$=F("a",{class:`px-3 py-2 rounded border ${n<h?"text-gray-700 hover:bg-gray-100":"text-gray-400 cursor-not-allowed"}`,href:n<h?Ta({page:n+1}):"#"},"Siguiente");E.appendChild(C),E.appendChild(F("div",null,`Página ${n} de ${h}`)),E.appendChild($),c.appendChild(E)}function m(y,g,h,E){return F("div",{class:"card-enhanced p-5 hover-lift"},F("div",{class:"flex items-center justify-between"},F("div",null,F("p",{class:"text-sm text-gray-500 mb-1"},y),F("p",{class:"text-2xl font-bold text-gray-800"},g)),F("div",{class:`w-12 h-12 bg-gradient-to-br ${E} rounded-xl flex items-center justify-center`},F("i",{class:`fas ${h} text-white text-xl`}))))}}function Se(...e){return F("td",{class:"px-6 py-4"},...e)}function ni(e){return F("div",{class:"flex items-start space-x-2"},F("div",{class:`w-8 h-8 ${e.type==="Empresa"?"bg-blue-100":"bg-green-100"} rounded-lg flex items-center justify-center flex-shrink-0`},F("i",{class:`fas ${e.icon} ${e.type==="Empresa"?"text-blue-600":"text-green-600"} text-xs`})),F("div",null,F("div",{class:"text-sm font-medium text-gray-900"},e.name),F("div",{class:"text-xs text-gray-500"},e.email),F("span",{class:`inline-block mt-1 px-2 py-0.5 text-xs font-medium ${e.type==="Empresa"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"} rounded-full`},e.type)))}function La(e,t,a,n=!1){const s=F("a",{href:a,title:t,class:"w-8 h-8 flex items-center justify-center bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-all hover-lift"});return s.appendChild(F("i",{class:`fas ${e} text-sm`})),n&&(s.target="_blank"),s}function si(e){const t=F("button",{class:"w-8 h-8 flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-all hover-lift",title:"Eliminar"},F("i",{class:"fas fa-trash-alt text-sm"}));return t.addEventListener("click",()=>{confirm("¿Estás seguro de eliminar este clasificado?")&&alert("Esta versión estática no puede eliminar. Implementa llamada DELETE si el backend lo permite.")}),t}function ri(){return F("div",{class:"flex flex-col items-center justify-center"},F("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4"},F("i",{class:"fas fa-inbox text-3xl text-gray-400"})),F("p",{class:"text-gray-500 font-medium"},"No hay clasificados disponibles"),F("p",{class:"text-sm text-gray-400 mt-1"},"Los clasificados publicados aparecerán aquí"))}function Ta(e){const t=new URL(location.href);for(const[a,n]of Object.entries(e))t.searchParams.set(a,n);return t.toString()}function oi(e){const t=document.createElement("div");return t.innerHTML=e||"",t.textContent||t.innerText||""}function ii(e,t){return e?e.length>t?e.slice(0,t-1)+"…":e:""}function li(){const e=document.querySelector('[data-page="admin-classifieds-index"]');e&&ai(e)}function U(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}const Be=new Intl.NumberFormat("es-CO");async function ci(e){if(!e)return;e.innerHTML="";const{allowed:t}=await ce("admin");if(!t)return;const a=new URLSearchParams(location.search);let n=parseInt(a.get("page")||"1",10);n<1&&(n=1);const s=parseInt(a.get("per_page")||"10",10),r=U("div",{class:"mb-8"},U("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},U("div",null,U("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Ofertas Laborales"),U("p",{class:"text-gray-600"},"Gestiona todas las oportunidades de empleo")),U("div",{class:"mt-4 md:mt-0 flex items-center space-x-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl shadow-soft"},U("i",{class:"fas fa-briefcase text-xl"}),U("div",null,U("p",{class:"text-xs text-green-100"},"Total de Ofertas"),U("p",{class:"text-2xl font-bold",id:"total"},"0")))),U("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},yt("Total Ofertas","0","fa-briefcase","from-blue-400 to-blue-600"),yt("Empresas","0","fa-building","from-green-400 to-green-600"),yt("Con Salario","0","fa-money-bill-wave","from-purple-400 to-purple-600"),yt("Este Mes","0","fa-calendar-check","from-yellow-400 to-orange-500")));e.appendChild(r);const o=U("div",{class:"card-enhanced overflow-hidden"}),l=U("table",{class:"min-w-full divide-y divide-gray-200"});l.innerHTML=`
    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
      <tr>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-heading mr-2 text-green-500"></i>Título</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-building mr-2 text-green-500"></i>Empresa</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-map-marker-alt mr-2 text-green-500"></i>Ubicación</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-dollar-sign mr-2 text-green-500"></i>Salario</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-folder mr-2 text-green-500"></i>Categorías</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-calendar mr-2 text-green-500"></i>Fecha</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"><i class="fas fa-cog mr-2 text-green-500"></i>Acciones</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200" id="tbody"></tbody>
  `;const i=U("div",{class:"overflow-x-auto"},l);o.appendChild(i);const c=U("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200",id:"pager"});o.appendChild(c),e.appendChild(o),await f();async function f(){var M;const y=await xe({per_page:s,page:n}),g=Array.isArray(y)?y:Array.isArray(y==null?void 0:y.data)?y.data:[],h=((M=y==null?void 0:y.meta)==null?void 0:M.total)??(y==null?void 0:y.total)??g.length,E=new Set(g.map(k=>{var q;return k.company_id||((q=k.company)==null?void 0:q.id)}).filter(Boolean)),C=g.filter(k=>Number(k.salary)>0).length,$=g.filter(k=>hi(k.created_at)).length;r.querySelector("#total").textContent=Be.format(h);const v=r.querySelectorAll(".card-enhanced p.text-2xl");v.length>=4&&(v[0].textContent=Be.format(h),v[1].textContent=Be.format(E.size),v[2].textContent=Be.format(C),v[3].textContent=Be.format($));const x=l.querySelector("#tbody");if(x.innerHTML="",g.length)for(const k of g)x.appendChild(d(k));else{const k=U("tr",null,U("td",{colspan:"7",class:"px-6 py-12 text-center"},emptyState()));x.appendChild(k)}p(y==null?void 0:y.meta,h)}function d(m){var E,C,$,v,x;const y=m.created_at?new Date(m.created_at):null,g=Array.isArray(m.categories)?m.categories:[],h=U("tr",{class:"hover:bg-gray-50 transition-colors duration-200"});return h.appendChild($e(U("div",{class:"flex items-center space-x-3"},U("div",{class:"w-10 h-10 bg-gradient-to-br from-green-100 to-green-200 rounded-xl flex items-center justify-center flex-shrink-0"},U("i",{class:"fas fa-briefcase text-green-600"})),U("div",null,U("div",{class:"text-sm font-semibold text-gray-900"},m.title||"—"),U("div",{class:"text-xs text-gray-500 mt-1 truncate max-w-xs"},pi(mi(m.description||""),60)))))),h.appendChild($e(U("div",{class:"flex items-start space-x-2"},U("div",{class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"},U("i",{class:"fas fa-building text-blue-600 text-xs"})),U("div",null,U("div",{class:"text-sm font-medium text-gray-900"},((C=(E=m.company)==null?void 0:E.user)==null?void 0:C.name)||(($=m.company)==null?void 0:$.name)||"N/A"),U("div",{class:"text-xs text-gray-500"},((x=(v=m.company)==null?void 0:v.user)==null?void 0:x.email)||""))))),h.appendChild($e(di("fa-location-dot",m.location||"—"))),h.appendChild($e(Number(m.salary)>0?U("div",{class:"flex items-center text-sm font-semibold text-green-600"},U("i",{class:"fas fa-money-bill-wave mr-2"}),`$${Be.format(m.salary)}`):U("span",{class:"inline-flex items-center px-2.5 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-lg"},U("i",{class:"fas fa-minus-circle mr-1"}),"No especificado"))),h.appendChild($e(g.length?U("div",{class:"flex flex-wrap gap-1 max-w-xs"},...g.map(M=>U("span",{class:"inline-block bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg px-2.5 py-1 text-xs font-medium text-blue-700 shadow-sm"},U("i",{class:"fas fa-tag text-blue-500 mr-1"}),M.name||M))):U("span",{class:"text-xs text-gray-400 italic"},"Sin categorías"))),h.appendChild($e(U("div",{class:"text-sm text-gray-700 font-medium"},U("i",{class:"far fa-calendar-alt text-gray-400 mr-1"}),y?gi(y):"—"),U("div",{class:"text-xs text-gray-500 mt-0.5"},U("i",{class:"far fa-clock text-gray-400 mr-1"}),y?yi(y):"—"))),h.appendChild($e(U("div",{class:"flex items-center space-x-2"},ui("fa-eye","Ver oferta",`/html/job-offers/show.html?id=${encodeURIComponent(m.id)}`,!0),fi(m.id)))),h}function p(m,y){c.innerHTML="";const g=((m==null?void 0:m.last_page)??Math.ceil((y||0)/s))||1,h=U("div",{class:"flex items-center justify-between"}),E=U("div",{class:"text-sm text-gray-700"},`Mostrando ${(n-1)*s+1} a ${Math.min(n*s,y)} de ${y} resultados`),C=U("a",{class:`px-3 py-2 rounded border ${n>1?"text-gray-700 hover:bg-gray-100":"text-gray-400 cursor-not-allowed"}`,href:n>1?qa({page:n-1}):"#"},"Anterior"),$=U("a",{class:`px-3 py-2 rounded border ${n<g?"text-gray-700 hover:bg-gray-100":"text-gray-400 cursor-not-allowed"}`,href:n<g?qa({page:n+1}):"#"},"Siguiente");h.appendChild(E),h.appendChild(U("div",null,`Página ${n} de ${g}`)),h.appendChild(U("div",null,C)),h.appendChild(U("div",null,$)),c.appendChild(h)}}function yt(e,t,a,n){return U("div",{class:"card-enhanced p-5 hover-lift"},U("div",{class:"flex items-center justify-between"},U("div",null,U("p",{class:"text-sm text-gray-500 mb-1"},e),U("p",{class:"text-2xl font-bold text-gray-800"},t)),U("div",{class:`w-12 h-12 bg-gradient-to-br ${n} rounded-xl flex items-center justify-center`},U("i",{class:`fas ${a} text-white text-xl`}))))}function $e(...e){return U("td",{class:"px-6 py-4"},...e)}function di(e,t){return U("div",{class:"flex items-center text-sm text-gray-700"},U("i",{class:`fas ${e} text-gray-400 mr-2`}),t)}function ui(e,t,a,n=!1){const s=U("a",{href:a,title:t,class:"w-8 h-8 flex items-center justify-center bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-all hover-lift"});return s.appendChild(U("i",{class:`fas ${e} text-sm`})),n&&(s.target="_blank"),s}function fi(e){const t=U("button",{class:"w-8 h-8 flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-all hover-lift",title:"Eliminar oferta"},U("i",{class:"fas fa-trash-alt text-sm"}));return t.addEventListener("click",()=>{confirm("¿Eliminar esta oferta laboral?")&&alert("Esta versión estática no puede eliminar. Implementa DELETE si el backend lo permite.")}),t}function mi(e){const t=document.createElement("div");return t.innerHTML=e||"",t.textContent||t.innerText||""}function pi(e,t){return e?e.length>t?e.slice(0,t-1)+"…":e:""}function gi(e){return e.toLocaleDateString()}function yi(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function hi(e){if(!e)return!1;const t=new Date(e).getTime(),n=Date.now()-720*3600*1e3;return t>=n}function qa(e){const t=new URL(location.href);for(const[a,n]of Object.entries(e))t.searchParams.set(a,n);return t.toString()}function xi(){const e=document.querySelector('[data-page="admin-job-offers-index"]');e&&ci(e)}async function bi(e={}){var a;const t=["/user/count","/users/count","/users/total"];for(const n of t)try{const s=await H(n,{query:e}),r=typeof s=="number"?s:(s==null?void 0:s.total)??(s==null?void 0:s.count)??((a=s==null?void 0:s.data)==null?void 0:a.total);if(Number.isFinite(r))return r}catch{}return 0}function K(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}const ht=new Intl.NumberFormat("es-CO");async function vi(e){var f;if(!e)return;e.innerHTML="";const{allowed:t}=await ce("admin");if(!t)return;const a=K("div",{class:"mb-8"},K("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Dashboard Administrativo"),K("p",{class:"text-gray-600"},"Bienvenido al panel de administración"));e.appendChild(a);const n=K("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"}),s=xt("Clasificados","fa-file-alt","from-blue-400 to-blue-600");n.appendChild(s.host);const r=xt("Ofertas Laborales","fa-briefcase","from-green-400 to-green-600");n.appendChild(r.host);const o=xt("Capacitaciones","fa-graduation-cap","from-purple-400 to-purple-600");n.appendChild(o.host);const l=xt("Usuarios","fa-users","from-yellow-400 to-orange-500");n.appendChild(l.host),e.appendChild(n);const i=K("div",{class:"card-enhanced p-8 mb-8 hover-lift"},K("div",{class:"flex items-center mb-6"},K("div",{class:"w-10 h-10 gradient-primary rounded-lg flex items-center justify-center mr-3"},K("i",{class:"fas fa-bolt text-white"})),K("h3",{class:"text-xl font-bold text-gray-800"},"Acciones Rápidas")),K("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Na("/html/admin/trainings/create.html","Nueva Capacitación","Crear curso de formación","fa-graduation-cap","from-purple-500 to-purple-600"),Na("/html/admin/layout.html","Nuevo Usuario","Registrar nuevo usuario","fa-user-plus","from-orange-500 to-orange-600")));e.appendChild(i);const c=K("div",{class:"mb-6"},K("h3",{class:"text-xl font-bold text-gray-800 mb-4 flex items-center"},K("i",{class:"fas fa-th-large mr-2 text-blue-500"}),"Gestión de Módulos"));e.appendChild(c),e.appendChild(wi());try{s.set(ht.format(await Jt()))}catch{}try{r.set(ht.format(await Ce()))}catch{}try{const d=await Lt({per_page:1,page:1}),p=((f=d==null?void 0:d.meta)==null?void 0:f.total)??(d==null?void 0:d.total)??(Array.isArray(d)?d.length:Array.isArray(d==null?void 0:d.data)?d.data.length:0);o.set(ht.format(p))}catch{}try{l.set(ht.format(await bi()))}catch{}}function xt(e,t,a){const n=K("p",{class:"text-3xl font-bold text-gray-800"},"");return{host:K("div",{class:"card-enhanced p-6 hover-lift"},K("div",{class:"flex items-center justify-between"},K("div",{class:"flex items-center space-x-4"},K("div",{class:`w-14 h-14 bg-gradient-to-br ${a} rounded-xl flex items-center justify-center shadow-soft`},K("i",{class:`fas ${t} text-2xl text-white`})),K("div",null,K("h3",{class:"text-sm font-medium text-gray-500 mb-1"},e),n))),K("div",{class:"mt-4 pt-4 border-t border-gray-100"},K("span",{class:"text-xs text-gray-600 font-medium"},e))),set:r=>{n.textContent=String(r)}}}function Na(e,t,a,n,s){return K("a",{href:e,class:`group relative overflow-hidden bg-gradient-to-br ${s} hover:from-80% text-white px-6 py-4 rounded-xl shadow-soft transition-all duration-300 hover-lift`},K("div",{class:"flex items-center justify-between"},K("div",{class:"flex items-center space-x-3"},K("div",{class:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center"},K("i",{class:`fas ${n} text-xl`})),K("div",null,K("p",{class:"font-semibold text-lg"},t),K("p",{class:"text-sm opacity-80"},a))),K("i",{class:"fas fa-arrow-right text-white/70 group-hover:text-white group-hover:translate-x-1 transition-all"})))}function wi(){return K("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},bt("/html/admin/classifieds/index.html","Clasificados","Ver, editar y eliminar publicaciones de clasificados","fa-file-alt","from-blue-100 to-blue-200","text-blue-600","Solo edición","bg-blue-100 text-blue-700"),bt("/html/admin/job-offers/index.html","Ofertas Laborales","Ver, editar y eliminar ofertas de empleo publicadas","fa-briefcase","from-green-100 to-green-200","text-green-600","Solo edición","bg-green-100 text-green-700"),bt("/html/admin/trainings/index.html","Capacitaciones","Gestionar cursos, crear, editar y eliminar capacitaciones","fa-graduation-cap","from-purple-100 to-purple-200","text-purple-600","Control total","bg-purple-100 text-purple-700"),bt("/html/admin/layout.html","Usuarios","Administrar usuarios, crear, editar y eliminar cuentas","fa-users","from-orange-100 to-orange-200","text-orange-600","Control total","bg-orange-100 text-orange-700"))}function bt(e,t,a,n,s,r,o,l){return K("a",{href:e,class:"card-enhanced p-6 hover-lift group transition-all duration-300"},K("div",{class:"flex items-start justify-between mb-4"},K("div",{class:`w-12 h-12 bg-gradient-to-br ${s} rounded-xl flex items-center justify-center`},K("i",{class:`fas ${n} text-2xl ${r}`})),K("span",{class:`px-3 py-1 ${l} text-xs font-medium rounded-full`},o)),K("h3",{class:`text-lg font-bold text-gray-800 mb-2 group-hover:${r} transition-colors`},t),K("p",{class:"text-gray-600 text-sm mb-3"},a),K("div",{class:`flex items-center ${r} text-sm font-medium`},K("span",null,"Administrar ",t.toLowerCase()),K("i",{class:"fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform"})))}function Si(){const e=document.querySelector('[data-page="admin-dashboard"]');e&&vi(e)}function T(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}const Vt={day:"2-digit",month:"2-digit",year:"numeric"},Ci={hour:"2-digit",minute:"2-digit"};function Ge(e){if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t}function _i(e){const t=new Date,a=Ge(e.start_date),n=Ge(e.end_date);let s="Sin fecha",r="fa-question-circle",o="bg-gray-100",l="text-gray-700";return a&&n?t>=a&&t<=n?(s="En curso",r="fa-circle-play",o="bg-gradient-to-r from-green-100 to-green-200",l="text-green-700"):t<a?(s="Próxima",r="fa-clock",o="bg-gradient-to-r from-blue-100 to-blue-200",l="text-blue-700"):(s="Finalizada",r="fa-circle-check",o="bg-gray-100",l="text-gray-600"):a&&t<a?(s="Próxima",r="fa-clock",o="bg-gradient-to-r from-blue-100 to-blue-200",l="text-blue-700"):n&&t>n&&(s="Finalizada",r="fa-circle-check",o="bg-gray-100",l="text-gray-600"),T("span",{class:`inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-lg ${o} ${l} shadow-sm`},T("i",{class:`fas ${r} mr-1.5`}),s)}function Ai(e){const t=e.title||e.name||"—",a=e.provider||"",n=Ge(e.created_at),s=Ge(e.start_date),r=Ge(e.end_date),o=e.link||e.url||"";return T("tr",{class:"hover:bg-gray-50 transition-colors duration-200"},T("td",{class:"px-6 py-4"},T("div",{class:"flex items-center space-x-3"},T("div",{class:"w-10 h-10 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl flex items-center justify-center flex-shrink-0"},T("i",{class:"fas fa-graduation-cap text-purple-600"})),T("div",{class:"max-w-xs"},T("div",{class:"text-sm font-semibold text-gray-900"},t),T("div",{class:"text-xs text-gray-500 mt-1 truncate"},(e.description||"").slice(0,60))))),T("td",{class:"px-6 py-4 whitespace-nowrap"},a?T("div",{class:"flex items-center text-sm text-gray-700"},T("i",{class:"fas fa-university text-gray-400 mr-2"}),a):T("span",{class:"text-xs text-gray-400 italic"},"No especificado")),T("td",{class:"px-6 py-4 whitespace-nowrap"},T("div",{class:"text-sm space-y-1"},s?T("div",{class:"flex items-center text-green-600"},T("i",{class:"fas fa-play-circle mr-1 text-xs"}),T("span",{class:"font-medium"},s.toLocaleDateString("es-ES",Vt))):null,r?T("div",{class:"flex items-center text-red-600"},T("i",{class:"fas fa-stop-circle mr-1 text-xs"}),T("span",{class:"font-medium"},r.toLocaleDateString("es-ES",Vt))):null,!s&&!r?T("span",{class:"text-xs text-gray-400 italic"},"Sin fechas"):null)),T("td",{class:"px-6 py-4 whitespace-nowrap"},o?T("a",{href:o,target:"_blank",class:"inline-flex items-center px-3 py-1.5 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-xs font-medium transition-all"},T("i",{class:"fas fa-external-link-alt mr-1.5"}),"Ver enlace"):T("span",{class:"inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-500 rounded-lg text-xs"},T("i",{class:"fas fa-minus-circle mr-1.5"}),"Sin enlace")),T("td",{class:"px-6 py-4 whitespace-nowrap"},_i(e)),T("td",{class:"px-6 py-4 whitespace-nowrap"},n?T("div",null,T("div",{class:"text-sm text-gray-700 font-medium"},T("i",{class:"far fa-calendar-alt text-gray-400 mr-1"}),n.toLocaleDateString("es-ES",Vt)),T("div",{class:"text-xs text-gray-500 mt-0.5"},T("i",{class:"far fa-clock text-gray-400 mr-1"}),n.toLocaleTimeString("es-ES",Ci))):T("span",{class:"text-sm text-gray-500"},"—")),T("td",{class:"px-6 py-4 whitespace-nowrap"},T("div",{class:"flex items-center space-x-2"},T("a",{href:`/html/training/index.html?id=${encodeURIComponent(e.id)}`,class:"w-8 h-8 flex items-center justify-center bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-all",title:"Ver detalles"},T("i",{class:"fas fa-eye text-sm"})),T("a",{href:`/html/admin/trainings/edit.html?id=${encodeURIComponent(e.id)}`,class:"w-8 h-8 flex items-center justify-center bg-indigo-100 hover:bg-indigo-200 text-indigo-600 rounded-lg transition-all",title:"Editar"},T("i",{class:"fas fa-edit text-sm"})),T("button",{type:"button",class:"w-8 h-8 flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-all",title:"Eliminar",onclick:()=>alert("Eliminar no está habilitado en la versión estática.")},T("i",{class:"fas fa-trash-alt text-sm"})))))}function Ei(){const e=T("p",{class:"text-2xl font-bold text-gray-800"},"—"),t=T("p",{class:"text-2xl font-bold text-gray-800"},"—"),a=T("p",{class:"text-2xl font-bold text-gray-800"},"—"),n=T("p",{class:"text-2xl font-bold text-gray-800"},"—");return{host:T("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},vt("Total Capacitaciones","fa-graduation-cap","from-purple-400 to-purple-600",e),vt("Con Enlace","fa-link","from-blue-400 to-blue-600",t),vt("Activas","fa-calendar-check","from-green-400 to-green-600",a),vt("Proveedores","fa-building","from-orange-400 to-orange-600",n)),set(r){const{total:o,withLink:l,active:i,providers:c}=r||{};e.textContent=o!=null?String(o):"—",t.textContent=l!=null?String(l):"—",a.textContent=i!=null?String(i):"—",n.textContent=c!=null?String(c):"—"}}}function vt(e,t,a,n){return T("div",{class:"card-enhanced p-5 hover-lift"},T("div",{class:"flex items-center justify-between"},T("div",null,T("p",{class:"text-sm text-gray-500 mb-1"},e),n),T("div",{class:`w-12 h-12 bg-gradient-to-br ${a} rounded-xl flex items-center justify-center`},T("i",{class:`fas ${t} text-white text-xl`}))))}function ki(){return T("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},T("div",null,T("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Capacitaciones"),T("p",{class:"text-gray-600"},"Administra los cursos y programas de formación")),T("div",{class:"mt-4 md:mt-0"},T("a",{href:"/html/admin/trainings/create.html",class:"inline-flex items-center space-x-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-3 rounded-xl shadow-soft transition-all duration-300 hover-lift font-medium"},T("i",{class:"fas fa-plus-circle text-lg"}),T("span",null,"Nueva Capacitación"))))}function ji(){const e=T("tbody",{class:"bg-white divide-y divide-gray-200"});return{host:T("div",{class:"card-enhanced overflow-hidden"},T("div",{class:"overflow-x-auto"},T("table",{class:"min-w-full divide-y divide-gray-200"},T("thead",{class:"bg-gradient-to-r from-gray-50 to-gray-100"},T("tr",null,Le("Título","fa-heading"),Le("Proveedor","fa-building"),Le("Fechas","fa-calendar-alt"),Le("Enlace","fa-link"),Le("Estado","fa-signal"),Le("Creación","fa-clock"),Le("Acciones","fa-cog"))),e))),tbody:e}}function Le(e,t){return T("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"},T("i",{class:`fas ${t} mr-2 text-purple-500`}),e)}function $i(){const e=T("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200"}),t=T("div",{class:"text-sm text-gray-700"}),a=T("button",{class:"px-3 py-1.5 rounded border text-sm mr-2 disabled:opacity-50",disabled:!0},"Anterior"),n=T("button",{class:"px-3 py-1.5 rounded border text-sm disabled:opacity-50"},"Siguiente"),s=T("div",null,a,n),r=T("div",{class:"flex flex-col sm:flex-row items-center justify-between gap-4"},t,s);return e.appendChild(r),{host:e,summary:t,prev:a,next:n}}async function Li(e=1,t=10){const a=await Lt({page:e,per_page:t}).catch(()=>({data:[],meta:{current_page:1,last_page:1,per_page:t,total:0}})),n=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a==null?void 0:a.items)?a.items:[],s=(a==null?void 0:a.meta)||{current_page:e,last_page:1,per_page:t,total:Array.isArray(a)?a.length:Array.isArray(a==null?void 0:a.data)?a.data.length:0};return{data:n,meta:s}}function Ti(e,t){const a=e.filter(o=>!!(o.link||o.url)).length,n=new Date,s=e.filter(o=>{const l=Ge(o.end_date);return!!(l&&l>=n)}).length,r=new Set(e.map(o=>o.provider).filter(Boolean)).size;return{total:t??e.length,withLink:a,active:s,providers:r}}async function qi(e){const t=e||document.querySelector('[data-page="admin-trainings-index"]');if(!t)return;const{allowed:a}=await ce("admin");if(!a)return;t.innerHTML="";const n=ki(),s=Ei(),r=ji(),o=$i(),l=T("div",{class:"animate-fade-in-up"},n,s.host,r.host,o.host);t.appendChild(l);let i=1,c=10,f=1,d=0;async function p(){r.tbody.innerHTML="";const{data:m,meta:y}=await Li(i,c);f=(y==null?void 0:y.last_page)||1,d=(y==null?void 0:y.total)??m.length;const g=Ti(m,d);if(s.set(g),!m.length)r.tbody.appendChild(T("tr",null,T("td",{colspan:"7",class:"px-6 py-12 text-center"},T("div",{class:"flex flex-col items-center justify-center"},T("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4"},T("i",{class:"fas fa-graduation-cap text-3xl text-gray-400"})),T("p",{class:"text-gray-500 font-medium"},"No hay capacitaciones disponibles"),T("p",{class:"text-sm text-gray-400 mt-1"},"Crea una nueva capacitación para comenzar"),T("a",{href:"/html/admin/trainings/create.html",class:"mt-4 inline-flex items-center px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-medium transition-all"},T("i",{class:"fas fa-plus mr-2"}),"Nueva Capacitación")))));else for(const h of m)r.tbody.appendChild(Ai(h));o.summary.textContent=`Mostrando ${Math.min((y.current_page-1)*y.per_page+1,d)} a ${Math.min(y.current_page*y.per_page,d)} de ${d} resultados`,o.prev.disabled=y.current_page<=1,o.next.disabled=y.current_page>=f}o.prev.addEventListener("click",()=>{i>1&&(i--,p())}),o.next.addEventListener("click",()=>{i<f&&(i++,p())}),await p()}function Ni(){const e=document.querySelector('[data-page="admin-trainings-index"]');e&&qi(e)}function se(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Ii(){try{return new URL(location.href).searchParams.get("id")}catch{return null}}function ze(e,t,a="text",n={}){const s=a==="textarea"?se("textarea",{id:t,name:t,rows:"4",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"}):se("input",{id:t,name:t,type:a,class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"});return Object.entries(n||{}).forEach(([r,o])=>s.setAttribute(r,String(o))),{host:se("div",null,se("label",{for:t,class:"block text-sm font-medium text-gray-700"},e),s),input:s}}function Ia(e){if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?e:t.toISOString().slice(0,10)}catch{return e||""}}async function Mi(e){const t=e||document.querySelector('[data-page="admin-training-edit"]');if(!t)return;const{allowed:a}=await ce("admin");if(!a)return;const n=Ii();if(t.innerHTML="",!n){t.appendChild(se("div",{class:"text-red-600"},"Falta el parámetro id"));return}const s=se("h1",{class:"text-2xl font-bold text-gray-800 mb-6"},"Editar Capacitación");t.appendChild(s);const r=ze("Título *","title","text",{required:!0}),o=ze("Proveedor","provider"),l=ze("Enlace","link","url"),i=ze("Fecha de Inicio","start_date","date"),c=ze("Fecha de Fin","end_date","date"),f=ze("Descripción","description","textarea"),d=se("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"},"Actualizar Capacitación"),p=se("a",{href:"/html/admin/trainings/index.html",class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded"},"Cancelar"),m=se("form",{class:"bg-white rounded-lg shadow p-6 max-w-4xl"},se("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se("div",{class:"md:col-span-2"},r.host),se("div",null,o.host),se("div",null,l.host),se("div",null,i.host),se("div",null,c.host),se("div",{class:"md:col-span-2"},f.host)),se("div",{class:"flex gap-4 mt-6"},d,p));t.appendChild(m);try{const y=await zs(n),g=(y==null?void 0:y.data)||y;r.input.value=(g==null?void 0:g.title)||"",o.input.value=(g==null?void 0:g.provider)||"",l.input.value=(g==null?void 0:g.link)||(g==null?void 0:g.url)||"",i.input.value=Ia(g==null?void 0:g.start_date),c.input.value=Ia(g==null?void 0:g.end_date),f.input.value=(g==null?void 0:g.description)||""}catch{t.appendChild(se("div",{class:"text-red-600 mt-4"},"No se pudo cargar la capacitación."))}m.addEventListener("submit",async y=>{var g,h,E,C,$;y.preventDefault(),d.disabled=!0;try{const v={title:(g=r.input.value)==null?void 0:g.trim(),provider:((h=o.input.value)==null?void 0:h.trim())||null,link:((E=l.input.value)==null?void 0:E.trim())||null,start_date:i.input.value||null,end_date:c.input.value||null,description:((C=f.input.value)==null?void 0:C.trim())||null};if(!v.title){r.input.focus(),d.disabled=!1;return}await Vs(n,v);const x=new URL("/html/admin/trainings/index.html",location.origin);x.searchParams.set("success","Capacitación actualizada correctamente"),location.href=x.toString()}catch(v){alert("No se pudo actualizar: "+((($=v==null?void 0:v.data)==null?void 0:$.message)||(v==null?void 0:v.message)||"Error"))}finally{d.disabled=!1}})}function Oi(){const e=document.querySelector('[data-page="admin-training-edit"]');e&&Mi(e)}function ie(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}function Ve(e,t,a="text",n={}){const s=a==="textarea"?ie("textarea",{id:t,name:t,rows:"4",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"}):ie("input",{id:t,name:t,type:a,class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"});return Object.entries(n||{}).forEach(([r,o])=>s.setAttribute(r,String(o))),{host:ie("div",null,ie("label",{for:t,class:"block text-sm font-medium text-gray-700"},e),s),input:s}}async function Pi(e){const t=e||document.querySelector('[data-page="admin-training-create"]');if(!t)return;const{allowed:a}=await ce("admin");if(!a)return;t.innerHTML="",t.appendChild(ie("h1",{class:"text-2xl font-bold text-gray-800 mb-6"},"Crear Nueva Capacitación"));const n=Ve("Título *","title","text",{required:!0}),s=Ve("Proveedor","provider"),r=Ve("Enlace","link","url"),o=Ve("Fecha de Inicio","start_date","date"),l=Ve("Fecha de Fin","end_date","date"),i=Ve("Descripción","description","textarea"),c=ie("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"},"Crear Capacitación"),f=ie("a",{href:"/html/admin/trainings/index.html",class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded"},"Cancelar"),d=ie("form",{class:"bg-white rounded-lg shadow p-6 max-w-4xl"},ie("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie("div",{class:"md:col-span-2"},n.host),ie("div",null,s.host),ie("div",null,r.host),ie("div",null,o.host),ie("div",null,l.host),ie("div",{class:"md:col-span-2"},i.host)),ie("div",{class:"flex gap-4 mt-6"},c,f));t.appendChild(d),d.addEventListener("submit",async p=>{var m,y,g,h,E;p.preventDefault(),c.disabled=!0;try{const C={title:(m=n.input.value)==null?void 0:m.trim(),provider:((y=s.input.value)==null?void 0:y.trim())||null,link:((g=r.input.value)==null?void 0:g.trim())||null,start_date:o.input.value||null,end_date:l.input.value||null,description:((h=i.input.value)==null?void 0:h.trim())||null};if(!C.title){n.input.focus(),c.disabled=!1;return}await Js(C);const $=new URL("/html/admin/trainings/index.html",location.origin);$.searchParams.set("success","Capacitación creada correctamente"),location.href=$.toString()}catch(C){alert("No se pudo crear: "+(((E=C==null?void 0:C.data)==null?void 0:E.message)||(C==null?void 0:C.message)||"Error"))}finally{c.disabled=!1}})}function Di(){const e=document.querySelector('[data-page="admin-training-create"]');e&&Pi(e)}async function Ui(){return 0}function Fi(){try{const e=[],t=localStorage.getItem("display_role")||localStorage.getItem("pending_role");return t&&e.push(String(t).trim().toLowerCase()),e.filter(Boolean)}catch{return[]}}function xn(){const e=document.getElementById("mobileMenuButton"),t=document.getElementById("mobileMenu"),a=document.getElementById("userDropdown"),n=document.getElementById("notificationsDropdown");if(!document.body.dataset.navGlobalBound){document.body.dataset.navGlobalBound="1",document.addEventListener("click",l=>{!l.target.closest("#mobileMenu")&&!l.target.closest("#mobileMenuButton")&&!l.target.closest("#userDropdown")&&!l.target.closest("#notificationsDropdown")&&(s(),r())}),document.addEventListener("keydown",l=>{l.key==="Escape"&&(s(),r())});const o=document.getElementById("darkModeToggle");o&&!o.dataset.bound?(o.dataset.bound="1",o.addEventListener("change",()=>{document.body.classList.toggle("dark-mode"),localStorage.setItem("darkMode",document.body.classList.contains("dark-mode"))}),localStorage.getItem("darkMode")==="true"&&(document.body.classList.add("dark-mode"),o.checked=!0)):localStorage.getItem("darkMode")==="true"&&document.body.classList.add("dark-mode")}function s(o=null){[a,n].forEach(i=>{if(i&&i.id!==o){const c=i.querySelector('div[class*="absolute"]');c&&c.classList.add("hidden")}})}function r(){t&&!t.classList.contains("hidden")&&t.classList.add("hidden")}e&&t&&!e.dataset.bound&&(e.dataset.bound="1",e.addEventListener("click",o=>{o.stopPropagation(),t.classList.toggle("hidden"),s()})),[a,n].forEach(o=>{if(o&&!o.dataset.bound){o.dataset.bound="1";const l=o.querySelector("button"),i=o.querySelector("#userDropdownMenu")||o.querySelector('div[class*="absolute"]');l&&i&&l.addEventListener("click",c=>{c.stopPropagation();const f=i.classList.contains("hidden");s(o.id),r(),i.classList.toggle("hidden",!f)})}}),document.querySelectorAll('[data-action="logout"]').forEach(o=>{o.dataset.bound||(o.dataset.bound="1",o.addEventListener("click",async l=>{l.preventDefault();try{await H("/logout",{method:"POST"})}catch{}try{localStorage.removeItem("auth_token"),localStorage.removeItem("display_role"),localStorage.removeItem("display_name"),localStorage.removeItem("pending_role"),localStorage.removeItem("pending_name"),localStorage.removeItem("profile_completed")}catch{}window.location.href="/html/auth/login.html"}))}),Ri(),Hi()}function Ma(e){const t=new Set(["guest"]);e?(t.add("authenticated"),t.add(be(e)),rt(e)&&t.add("company"),We(e)&&t.add("unemployed"),$t(e)&&t.add("admin")):Fi().forEach(a=>t.add(a)),document.querySelectorAll("[data-visible-for]").forEach(a=>{const n=(a.getAttribute("data-visible-for")||"").split(/[\|,]/).map(r=>r.trim().toLowerCase()).filter(Boolean),s=n.length?n.some(r=>t.has(r)):t.has("authenticated");a.classList.toggle("hidden",!s),s?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden","true")})}async function Ri(){var f,d;let e=null;try{const p=await ue();p&&typeof p=="object"&&!Array.isArray(p)&&(e=p)}catch{}const t=document.querySelector("[data-user-name]"),a=document.querySelector("[data-user-role]");if(e){const p=rt(e),m=We(e),y=$t(e);let g=(e==null?void 0:e.name)||"";if(p&&(g=((f=e==null?void 0:e.company)==null?void 0:f.company_name)||((d=e==null?void 0:e.company)==null?void 0:d.name)||g),!g)try{g=localStorage.getItem("display_name")||localStorage.getItem("pending_name")||""}catch{}g||(g=p?"Empresa":"Usuario");let h=y?"Administrador":p?"Empresa":m?"Cesante":"Usuario";t&&(t.textContent=g),a&&(a.textContent=h);try{g&&localStorage.setItem("display_name",g);const E=y?"admin":p?"company":m?"unemployed":"user";localStorage.setItem("display_role",E)}catch{}Ma(e);return}const n=document.getElementById("userDropdown");n&&n.classList.remove("hidden");let s=null,r=null,o=null,l=null;try{s=localStorage.getItem("pending_name")||null,r=localStorage.getItem("pending_role")||null,o=localStorage.getItem("display_name")||null,l=localStorage.getItem("display_role")||null}catch{}const i=s||o||"Usuario",c=(r||l||"user").toLowerCase();if(t&&(t.textContent=i),a){const p=c==="company"?"Empresa":c==="unemployed"?"Cesante":c==="admin"?"Administrador":"Usuario";a.textContent=p}Ma(null)}function Hi(){if(window.__notifPollingBound)return;window.__notifPollingBound=!0,document.getElementById("notification-badge");async function e(){try{if(!document.getElementById("notification-badge"))return;const t=document.getElementById("notification-badge"),a=await Bi();a>0?(t.textContent=String(a),t.classList.remove("hidden")):t.classList.add("hidden")}catch{}}e(),setInterval(e,3e4)}async function Bi(){return Ui()}document.addEventListener("DOMContentLoaded",xn);document.addEventListener("includes:ready",xn);function zi(){try{const e=[{key:"dashboard",url:"/html/admin/dashboard.html"},{key:"classifieds",url:"/html/admin/classifieds/index.html"},{key:"job-offers",url:"/html/admin/job-offers/index.html"},{key:"trainings",url:"/html/admin/trainings/index.html"}],t=location.pathname;for(const{key:a,url:n}of e){const s=document.querySelector(`[data-admin-link="${a}"]`);s&&(t.endsWith(n)?s.classList.add("active"):s.classList.remove("active"))}}catch{}}function Vi(){try{const e=document.querySelector("[data-admin-date]");e&&(e.textContent=new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}))}catch{}}async function Ji(){try{const e=await ue().catch(()=>null),t=document.querySelector("[data-admin-name]"),a=document.querySelectorAll("[data-admin-email], [data-admin-email-header]");e?(t&&(t.textContent=e.name||e.username||"Usuario"),a.forEach(n=>n.textContent=e.email||"—")):(t&&(t.textContent="Invitado"),a.forEach(n=>n.textContent="—"))}catch{}}function Gi(){document.querySelectorAll(".js-admin-logout").forEach(t=>t.addEventListener("click",()=>{try{localStorage.removeItem("auth_token"),pe(null)}catch{}window.location.href="/html/auth/login.html"}))}function Oa(e){try{const t=document.querySelector("[data-admin-title]");if(t){const a=e||(document.title||"").replace(/^Admin\s*[·\-|–]\s*/i,"").trim()||"Dashboard";t.textContent=a}}catch{}zi(),Vi(),Ji(),Gi()}try{document.addEventListener("includes:ready",()=>{document.querySelector("[data-admin-layout]")&&Oa()}),document.querySelector("[data-admin-layout]")&&setTimeout(()=>Oa(),0)}catch{}function J(e,t={},...a){const n=document.createElement(e);for(const[s,r]of Object.entries(t||{}))s==="class"?n.className=r:n.setAttribute(s,r);for(const s of a.flat())s!=null&&n.appendChild(s instanceof Node?s:document.createTextNode(String(s)));return n}const Pa={success:{box:"from-green-50 to-emerald-50 border-green-200 text-green-700",icon:"fas fa-check-circle text-green-600"},error:{box:"from-red-50 to-pink-50 border-red-200 text-red-700",icon:"fas fa-exclamation-circle text-red-600"},warning:{box:"from-yellow-50 to-amber-50 border-yellow-200 text-yellow-700",icon:"fas fa-exclamation-triangle text-yellow-600"},info:{box:"from-blue-50 to-indigo-50 border-blue-200 text-blue-700",icon:"fas fa-info-circle text-blue-600"}};function Wi({type:e="info",dismissible:t=!0,icon:a,content:n,className:s=""}={}){const r=Pa[e]||Pa.info,o=J("div",{class:`mb-6 bg-gradient-to-r ${r.box} border rounded-xl p-5 shadow-sm ${s}`}),l=J("div",{class:"w-10 h-10 bg-white/70 rounded-full flex items-center justify-center mr-3 flex-shrink-0"},J("i",{class:(a||r.icon)+" text-xl"})),i=J("div",{class:"flex items-start"},l,J("div",{class:"flex-1"},n||""));if(t){const c=J("button",{type:"button",class:"ml-4 text-current opacity-70 hover:opacity-100 transition-opacity",title:"Cerrar"},J("i",{class:"fas fa-times"}));c.addEventListener("click",()=>{o.remove()}),i.appendChild(c)}return o.appendChild(i),o}const Da={default:"bg-gray-100 text-gray-800",primary:"bg-blue-100 text-blue-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800",under_review:"bg-indigo-100 text-indigo-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"},Ua={sm:"px-2 py-1 text-xs",md:"px-3 py-1 text-sm",lg:"px-4 py-2 text-base"};function Ki({variant:e="default",size:t="md",icon:a,text:n="",className:s=""}={}){const r=`inline-flex items-center font-semibold rounded-full ${Da[e]||Da.default} ${Ua[t]||Ua.md} ${s}`,o=J("span",{class:r});return a&&o.appendChild(J("i",{class:a+" mr-1.5"})),o.appendChild(document.createTextNode(n)),o}const Fa={default:"bg-white rounded-2xl border border-blue-900/20 p-6 shadow-sm",enhanced:"bg-white rounded-2xl p-6 shadow-lg transition-shadow",glassmorphism:"backdrop-blur bg-white/60 rounded-2xl border border-white/30 p-6 shadow-sm",gradient:"bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-2xl p-6 shadow-md"};function Qi({variant:e="default",hover:t=!0,paddingClass:a="",className:n="",children:s=[]}={}){const r=Fa[e]||Fa.default,i=J("div",{class:`${r} ${t?"transition-transform duration-300 hover:-translate-y-1":""} ${a||""} ${n}`.trim()}),c=Array.isArray(s)?s:[s];for(const f of c)i.appendChild(f instanceof Node?f:J("div",null,String(f)));return i}function Xi({label:e,name:t="",type:a="text",error:n,icon:s,hint:r,required:o=!1,value:l="",className:i="",inputProps:c={}}={}){const f=J("div",{class:i});if(e){const p=J("label",{for:t,class:"block text-sm font-semibold text-gray-700 mb-2"});s&&p.appendChild(J("i",{class:s+" text-blue-600 mr-1"})),p.appendChild(document.createTextNode(e)),o&&p.appendChild(J("span",{class:"text-red-500"},"*")),f.appendChild(p)}const d=J("input",{type:a,name:t,id:t,class:"form-input-enhanced w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"+(n?" border-red-500":""),value:l});return Object.entries(c||{}).forEach(([p,m])=>d.setAttribute(p,String(m))),f.appendChild(d),r&&f.appendChild(J("p",{class:"text-sm text-gray-500 mt-1"},r)),n&&f.appendChild(J("p",{class:"text-sm text-red-600 mt-1"},J("i",{class:"fas fa-exclamation-circle mr-1"}),String(n))),{host:f,input:d}}const Ra={sm:"w-4 h-4 border-2",md:"w-8 h-8 border-4",lg:"w-12 h-12 border-4",xl:"w-16 h-16 border-4"};function Yi({size:e="md",text:t,className:a=""}={}){const n=J("div",{class:`flex flex-col items-center justify-center ${a}`.trim()}),s=J("div",{class:`loading-spinner ${Ra[e]||Ra.md}`});return n.appendChild(s),t&&n.appendChild(J("p",{class:"mt-3 text-gray-600 font-medium"},t)),n}function Zi({name:e="modal",title:t="",size:a="md",showClose:n=!0,content:s,className:r=""}={}){const o={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl",full:"max-w-full mx-4"},l=J("div",{class:"fixed inset-0 z-50 overflow-y-auto hidden"}),i=J("div",{class:"fixed inset-0 bg-black bg-opacity-50"}),c=J("div",{class:"flex items-center justify-center min-h-screen p-4"}),f=J("div",{class:`bg-white rounded-2xl shadow-2xl w-full ${o[a]||o.md} relative`});if(t||n){const y=J("div",{class:"flex items-center justify-between p-6 border-b border-gray-200"});if(y.appendChild(J("h3",{class:"text-xl font-bold text-gray-900"},t)),n){const g=J("button",{class:"text-gray-400 hover:text-gray-600",title:"Cerrar"},J("i",{class:"fas fa-times text-xl"}));g.addEventListener("click",()=>m()),y.appendChild(g)}f.appendChild(y)}const d=J("div",{class:"p-6"});s&&d.appendChild(s instanceof Node?s:J("div",null,String(s))),f.appendChild(d),c.appendChild(f),l.appendChild(i),l.appendChild(c);function p(){l.classList.remove("hidden"),document.body.style.overflow="hidden"}function m(){l.classList.add("hidden"),document.body.style.overflow=""}return i.addEventListener("click",m),window.addEventListener("keydown",y=>{y.key==="Escape"&&m()}),{host:l,show:p,hide:m,setContent:y=>{d.innerHTML="",d.appendChild(y instanceof Node?y:J("div",null,String(y)))}}}try{window.UI=Object.assign(window.UI||{},{createAlert:Wi,createBadge:Ki,createCard:Qi,createInput:Xi,createSpinner:Yi,createModal:Zi})}catch{}function el(e){return(e||[]).map(t=>{if(t==null)return{value:"",label:""};if(typeof t=="string"||typeof t=="number")return{value:String(t),label:String(t)};const{value:a,label:n,disabled:s,selected:r}=t;return{value:a!=null?String(a):"",label:n!=null?String(n):"",disabled:!!s,selected:!!r}})}function tl({label:e,name:t="",options:a=[],placeholder:n,selected:s,error:r,icon:o,hint:l,required:i=!1,className:c="",selectProps:f={}}={}){const d=J("div",{class:c});if(e){const y=J("label",{for:t,class:"block text-sm font-semibold text-gray-700 mb-2"});o&&y.appendChild(J("i",{class:o+" text-blue-600 mr-1"})),y.appendChild(document.createTextNode(e)),i&&y.appendChild(J("span",{class:"text-red-500"},"*")),d.appendChild(y)}const p=J("select",{name:t,id:t,class:"form-input-enhanced w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"+(r?" border-red-500":"")}),m=el(a);if(n){const y=J("option",{value:"",disabled:"",selected:s==null?"":null},n);p.appendChild(y)}for(const y of m){const g={value:y.value};y.disabled&&(g.disabled=""),(s!=null?String(s)===y.value:y.selected)&&(g.selected=""),p.appendChild(J("option",g,y.label))}return Object.entries(f||{}).forEach(([y,g])=>p.setAttribute(y,String(g))),d.appendChild(p),l&&d.appendChild(J("p",{class:"text-sm text-gray-500 mt-1"},l)),r&&d.appendChild(J("p",{class:"text-sm text-red-600 mt-1"},J("i",{class:"fas fa-exclamation-circle mr-1"}),String(r))),{host:d,select:p}}function al({label:e,name:t="",rows:a=4,value:n="",error:s,icon:r,hint:o,required:l=!1,className:i="",textareaProps:c={}}={}){const f=J("div",{class:i});if(e){const p=J("label",{for:t,class:"block text-sm font-semibold text-gray-700 mb-2"});r&&p.appendChild(J("i",{class:r+" text-blue-600 mr-1"})),p.appendChild(document.createTextNode(e)),l&&p.appendChild(J("span",{class:"text-red-500"},"*")),f.appendChild(p)}const d=J("textarea",{name:t,id:t,rows:String(a),class:"form-input-enhanced w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"+(s?" border-red-500":"")},n||"");return Object.entries(c||{}).forEach(([p,m])=>d.setAttribute(p,String(m))),f.appendChild(d),o&&f.appendChild(J("p",{class:"text-sm text-gray-500 mt-1"},o)),s&&f.appendChild(J("p",{class:"text-sm text-red-600 mt-1"},J("i",{class:"fas fa-exclamation-circle mr-1"}),String(s))),{host:f,textarea:d}}try{window.UI=Object.assign(window.UI||{},{createSelect:tl,createTextarea:al})}catch{}try{const t=localStorage.getItem("auth_mode")==="cookie"?"cookie":"bearer";if(Te({mode:t}),t==="bearer"){const a=localStorage.getItem("auth_token");a&&pe(a)}t==="cookie"&&pe(void 0)}catch{}console.info("Frontend bundle cargado.");try{Yn()}catch(e){console.warn("Error montando lista de ofertas:",e)}try{ts()}catch(e){console.warn("Error montando detalle de oferta:",e)}try{is()}catch(e){console.warn("Error montando creación de oferta:",e)}try{fs()}catch(e){console.warn("Error montando edición de oferta:",e)}try{hs()}catch(e){console.warn("Error montando clasificados:",e)}try{Ls()}catch(e){console.warn("Error montando detalle de clasificado:",e)}try{Ps()}catch(e){console.warn("Error montando creación de clasificado:",e)}try{Qs()}catch(e){console.warn("Error montando capacitaciones:",e)}try{ir()}catch(e){console.warn("Error montando favoritos:",e)}try{dr()}catch(e){console.warn("Error montando mensajes:",e)}try{ur()}catch(e){console.warn("Error montando formulario de mensaje:",e)}try{gr()}catch(e){console.warn("Error montando notificaciones:",e)}try{Er()}catch(e){console.warn("Error montando portafolios:",e)}try{$r()}catch(e){console.warn("Error montando creación de portafolio:",e)}try{qr()}catch(e){console.warn("Error montando edición de portafolio:",e)}try{Pr()}catch(e){console.warn("Error montando postulaciones:",e)}try{zr()}catch(e){console.warn("Error montando postulaciones desempleado:",e)}try{Xr()}catch(e){console.warn("Error montando postulaciones empresa:",e)}try{Zr()}catch(e){console.warn("Error montando crear postulación:",e)}try{co()}catch(e){console.warn("Error montando auth login:",e)}try{yo()}catch(e){console.warn("Error montando auth register:",e)}try{wo()}catch(e){console.warn("Error montando auth forgot:",e)}try{Ao()}catch(e){console.warn("Error montando auth reset:",e)}try{$o()}catch(e){console.warn("Error montando company form:",e)}try{Oo()}catch(e){console.warn("Error montando settings:",e)}try{zo()}catch(e){console.warn("Error montando home:",e)}try{Ko()}catch(e){console.warn("Error montando unemployed form:",e)}try{ti()}catch(e){console.warn("Error montando entrevistas index:",e)}try{li()}catch(e){console.warn("Error montando admin classifieds index:",e)}try{xi()}catch(e){console.warn("Error montando admin job offers index:",e)}try{Si()}catch(e){console.warn("Error montando admin dashboard:",e)}try{Ni()}catch(e){console.warn("Error montando admin trainings index:",e)}try{Oi()}catch(e){console.warn("Error montando admin training edit:",e)}try{Di()}catch(e){console.warn("Error montando admin training create:",e)}window.addEventListener("unhandledrejection",e=>{var n;const t=e.reason,a=((t==null?void 0:t.message)||"").toString().toLowerCase();if(t&&(t.code==="AUTH_REQUIRED"||t.status===401||a==="auth required")){(n=e.preventDefault)==null||n.call(e),console.info("[API] Autenticación requerida (401). Configura token o modo cookie.");return}console.error("Uncaught (in promise):",t)});
